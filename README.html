<HTML>
<HEAD></HEAD>
<BODY>

<h2 align=center>LEAFNODE</h2>

<h3 align=center>Table of Contents</h3>

<OL>
<LI>Overview
<LI>Installation
<LI>Update from previous versions
    <OL>
    <LI>Update from versions &lt; 2.0
    <LI>Update from versions &lt; 1.9.3
    <LI>Update from versions &lt; 1.6
    </OL>
<LI>Files and directories
    <OL>
    <LI>The main configuration file
    <LI>The filter file
    </OL>
<LI>Local newsgroups
<LI>Deinstallation
<LI>Frequently asked questions
<LI>Copyright
</OL>

<hr>

<h3 align=center>1. OVERVIEW</h3>

<p>
Leafnode is a USENET software package designed for small sites, with a
few tens of readers and only a slow link to the net. It is developed
on Linux, but has been reported to compile and run also under any BSD
flavour, Solaris and Irix.

<p>
The Leafnode package consists of several programs, three essential ones
and several add-ons.

<UL>
<LI><u>Leafnode</u> is the NNTP server.  It talks to the normal news clients,
    and stores readership data.
<LI><u>Fetchnews</u> is the NNTP news-gatherer.  It looks at the readership
    data Leafnode stores, and selects what groups to pull news from. It
    also transfers your contributions to one or more upstream servers.
<LI><u>Texpire</u> is responsible for deleting old and uninteresting news.  It
    deletes all discussion threads that are old and not recently read.
</UL>

<p>
These are the add-ons:

<UL>
<LI><u>Applyfilter</u> lets you delete articles from your local news spool
    which fit a certain pattern.
<LI><u>Checkgroups</u> inserts the titles of newsgroups into the newsgroup
    database.
<LI><u>Newsq</u> shows which news are waiting to be transferred to your
    upstream server(s).
<LI><u>Rnews</u> sorts an UUCP batch or articles downloaded by other means 
    into the news spool.
</UL>

<p>
Only groups that someone has been reading in the past week are fetched
from the upstream NNTP server.  When someone stops reading a group,
fetchnews will stop reading that group a week later (this is the default
which can be configured), and when someone starts reading a group, fetchnews
will grab all the articles it can in that group the next time it runs.

<p>
Leafnode's distinguishing features are:

<UL>
<LI>Leafnode is written with the novice user in mind. It is very
    easy to install and configure and requires no manual intervention
    once installed. Leafnode tries very hard to recover automatically
    from error situations.
<LI>Compared to other servers, leafnode uses very little disk space
    and bandwidth. Of course this also depends on how many users
    are accessing your server and is probably not true for 300-user
    sites.
<LI>The newsspool can be easily manipulated by small scripts because
    it is maintained in plain file format. Some tiny examples are
    in the subdirectory tools/ .
</UL>

<p>
Of course, Leafnode also has weaknesses. Some of these are:

<UL>
<LI>In just any error situation, leafnode tries to fix its problems by
    deleting the offending article. This can cause leafnode to lose news.
<LI>Due to its open architecture, Leafnode scales very badly.
</UL>

<p>
The current version of leafnode is available from http://www.leafnode.org/ .

<p>
There is also a leafnode mailing list. Send mail to
<p align=center>
	leafnode-list@wpxx02.toxi.uni-wuerzburg.de
<p>
with "Subscribe" in the Subject: to subscribe.

<hr>

<h3 align=center>2. INSTALLATION</h3>

<OL>
<LI>
<p>
Leafnode uses GNU autoconf to determine the configuration of the
machine it will be compiled on. Type
<pre>
         sh ./configure
</pre>
to coreate an appropriate Makefile and config.h .
<p>
The configure script can take some flags:
<pre>
--with-ipv6       use this if you have and want to use IPV6
--prefix=[dir]    Leafnode installs itself normally in the /usr/local/sbin
                  directory. If you want to use another directory, use this
		  flag. For example, if you want to install leafnode in
		  /usr/sbin, use --prefix=/usr/sbin .
</pre>

<LI>
<p>
Type
<pre>
          make
</pre>
There should be no errors. Dependent on your compiler, you might get
the warning:
<pre>
    /fetchnews.c: In function `nntpactive':
    /fetchnews.c:1062: warning: `%y' yields only last 2 digits of year
</pre>
Don't worry about it.

<LI>
Create a user "news" if you don't have one.

<LI>
Type
<pre>
          make install
</pre>
If you prefer an installation with the binaries stripped free of symbols,
use
<pre>
	  make install-strip
</pre>
instead.

<LI>
If you are updating leafnode from a previous version, see the section
"Updating" below.

<LI>
<p>
Edit $(LIBDIR)/config. $(LIBDIR) defaults to /etc/leafnode, but can be
adjusted in the Makefile. For documentation, see below or config.example
and leafnode(8). It is absolutely necessary to change the "server"
parameter to point it to your upstream news server (generally the
one of your IP provider). Make sure the environment variable $NNTPSERVER
or /etc/nntpserver points to your own host so clients will talk to
leafnode rather than try to go to the upstream server.
<p>
If you want to use filtering of the incoming spool, see the section on
the filter file below.

<LI>
Set up a cron job (as user "root" or "news") to run texpire every night
or maybe every week. Here is my crontab line, which runs nightly:
<pre>
0 4 * * * /usr/local/sbin/texpire
</pre>
I did "crontab -u news -e" as root to edit the crontab file, and added
this line.  Substituting "1" for the third "*", thus:
<pre>
0 4 * * 1 /usr/local/sbin/texpire
</pre>
tells cron to run texpire at 4am every Monday morning.

<LI>
Make sure fetchnews is run at the appropriate time. If you have a
full-time link, run it out of cron (as "news" again); if not, run it
when your connection to the net is established. If it is run as root
it will change to user "news". If you use PPP, you can run fetchnews
from /etc/ppp/ip-up.

<LI>
<p>
Edit /etc/inetd.conf so that $(BINDIR)/leafnode is executed for incoming
NNTP connections.  Here is my inetd.conf line:
<pre>
nntp    stream  tcp     nowait  news    /usr/sbin/tcpd /usr/local/sbin/leafnode
</pre>
This starts leafnode for all connections on the nntp port, subject to
/etc/hosts.allow and /etc/hosts.deny screening. If you don't have
tcp wrappers (i.e. /usr/sbin/tcpd) you might use this line instead:
<pre>
nntp    stream  tcp     nowait  news    /usr/local/sbin/leafnode
</pre>
However, using leafnode without tcp wrappers is strongly discouraged since
it opens up your news server to abuse.
<p>
After these changes, force inetd to read the changed configuration file
by sending it the HANGUP signal. To achieve this, issue the following
command (as root):
<pre>
kill -HUP `cat /var/run/inetd.pid`
</pre>

<LI>
If you have tcpd installed, write the following into /etc/hosts.deny:
<pre>
leafnode: ALL
</pre>
and into /etc/hosts.allow:
<pre>
leafnode: 127.0.0.1
</pre>
to protect your news server from abuse. If you want to make leafnode
accessible to additional IP numbers/domains, add them in /etc/hosts.allow
in the format described above. See hosts_access(5) and hosts_options(5)
(if applicable) for more information about tcp wrappers.

<LI>
Run fetchnews. The first run will take some time since fetchnews reads
a list of all newsgroups from your upstream server. In the worst case,
this can take up to 60 minutes, depending on how many newsgroups your
provider offers and how reliable your modem connection is. To see
fetchnews working, run it with -vvv.

<LI>
<p>
Read news using an NNTP client (with $NNTPSERVER or /etc/nntpserver
pointing to your own host). Select the groups you want to read in
the future. You will find them empty except a default article.
Reading this article is necessary with some newsreaders to select
the groups for further fetching.
<p>
After this, you should have empty files in
/var/spool/news/interesting.groups/ for every group you want to read.

<LI>
Run fetchnews again. This run should pick up all the groups you want
to read.

</OL>

<hr>

<h3 align=center>3. UPDATE FROM PREVIOUS VERSIONS</h3>

<h3 align=center>3.1 Update from versions &lt; 2.0</h3>

<p>
From 1.9.x to 2.0 there were some changes to options in the main
configuration file. The options "maxage", "maxlines", "minlines",
"maxbytes" and "maxcrosspost" have become obsolete in the main
configuration file and have to be specified in the filter file
instead. The advantage of this is that you can do much finer
selection on these criteria now.

<p>
To replace, for example, a "maxage = 5" specification in the
main configuration file, you should add the following to your
filter file:

<pre>
newsgroups = *
maxage = 5
action = kill
</pre>

<p>
The leafnode programs will issue warnings if they encounter
obsolete specifications in the main config file.

<h3 align=center>3.2 Update from versions &lt; 1.9.3</h3>

<p>
From version 1.9.3 on, the groupinfo file is sorted in a case-insensitive
manner. To update correctly, do a "make update" as root after you have
successfully completed "make install". This will re-sort the groupinfo
file. The old groupinfo file will be stored as groupinfo.old just in
case something goes wrong. You also have to change your main config
file manually as described in the last section.

<h3 align=center>3.3 Update from versions &lt; 1.6</h3>

<p>
Between leafnode-1.6alpha and leafnode-1.6, the format of the groupinfo
file changed and some files moved to other places. To update correctly,
do a "make update" as root after you have successfully completed
"make install". This will reformat the groupinfo file and move the
other files into the correct places. The old groupinfo file will be
stored as groupinfo.old just in case something goes wrong. You also
have to change your main config file manually as described in the
section "Update from versions &lt; 2.0".

<hr>

<h3 align=center>4. FILES AND DIRECTORIES</h3>

<p>
Leafnode puts its files in three separate directories: The spool
directory, the library directory, and the binaries directory. All
directories can be changed at compile time.

<p>
In the spool directory you find the stored news, the active file and
some other short-lived configuration file. It defaults to /var/spool/news
and can be changed at compilation time. There are some special
directories here; see the leafnode(8) man page.

<p>
The library directory contains long-lived configuration files. It
defaults to /etc/leafnode.

<p>
The binaries directory, /usr/local/sbin by default, contains the
executable programs applyfilter, texpire, fetchnews and leafnode.

<p>
The user directory, /usr/local/bin by default, contains the newsq
program.

<h3 align=center>4.1. The main configuration file</h3>

<h3 align=center>4.2. The filter file</h3>

<hr>

<h3 align=center>5. LOCAL NEWSGROUPS</h3>

<p>
From version 2.0 on, Leafnode is able to handle local newsgroups. Local
newsgroups are groups that exist only on your local server but not on
upstream servers.

<p>
To create a local newsgroup, you have to think of a newsgroup name which
should not exist on any of your upstream servers. It is therefore a good
idea to start a new top-level hierarchy. You should also make up a
description for your newsgroup.

<p>
If you choose a newsgroup name which exists already on an upstream server,
the newsgroup is not treated as a local one.

<p>
Next, you write both the name and description into the file
/var/spool/news/leaf.node/local.groups using your preferred text editor.
The file should consist of lines in the format
<blockquote>
news.group.name &nbsp; &nbsp; description
</blockquote>
The first word of each line is taken as the newsgroup name; the rest
of the line is interpreted as description. For example, to set up a
newsgroup "local.leafnode" which deals with Leafnode's internals, you
would put a line

<blockquote>
local.leafnode &nbsp; &nbsp; Local leafnode user group
</blockquote>

into /var/spool/news/leaf.node/local.groups . (If your newsspool does not
reside in /var/spool/news, replace this part of the pathname with the
appropriate directory.)

<p>
That's it! You just have created a local newsgroup and can now access it
using your newsreader of choice.

<hr>

<h3 align=center>6. DEINSTALLATION</h3>

<p>
If you want to uninstall leafnode (e.g. because you want to replace it
with another newsserver) and have a Makefile available, you can
achieve this by doing "make uninstall". This will remove the executables,
newsspool and configuration directories. If you only want to remove
the executables and leave the spool and configuration directories
untouched, use "make uninstall-bins" instead.

<p>
There is no need to uninstall an old version of leafnode before updating.

<hr>

<h3 align=center>7. FREQUENTLY ASKED QUESTIONS</h3>

<p>
See the file FAQ.

<hr>

<h3 align=center>8. COPYRIGHT</h3>

<p>
Leafnode versions through 1.4 were written by Arnt Gulbrandsen
&lt;agulbra@troll.no&gt; and are copyright 1995 Troll Tech AS,
Postboks 6133 Etterstad, 0602 Oslo, Norway, fax +47 22646949.

<p>
Leafnode versions 1.5 and higher were written by Cornelius Krasel
&lt;krasel@wpxx02.toxi.uni-wuerzburg.de&gt; and are copyright 1997-2000.

<p>
Major modifications were made by<br>
Randolf Skerka &lt;Randolf.Skerka@gmx.de&gt;<br>
Kent Robotti &lt;robotti@erols.com&gt;<br>
Markus Enzenberger &lt;enz@cip.physik.uni-muenchen.de&gt;<br>
Matthias Andree &lt;mandree@dosis.uni-dortmund.de&gt;<br>
J&ouml;rg Dietrich &lt;joerg@dietrich.net&gt;<br>

<p>
Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

<p>
The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

<p>
THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.

</BODY>
</HTML>
