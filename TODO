 -*- mode: text; coding: iso-8859-15; -*-
 ----------------------------------------------------------------------
		   Leafnode 2.0b8_ma branch TODO list
 ----------------------------------------------------------------------


NOTE: issues fixes in the current, possibly unreleased _ma versions, but
persistent in the offical 2.0b tree, are not listed here.

STATE: NEW -> OPEN -> ANALYZED -> NEEDFEEDBACK|RESOLVED|REJECTED

This is a PRIORITIZED LIST. It has two columns, first the importance,
second the urgence. (Matthias)

importance:
1 = most important, 5 = forget it
urgence:
1 = do now, 5 = postpone until bored

"security relevant": at most 2.2

"works correctly, but suboptimal": importance and urgence at least 3.3

Ralfs TODO:
	* 'LIST NEWSGROUPS pattern' could add moderator address for
	  moderated local groups.
	* dirutil.c: should dirlist_core set count in error case?  This
	  could break xgetxover and maybe other places.
	* NNTP draft: wildmats are parsed wrongly:
	  'groups.a.*,groups.b.*' is not properly detected (who needs
	  this?)
     ---- ACKNOWLEDGED
	  NOTE 2002-04-06 Ralf:
	  reconstructing a real big thread takes 90% of user time in
	  DoMatch or wildmat (as per gprof). It would be worthwhile to
	  use something that performs better. To test: slrn, Esc 1 Esc P
	  (does XPAT to find children).
     ---- DoMatch is not too inefficient. Does gprof overhead cause
	  miscalculation because of the recursion?
	* nntpd.c: check with NNTP draft for UTF-8 stuff.  Folding should
	  be ok now.
	* option fqdn not explained (option hostname sufficient?)
	* applyfilter: does not handle to-kill-crossposts correctly:
	  only killed if removed from _all_ other groups
	  (stat.st_nlink<2) but deleted from to-do group.  Subsequently,
	  "%d articles deleted' message not correct.
	* delaybody mode: Cancels for marked bodies lead to marks not being
	  removed (supersedes are handled ok) until expiry of the pseudo header.
	* Leftover link in temp.files for each (successfully?) posted article,
	  as well as backup.moderated.
	* :active.read must not be updated on NEWGROUPS, or the active will
	  never be refetched as a whole.
	* sysconfdir is missing /leafnode, thus wrong manpages (more?)
	* Fix handling of pseudo article.

10pre5
0.0 forward port bug fixes from 1.9.19rc*
    (applyfilter done)

10pre5
0.0 do not use mkstemp on MacOS X, it's unsafe there

10pre5
1.1 exit code of fetchnews always zero

10pre5
1.1 try to post an article to *every* server before moving into
    failed.postings. suggested by Jeff Grossman.

10pre5
2.2 rb_lookup: warning: `cmp' might be used uninitialized in this
    function. May happen with rb_lookup with rbinfo->rb_root == RBNULL.
    (Not in leafnode). Reported by Ralf Wildenhues. Bug report
    to Damian Ivereigh. Message-ID: <20020126133758.A428@uni-bonn.de>

10pre5
1.1 dopost: Newsgroups: is not checked for valid groups. Use
    checkstatus(groups, 'y') after checkstatus('m'). Reported by Ralf
    Wildenhues. Message-ID: <20020126133758.A428@uni-bonn.de>

10pre5
1.1 fix SIGCHLD behaviour or use Jeffrey Goldberg's patch of 2002-02-04
    note: cannot reproduce "SIGCHLD triggers getc() EOF" on Linux or
    FreeBSD. Asked Jeffrey for explanation of OS and maybe scenario.
    2002-07-08.
    status: FEEDBACK PENDING
    But should have been fixed with sigaction on 2002-07-08.

10pre5
1.1 groupinfo not updated after timeout + subsequent SIGINT
    bug confirmed by Jörg Dietrich 2002-01-04
    ACTION: FEEDBACK: has this been fixed with sigaction on 2002-07-08?

10pre5
1.1 leafnode does not add a Lines: header, but has the Lines count in
    XOVER. slrn then displays "0 Lines" when fetching a parent not
    previously displayed in the article overview. Reported by Ralf
    Wildenhues, 2002-01-16, <20020116154247.A770@uni-bonn.de>

11pre1
1.1 fix posting issues, introduce per-server queues?

11pre1
1.1 out.going: "Nur, wenn ich fetchnews aufrufe, ohne Online zu
    sein, geht das Posting verschütt. Ohne Fehlermeldung." Ivo Schwalbe,
    <51nig9.kv.ln@abu.ivos.de>
    NOTE: only worked around, not fixed.
    TODO: only delete articles successfully posted

2.2 Add custom headers like Organization: or X-Complaints-To: (Jeff
    Grossman, 2002-03-09)

2.2 insertgroups/mergegroups global/static variables suck big time

2.2 for posts to moderated groups, add server preferences for posting?

2.2 track which user posted an article (Stefan Fleiter)
    log RFC931 or AUTH data who posted an article (maybe show in newsq)

2.2 also run feedincoming on exit of programs that lock (after they free
    the lock)

2.2 do not store cancel and perhaps other control messages locally?

2.2 cancelwatch (send mail to user if a posting he sent is cancelled)



2.2 Check RPM build

2.2 pipeline GROUP commands for speed (make configurable for
    compatiblity with old server: separate parameter from ARTICLE
    pipeline)?

2.2 Create rpost/inews

2.2 Fix and amend copyright statements and licenses.

2.2 nntpd control articles are also displayed

2.2 convert Newsgroup: to lowercase on external newsgroups.

2.2 option to freeze interesting.groups as it is -- just give away group
    permissions to root -- Ozz 2001-06-12

3.3 do parallel fetch
    models: 1- thread 2- fork() 3- select()-based
    problems: 1- groupinfo 2- .overview 3- avoid EEXIST 4- avoid locks
    or semaphores

3.3 heed Expires: header in texpire

3.3 offer a per-server switch to select how the list of downloadable
    articles is fetched, offer xover, xhdr, newnews and "auto" which
    tries these methods in exactly this order.

3.3 Does not send UUCP to upstream, introduce option to batch and spool UUCP.

3.3 Ben Holmes: enable clients to read newsgroups immediately after
    completion of their download, rather than only after fetchnews
    completed.

3.3 add support for stderr logging so that multilog can be used
    (clemensF <rabat@web.de>).

3.3 add IHAVE support for feeding upstream

3.3 don't supersede() articles unconditionally
    ACTION: figure criteria for allowing/denying supersede
    Cancel-Lock? Plausibility checks?

3.3 authentication interface:
    make PAM aware (Solaris, Linux, FreeBSD) to get rid of crypt?
    Use Bruce Günter's credential validation module?

3.3 ACLs (possibly including identd) or regexp to prevent groups from
    being shown (mind ARTICLE <message@id> and check against Xref or
    Newsgroups: headers)

3.3 ACLs (possibly including identd) or regexp to filter which groups
    may be subscribed to (could include user specific)

3.3 Hook (ext. program) for editing group info,
    <slrn9e1dv6.3il.wum@wum.truhaso.lu> and
    <m3snj2d3k1.fsf@emma1.emma.line.org>

3.3 run everything through various static and dynamic checkers
    (efence, dmalloc, lclint)

3.3 get rid of _all_ sscanf (Matthias Andree)

3.3 how to make newsgroup names 8-bit compliant? E.g., how to produce
    a newsgroups line of the form
	Newsgroups: norge.østfold
    Some readers encode this as ISO-8859-1 but this apparently is not
    understood upstream. It is also against the RFCs. son-of-rfc1036
    says that all data must be transmitted with ASCII < 127.
    draft-ietf-nntpext-base-07.txt says that the character set for all
    NNTP commands is UTF-8 (unicode!). Another possible draft is
    draft-ietf-usefor-article-01.txt (chapter 5.5.) which is not very
    helpful either.

3.3 fetchnews starts with an initialfetch (!)

3.3 let texpire use the actual article date rather than mtime/atime

3.3 send posted articles out immediately -- based on switches or
    filters? MID <3C10FC04.BeroList-2.5.9@wpxx02.toxi.uni-wuerzburg.de>?
    Ben Holness.

3.4 postarticles is a horrible mess. It deletes the articles IMMEDIATELY
    if it's available on a server.

4.2 get rid of all those if (verbose > anything)

4.3 move old articles from out.going to failed.postings if they are,
    say, 7 days, old? (Report by Stefan Wiens, Message-ID:
    <3A1EDBFF.BeroList-2.5.9@wpxx02.toxi.uni-wuerzburg.de>)

4.4 NOCEM, store Message-ID in advance (advance cancel, nocem, ...)
    (Mike Castle, dalgoda@ix.netcom.com)

4.4 implement detection if local group shadows server group

4.4 server dependent out.going, possibly a repost command?

4.4 interrupt fetch every 100 (configurable) postings and then
    reconnect, to beat the INN configuration option.

4.4 see if the dots that NNTP servers escape can remain in the articles
    so that the body can be passed through to the client 1:1 (would need
    review if CR is required, and would break "direct spool" operation)

4.4 progress displays on terminals for fetchnews and texpire

4.4 optionally forbid crosspostings to local and global groups.
    (consider this for local posts and check whether to ignore this for
    downstream pulled articles)

4.4 split post functionality from fetchnews to a separate daemon (but
    maybe call the new daemon automatically) Ozz 2001-06-12

5.5 introduce Control: pseudo group functionality

5.5 abort group fetch and proceed to next group

========================================================================
FIXED ITEMS:

2002-07-22 tolerate ", " instead of just "," in Newsgroup:
	   current NNTP drafts suggests that to be able to fold Newsgroup: headers.

2002-07-08 Matthias Andree
	   do not tamper with permissions on /var/spool/news/* directories
	   (Kevin Bulgrien), to allow for leafwa tricks.

2002-07-07 Ralf Wildenhues
	   delaybody mode: Overviews are not corrected at all times yet.

	   Suggestion by Jörg Mensmann: only pick groups from supplement that
	   have not been fetched before (or filter groups by server)
	   Implemented with only_fetch_once config option.

2002-07-06 Ralf Wildenhues
	   can fetchnews cope with servers that reject XOVER?

	   delaybody only for certain groups?

	   clean up fetchnews main function, it's a horrible mess with all
	   those !postonly, unmaintainable.

	   Look at each occurence of article numbers. They can go from 1
	   to 2^32-1 according to NNTP draft - watch out for signed long
	   (done for all except fetchnews):
	   nntpd.c: doarticle: On 'ARTICLE <MID>', for delaybody an artno
	   still has to be computed but not returned (see above).
	   check each time occurrence for possible 4 digit years (NNTP draft).
	   getgroup() should return unsigned long.
	   delaybody mode: fetchnews currently tries normal download of those
	   headers also, resulting in error messages, the output counts are wrong.

2002-07-03 "rnews does not work in pipes", Jörg Dietrich, Raymond Scholz,
	   <3AF40BA6.BeroList-2.5.9@wpxx02.toxi.uni-wuerzburg.de>

2002-06-18 Ralf Wildenhues
	   make user that leafnode runs under (now hard-wired to "news")
	   configurable

2002-06-14 Matthias Andree
	   Leopold Tötsch: offer 1.9-style posting: do not store a
	   posted article locally, but wait for its download from the
	   upstream, to make sure if it's posted or not.
	   (2002-04-10T15:50, "Small posting problem with
	   leafnode-2.0b8_ma8rc5", leafnode-list)

2002-05-05 Matthias Andree
           refuse postings with unqualified or local message ID domain part.

2002-05-05 Matthias Andree
	   add COPYING (requested by Ralf Wildenhues)

2002-05-05 Matthias Andree
	   left over temp files when lock cannot be obtained (Jari Lehtonen
	   <jari@utu.fi>)
	   -> changed timeout handling, do not use alarm(), but let lockfile.c
	   track the time out.

2002-05-05 Matthias Andree
           internal error reported when hostname = localhost (Jari Lehtonen
           <jari@utu.fi>, Mark Brown)

2002-05-01 Ralf Wildenhues
	   NEWNEWS and NEWGROUPS MUST not alter state information!

2002-05-01 Ralf Wildenhues
	   When POSTing an article with an upstream-already-used MID, the
	   new article is not moved out of in.coming, causing errors at
	   each fetchnews invocation.

2002-05-01 Ralf Wildenhues
	   artutil.c: mgetheader is broken.  A non-folded header is
	   always returned as NULL.  Effect: applyfilter does not work at
	   all, dopost dows not check for dupes.

2002-04-26 Ralf Wildenhues
	   nntpd.c: do error checking on interesting.groups/* files
		    fix file descriptor leak

2002-04-13 Matthias Andree
	   nntpd.c: list PAT in dohelp? (Ralf Wildenhues)
	   Fix: implemented.

2002-04-10 Ralf Wildenhues
	   Ralf Wildenhues/Thomas Schultz: draft-ietf-nntpext-base-15.txt
	   reply with 22X 0 <MID> to ARTICLE/BODY/HEAD/STAT <MID> (mind the 0)

2002-04-10 Ralf Wildenhues
	   check for spaces and other fun in MIDs (found a MID with spaces
	   in my spool and an article with UTF-7 encoded references).

2002-03    strings returned by {f,m,}getheader must be freed (Stefan Wiens)
	   Fixed by Ralf Wildenhues

2002-02-28 Matthias Andree 
	   NNTP draft:  no message on timeout disconnect - does this break 
	   clients/servers?

2002-02-11 tin claims "no articles" for all local groups.
	   Lutz Frommberger, 2002-01-06. Private mail, ID:
	   <E16MzOy-0000An-00@dali.aufgebot.gov>
	   Fixed by Jörg Dietrich.

2002-02-11 groupinfo is not updated for local groups (article low/high marks)
	   when these are reinserted.
	   Fixed by Jörg Dietrich.

2002-02-11 "Das ist eine Macke von Leafnode. Wird von einem Server die
	   komplette Gruppenliste geholt, so werden neu hinzugekommene
	   Gruppen bei NEWGROUPS nicht aufgeführt. Der Reader findet sie
	   daher nicht ohne weiteres." (Stefan Wiens,
	   de.comm.software.newsserver 2000-12-07, Message-ID:
	   <wkr93lxerw.fsf@helium.eswe.dyndns.org>) Transl: if a
	   complete group list is fetched from a server, newly appeared
	   groups are not offered in NEWGROUPS.
	   Idea #1: Possibly emit list from mergegroups
	   Idea #2: diff newsgroups list before and after group list fetch
	   Idea #3: Store newsgroups in timestamped file.
   	   Fixed by Jörg Dietrich.

2002-02-04 leafnode may store newly fetched articles into the gaps if groupinfo
	   is not current. groupinfo may be out of date after a crash, fix
	   watermarks.

2002-02-04 put conditional #include <dmalloc.h> into each file

2002-02-03 do not log without debug/verbose mode (cron should not send mail
	   when everything goes smoothly)

2002-01-07 1.1 article can be given out in spite of missing message.id
	   file - a missing message.id file/link hints to spool
	   corruption. store() does NOT link into message.id on write
	   errors.

2002-01-07 .overview must always be more current than groupinfo, so that
	   nntpd never offers article via GROUP that it cannot provide
	   via XOVER e. g. (Stefan Wiens)

2002-01-06 authinfo handling in nntpd.c proper? (just user gives ACCEPT)
	   ACTION: replace by proper state machine

2002-01-06 document NOPOSTING env variable that prevents posting

2002-01-06 NOPOSTING: replace the banner with the contents of this
	   variable.

2002-01-06 Fix nntputil.c and nntpd.c for proper IPv6
	   (getipnodebyname/byaddr etc.)

2002-01-06 groupinfo is all 0 0 0 if groupinfo is entirely re-read, until
	   texpire is run.

========================================================================
DROPPED ITEMS:

2002-07-08 Matthias Andree
	use separate repairspool program

2002-07-07 Matthias Andree & Ralf Wildenhues
	getgroup: "%s: considering %ld articles %lu - %lu" does not include
	   proper article count as sent by server, but just uses last-first+1
	   The correct numbers are reported later on.

2002-04-13 Matthias Andree
	Ralf asked:
	* nntpd.c: dogroup does
	  if (is_interesting(g->name))
	    markinterest(g);
	  shouldn't it be
	  if (!is_interesting(g->name))
	    markinterest(g);
	  or am I just mislead by the naming?
	# We don't want "GROUP" to mark an uninteresting group
	  interesting, but we do want it to keep an interesting group
	  interesting.
2002-03-23 Robert Marshall on 2.0b8_ma9:
	   Changing subject slightly, I have a filters file containing
	   newsgroups = *
	   maxcrosspost = 6
	   action = kill
	   and I've just seen an article crossposted to 8 groups...
	   (cannot be reproduced. Note: "maxcrosspost = 6" still allows
	   6 groups, but not 7 groups or more).

2002-01-06 report Raymond Scholz, rnews doesn't read from pipes.
	   ACTION: reimplement rnews from scratch.
	   (duplicate report, merged with Jörg Dietrich's)

2002-01-06 gethostbyname is not subject to timeout control
	   (rely on the OS to do that)

2002-01-06 signal needs to be worked around on Solaris 7 (Matthias Andree)
	   (I no longer care for goofed Solaris includes as long as the
	   stuff still works properly.)

2002-01-06 determine interesting groups from .newsrc
	   (.newsrc format is not consistent; layer violation)
