# DO NOT EDIT!
# @configure_input@

Version: @VERSION@
Summary: Leafnode - a leafsite NNTP server (version %version)
Summary(de): Leafnode - ein offline-Newsserver (Version %version)
Name: leafnode
Release: 0
Copyright: see COPYING
Group: Applications/News
Source: http://mandree.home.pages.de/leafnode/beta/leafnode-%version.tar.bz2

%define prefix      /usr
%define spooldir    /var/spool/news
%define confdir     /etc/leafnode
%define lockdir     /var/lock/news
%define lockfile    %{lockdir}/fetchnews.lck
%define runas_user  news
%define runas_group news

# Distribution: ${DISTRIBUTION}
Buildroot: /var/tmp/leafnode-%version-buildroot/
Packager: Matthias Andree <matthias.andree@gmx.de>
%description
Leafnode is a small NNTP server for leaf sites without permanent
connection to the internet. It supports a subset of NNTP and is able to
automatically fetch the newsgroups the user reads regularly from the
newsserver of the ISP.

%description -l de
Leafnode ist ein offline-Newsserver, der vor allem für den typischen
Einzelnutzer-Rechner ohne permanente Internetanbindung geeignet ist.
Leafnode bezieht automatisch die Newsgroups, die der oder die Nutzer
regelmäßig lesen, vom Newsserver des Providers.

%prep
%setup -q
CFLAGS="$RPM_OPT_FLAGS" ./configure --prefix=%prefix --mandir=%_mandir \
 --with-spooldir=%spooldir --silent \
 --sysconfdir=%confdir --with-lockfile=%lockfile \
 --with-runas-user=%{runas_user} --with-runas-group=%{runas_group}

%build
make -s
make -s check

%install
# first clean out any prior aborted runs
[ "$RPM_BUILD_ROOT" != "/" ] && [ "x$RPM_BUILD_ROOT" != "x" ] && rm -rf $RPM_BUILD_ROOT
make  DESTDIR=$RPM_BUILD_ROOT install-strip
cp $RPM_BUILD_ROOT/%confdir/filters.example $RPM_BUILD_ROOT/%confdir/filters
cp $RPM_BUILD_ROOT/%confdir/config.example $RPM_BUILD_ROOT/%confdir/config

%files
%defattr(-,root,root)
%dir %attr(750,root,news) %confdir
%config(noreplace) %attr(640,root,news) %confdir/config
%config(noreplace) %attr(640,root,news) %confdir/filters
%attr(640,root,news) %confdir/config.example
%attr(640,root,news) %confdir/filters.example
%attr(755,root,root) %{prefix}/bin/newsq
%attr(755,root,root) %{prefix}/bin/leafnode-version
%attr(755,root,root) %{prefix}/sbin/applyfilter
%attr(755,root,root) %{prefix}/sbin/checkgroups
%attr(755,root,root) %{prefix}/sbin/leafnode
%attr(755,root,root) %{prefix}/sbin/rnews
%attr(755,root,root) %{prefix}/sbin/fetchnews
%attr(755,root,root) %{prefix}/sbin/texpire
%attr(775,%{runas_user},%{runas_group}) %dir %{lockdir}
%doc %_mandir/man1/*
%doc %_mandir/man5/*
%doc %_mandir/man8/*
%doc ChangeLog AUTHORS CREDITS FAQ INSTALL README TODO
%doc README.html
#%doc tools/*.pl
%attr(2755,%{runas_user},%{runas_group}) %spooldir

%clean
[ "$RPM_BUILD_ROOT" != "/" ] && [ "x$RPM_BUILD_ROOT" != "x" ] && rm -rf $RPM_BUILD_ROOT
