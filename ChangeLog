2002-09-07  Matthias Andree <matthias.andree@gmx.de>

	* fetchnews.c: Add FIXME comment.  
	* TODO: Update TODO.  
	* TODO, fetchnews.c: Fix race in fetchnews, obtain the lock prior
	to reading the active file, so that we only read a current active
	file. Found by Ralf Wildenhues.  Other programs seem to do the right
	thing.  
	* NEWS, TODO, config.table, configutil.c: Drop fqdn option.
	Hostname is sufficient.  
	* TODO: Note fix of extraneous :active.read update.  
	* NEWS, TODO, fetchnews.c, miscutil.c: Drop backup.moderated.  
	* configure.ac: Bump version.  
	* nntpd.c: Fix CVSTrac #2: XOVER offers pseudo article that ARTICLE
	cannot retrieve.  Note: the article number of the pseudo article may
	still need to be bumped to 1 above the "last" mark.  
	* fetchnews.c: Fix CVSTrac #5 ":active.read is always updated." 

2002-09-05  Matthias Andree <matthias.andree@gmx.de>

	* TODO: Add a dormant.groups crosspost quirk found by Ralf.  

2002-09-04  Matthias Andree <matthias.andree@gmx.de>

	--- release snapshot-20020904a ---

2002-09-03  Matthias Andree <matthias.andree@gmx.de>

	* ChangeLog, TODO, store.c: snapshot 20020904a 
	* configure.ac: bump version 
	* store.c: Fix storing crossposted articles. Bug reported by Jörg
	Dietrich <joerg@dietrich.net>. To fix broken .overview files, just
	remove them all, they will be recreated as they are needed. Command: 
	find /var/spool/news -name .overview -exec rm '{}' ';' CVSTrac: #4.  

2002-09-02  Matthias Andree <matthias.andree@gmx.de>

	* activutil.c: Fix crash when inserting a group that was already
	present but had no description.  
	* leafnode.spec.in: update somewhat. not quite there.  
	* ChangeLog: update 

	--- release snapshot-20020902a ---
	* NEWS: Explain new single-pass store scheme (without fixxover).  
	* fetchnews.c: Drop [g]fixxover(), store creates .overview lines
	for us.  Let go of fork(), no longer needed.  
	* queues.c: Drop [g]fixxover(), store creates .overview lines for
	us. Drop rbtree that tracks which groups were changed.  
	* rnews.c, xoverutil.c, leafnode.h: Drop [g]fixxover(), store
	creates .overview lines for us.  
	* store.c: Write .overview lines ourselves.  
	* README.html: Change PCRE version to 3.9 
	* leafnode.h, xoverutil.c: Export getxoverline().  
	* configure.ac: bump version.  

2002-09-01  Matthias Andree <matthias.andree@gmx.de>

	* configure.ac, nntputil.c: Don't try gai_strerror() unless it's
	defined. Do not assume HAVE_GETADDRINFOimplies HAVE_GAI_STRERROR.
	Reported by  Leopold Toetsch <lt@toetsch.at> 

2002-09-01  Joerg Dietrich <joerg@dietrich.net>

	* queues.c: Fix argument to log_moveto() passed from
	feedincoming(). Report by Robert Marshall
	(<3D708376.BeroList-2.5.9@wpxx02.toxi.uni-wuerzburg.de>).  

2002-08-28  Matthias Andree <matthias.andree@gmx.de>

	* mailto.c: Add FIXME: comment to mailto(): want To: header.  

2002-08-27  Matthias Andree <matthias.andree@gmx.de>

	* store.c: Add FIXME: comment 

2002-08-24  Matthias Andree <matthias.andree@gmx.de>

	* configure.ac: bump version 

2002-08-23  Ralf Wildenhues <ralf.wildenhues@gmx.de>

	* nntpd.c: Fix XOVER reply for pseudo article:  inconsistent MID
	given.  

2002-08-22  Matthias Andree <matthias.andree@gmx.de>

	--- release snapshot-20020823a ---

2002-08-21  Joerg Dietrich <joerg@dietrich.net>

	* TODO: Update 
	* nntpd.c: dopost: Check that Newsgroups: contains at least one
	valid group; fix bug in previous patch where article was unlinked
	from in.coming instead of out.going 

2002-08-20  Matthias Andree <matthias.andree@gmx.de>

	* fetchnews.c: even more detailed XOVER stats logging.  
	* fetchnews.8.in, leafnode.8.in, rnews.8.in, texpire.8.in: tack
	leafnode onto @sysconfdir@ 
	* applyfilter.8.in: update, tack leafnode onto @sysconfdir@ 
	* filters.example: document that maxcrosspost is not too efficient 

2002-08-19  Matthias Andree <matthias.andree@gmx.de>

	* fetchnews.c: Don't include XOVER-filtered count in post-download
	killed count.  
	* filterfile.5.in: Add efficiency section 
	* leafnode.8.in: fix reference to filterfile 
	* configure.ac: bump version 
	* fetchnews.c: Log (severity: INFO) how many articles doxover() has
	filtered on pseudo headers.  
	* config.example, leafnode.h, ln_log.c, miscutil.c: Only log and
	print debug messages if debugmode requires this.  
	* nntpd.c: Merge patch by Jörg Dietrich. If leafnode has moderator
	addresses for non-local groups configured, the article is sent to
	the moderator by leafnode, but also left linked in out.going, so the
	first upstream will send it to the moderator again -- who is then
	getting duplicates. This patch unlinks the article from out.going
	and fixes this issue.  
	* TODO: groupinfo update vs. multiple signals bug fix confirmed.  

2002-08-16  Matthias Andree <matthias.andree@gmx.de>

	* TODO: Add report by Peter.Holm@gmx.at 

2002-08-13  Ralf Wildenhues <ralf.wildenhues@gmx.de>

	* store.c, xoverutil.c: Make toupper argument unsigned char.
	* getline.c, mastring.c, xoverutil.c: forward port fixes to
	mastr_cpy, mastr_cat and improvements to _getline, mastr_getln
	reported by Fabrizio Tironi from leafnode-1.9.
	* redblack.c: Remove superfluous nested function decl.
	* TODO: Identify race in fetchnews.  Update.

2002-07-22  Ralf Wildenhues <ralf.wildenhues@gmx.de>

	* nntpd.c: Now really fix showing pseudo article count with 'GROUP
	new.group'.  Reported by Jeff Grossman.
	* getwatermarks.c, nntpd.c: Work around for not shown pseudo
	article.  This should be fixed once and for all, but isn't yet.
	* TODO: Update.
	* fetchnews.c: Typo in usage message.

2002-07-18  Matthias Andree <matthias.andree@gmx.de>

	* Doxyfile: regenerated with doxywizard 1.2.17

2002-07-16  Matthias Andree <matthias.andree@gmx.de>

	* fetchnews.c: Change cannot stat .../:active.read message.
	LNLOG_SDEBUG and additional explanation for ENOENT case which is
	expected.
	* NEWS: [no log message]

2002-07-16  Ralf Wildenhues <ralf.wildenhues@gmx.de>

	* nntpd.c: Unconditionally query markgroup in case of an empty
	article; improve message.  Before, an article crossposted to a
	delaybody and a non-delaybody group could be marked in the latter,
	causing it not to be downloaded at all.

2002-07-16  Matthias Andree <matthias.andree@gmx.de>

	* draft-ietf-nntpext-base-15.txt, draft-ietf-usefor-article-07.txt:
	Add current IETF drafts for convenience.
	* configure.ac: Check if gai_strerror() is present and can be
	linked against. If not, disable IPv6 support. Reported by Leopold
	Tötsch <lt@toetsch.at>.
	* nntpd.c: Reflect rejected Message-ID in 441 message.

2002-07-15  Matthias Andree <matthias.andree@gmx.de>

	* configure.ac: bump version 
	* fetchnews.c: fix timeout_active handling 
	* TODO: add note about multithreaded fetch 
	* activutil.c, artutil.c, checkgroups.c, interesting.c, leafnode.h,
	log_unlink.c, nntpd.c, queues.c, rnews.c, store.c, texpire.c,
	xoverutil.c: log_unlink() now has an option to ignore ENOENT
	errors.  

2002-07-12  Matthias Andree <matthias.andree@gmx.de>

	* Makefile.am, NEWS: No longer install lsort.  

2002-07-11  Matthias Andree <matthias.andree@gmx.de>

	* nntpd.c: Fix signedness in generateMessageID. In the same go,
	bump the offset quite a bit and do a sanity check on the time stamp.  

2002-07-11  Ralf Wildenhues <ralf.wildenhues@gmx.de>

	* activutil.c, applyfilter.c, checkgroups.c, configutil.c,
	dirutil.c, fetchnews.c, interesting.c, leafnode.h, log_moveto.c,
	lsort.c, miscutil.c, moderated.c, newsq.c, nntpd.c, queues.c,
	rnews.c, store.c, sync_dir.c, texpire.c, xoverutil.c: Replace
	PATH_MAX with LN_PATH_MAX, #defined to (PATH_MAX+1).  Use mastr
	buffers instead of fixed-size in many places.  Change parseopt() to
	malloc conffile.
	* checkgroups.c applyfilter.c: Fix some memleaks. 
	* configutil.c: Fix possible overrun in parse_line, strncpy result
	was not 0-terminated.
	* miscutil.c: chdirgroup: possible overrun fixed, mallocs storage now.
	Change this _portably_ and _safe_ if it hurts perfomance.
	* nntpd.c: GROUP bogus.group may not change current group.
	LISTGROUP other.group did not work.

2002-07-10  Matthias Andree <matthias.andree@gmx.de>

	* nntpd.c: Change , in Message-ID local part to x to fix RFC-822
	violation. Reported by Ralf the Bug Hunter.

2002-07-09  Ralf Wildenhues <ralf.wildenhues@gmx.de>

	* fetchnews.c: minor optimization: replace 'strcspn(s, t) ==
	strlen(s)' with '!strpbrk(s, t)'.
	* miscutil.c: Supply log argument.

2002-07-08  Matthias Andree <matthias.andree@gmx.de>

	* store.c: Fix spurious %m in store_err().
	* fetchnews.c: Rename write_pseudo_header to store_pseudo_header,
	because it calls store().
	* queues.c: Fix moving failed articles into failed.postings.
	Reported by Mike Castle <dalgoda@ix.netcom.com>.
	* miscutil.c: Log non-regular files in message.id/XXX/
	* cmp_firstcolumn.c: Add some documentation.
	* tools/Makefile.am: Put simple-batcher.sh into EXTRA_DIST.
	* tools/simple-batcher.sh: Add this el-cheapo rnews batcher, good
	for testing. Documentation inside.

2002-07-08  Ralf Wildenhues <ralf.wildenhues@gmx.de>

	* cmp_firstcolumn.c: cmp_firstcolumn: fast version.

2002-07-08  Matthias Andree <matthias.andree@gmx.de>

	* README.html: Add notes about automatically appending the leafnode
	path to sysconfdir, drop --with-runas-group documentation.
	* configure.ac: Add notes about automatically appending the
	leafnode path to sysconfdir all over the place, and strip trailing
	/leafnode or /leafnode/ in sysconfdir for compatibility.
	* NEWS: Document new sysconfdir behaviour.
	* INSTALL: INSTALL was outdated, current information on how to
	install leafnode is now in README. Point the user there.
	* Makefile.am: Add sysconf_DATA to EXTRA_DIST.
	* update.sh: Use id -u rather than cut and go figure RUNAS_GROUP
	ourselves
	* miscutil.c: Remove RUNAS_GROUP, did not work anyhow. Use primary
	group of RUNAS_USER, and check that group and user id are not zero.
	* leafnode.h: change libdir misnomer to sysconfdir. Drop
	RUNAS_GROUP, use primary group of RUNAS_USER instead.
	* Makefile.am, filters.example: Add filters.example. Change
	sysconfdir handling again.
	* configutil.c, fetchnews.c, rnews.c: change libdir misnomer to
	sysconfdir. drop sys/resource.h.
	* checkgroups.c: drop sys/resource.h
	* activutil.c, applyfilter.c, leafnode-version.c, localutil.c,
	moderated.c, nntpd.c, texpire.c: change libdir misnomer to
	sysconfdir
	* Makefile.am: LIBDIR -> SYSCONFDIR
	* Makefile.am, configure.ac: Drop RUNAS_GROUP, it's hosed. Let
	Makefile.am add the leafnode suffix to sysconfdir rather than
	configure.ac
	* Makefile.am, cmp_firstcolumn.c, fetchnews.c, leafnode.h: Rename
	cmp_upstream to cmp_firstcolumn and put it into a separate file.

2002-07-08  Ralf Wildenhues <ralf.wildenhues@gmx.de>

	* fetchnews.c, miscutil.c: initfile now does not touch the line it
	puts into the rbtree.  cmp_upstream compares the first word of both
	keys ignoring case.  Separators are space and tab.  This is slower,
	but less error-prone.

2002-07-08  Matthias Andree <matthias.andree@gmx.de>

	* fetchnews.c: Never fetch newsgroup descriptions from a server
	with "nodesc" set.
	* fetchnews.c: Drop SIGALRM handling. It was only needed for
	locking, which does now handle timeouts itself.
	* redblack.c, redblack.h: Update libredblack to 1.2.
	* NEWS, TODO, miscutil.c: Only change permissions/owner of leafnode
	directories when creating them. Requested by Kevin Bulgrien.
	* nntpd.c: Fix sockaddr/sigaction "sa" name clash.
	* TODO: [no log message]
	* fetchnews.c, nntpd.c, timeout_getaline.c: Use sigaction and
	SA_RESTART, in the hope to avoid any EINTR issues and signals
	restored to SIG_DFL on SVR4.
	* config.example: Add warning to only_fetch_once.
	* nntpd.c: Fix checking wrong part of message-ID bug in
	validate_messageid. Found & fixed by Mike Castle
	<dalgoda@ix.netcom.com>.

2002-07-07  Ralf Wildenhues <ralf.wildenhues@gmx.de>

	* fetchnews.c: getmarked: ugly hack to preserve 'MID artno' line in
	case of failure.  nntpactive: Do not log 'getting newsgroup
	descriptions' in case of nodesc.  processupstream: better logging,
	do not fail with new server.
	* miscutil.c: initfilelist replaces all spaces and tabs with 0,
	screams if none found.
	* fetchnews.c: Fix comment in getgroup, count and output total
	number of pseudo headers fetched.
	* TODO: Update.
	* fetchnews.c: getgroup:  Fallback from XOVER to XHDR should work
	now.
	* fetchnews.c: main/processupstream:  If only_fetch_once is set,
	maintain a rbtree of successfully fetched groups.  Do not fetch
	twice, but preserve as much state from previous fetchnews runs in
	leaf.node/server for all interesting groups.
	* config.example, config.table, configutil.c, leafnode.h: New
	configuration option only_fetch_once (boolean).  If set, groups
	will not be fetched from several servers, only if a server failed.
	* miscutil.c: Change semantics of new function initfilelist: 
	replace all spaces in redblack key with \0.
	* leafnode.h, miscutil.c: New function initfilelist reads nonempty
	lines of an open FILE into redblack tree.  Must provide custom
	comparison function and extra data.
	* fetchnews.c: New function getmsgidlist moves -M functionality out
	of do_server.  Better logging.
	* nntpd.c: Fix is*(char) signedness issues in validate_messageid.
	* fetchnews.c: Make doxhdr really return -2 if XHDR is not
	available.  getgroup:  Implement fall back to XHDR if XOVER not
	available and no filtering or delaybody wanted.

2002-07-06  Ralf Wildenhues <ralf.wildenhues@gmx.de>

	* TODO: Update.
	* fetchnews.c: Doxygenification.  Fix possible null deref in
	doxover.  Pretty-print debug output messages for pseudo headers.
	* fetchnews.c: Bugfixing round 1.  processupstream:  insert
	cmdline-specified group before reading rbtree.	process_options: 
	no pattern in nglist already means all.  write_pseudo_header:  log
	errors, counting successful stores work.  getgroup:  enhanced
	logging of fetched headers.
	* fetchnews.c, leafnode.h, interesting.c: Really implement
	fetchnews'  -N un.interesting.group [ ... ] by adding the group
	name to the interesting rbtree, new function addtointeresting.

2002-07-06  Matthias Andree <matthias.andree@gmx.de>

	* config.example: Drop "dontpost" option. Replaced by
	"feedtype=none".  
	* fetchnews.c: Drop "dontpost" option. Replaced by "feedtype=none".
	Implement "feedtype" selector.  
	* config.table, configutil.c, leafnode.h: Drop "dontpost" option.
	Replaced by "feedtype=none".  
	* config.example, config.table, configutil.c, leafnode.8.in,
	leafnode.h: New server-specific configuration option: "feedtype".
	Can be nntp, uucp or none. Case insensitive.  

2002-07-06  Ralf Wildenhues <ralf.wildenhues@gmx.de>

	* nntpd.c: Squish bogus compiler warning in getmarkgroup 
	* fetchnews.c: Major rewrite of the upper layers.  Copes with
	delaybody groups now.  Can handle multiple -M <MID> options now,
	multiple -N newsgroup and -N news.groups.pattern, can fine-tune
	download of delayed bodies, headers and regular articles.  Move
	functionality from main to small functions process_options, 
	deactivate_server, find_server, insert_server, print_fetchnews_mode, 
	make use of create_server.  Move subtasks of doxover in functions
	create_pseudo_header, write_pseudo_header, make use of
	parsekill_xref_line.  Implement orthogonal handling of -[BHPR]
	options.  Remove legacy fopenmsgid, join functionality of do_group
	in processupstream.  Rewrite do_server to handle errors gracefully
	and get multiple MIDs.  Reset signal handlers for SIGTERM and
	SIGALRM after fetching, update output counts.  
	
	TODO: output for stored delaybody headers not correct, few error
	checks missing.  fix forceactive handling.  
	* artutil.c, leafnode.h, nntpd.c: New function parsekill_xref_line,
	which reads an Xref: header line, null-terminated newsgroup and
	article number strings and creates array of pointers to these
	strings.  Returns the number of groups found or -1 for error.  Use
	parsekill_xref_line for a cleaner rewrite of supersede_cancel and 
	getmarkgroup.  
	* leafnode.h, nntpd.c, xoverutil.c: New function getxoverfield
	returns one of the xover headers.  Renumber enum xoverfields for
	consistent usage, do not use cuttab directly.  
	* configutil.c, leafnode.h: New function create_server creates a
	serverlist entry with default values.  Factors out common
	functionality.  
	* leafnode.h, miscutil.c: Forward port lfindinlist, replaceinlist
	and prependtolist from 1.9.23.pre3, add new function removefromlist.
	Call with argument &(successor->next); 

2002-07-05  Matthias Andree <matthias.andree@gmx.de>

	* nntpd.c: euhm, cannot tell , from +...  
	* nntpd.c: Change first MID separator to , to allow tracking
	leafnode "after 2.0b8_ma10pre4" vs. "old leafnode" 
	* fetchnews.c: Fix empty else body compiler warning.  

2002-07-05  Ralf Wildenhues <ralf.wildenhues@gmx.de>

	* nntpd.c: getmarkgroup:  also look at Xref for other interesting
	groups in delaybody mode if current group is not suitable. 
	doarticle: improved error message if marking failed.
	* nntpd.c: New function getmarkgroup to find out where to mark
	article.  Parses Xref line to make 'ARTICLE MID' work.	Currently
	only successful if article is found in current group and current
	group is in delaybody mode.  markdownload: store MID and article
	number.  doarticle: fix possible NULL deref, make use of
	getmarkgroup.
	* fetchnews.c: getmarked: expect Message-ID and article number in
	groups.file, silently drop all badly formatted lines, lines with
	article number 0 or with nonexistent pseudo articles.  Prevents
	repeated download of crossposts.  getgroup: change to group dir
	before getting marked articles.

2002-07-04  Ralf Wildenhues <ralf.wildenhues@gmx.de>

	* README.html, applyfilter.c, config.example, config.table,
	configutil.c, fetchnews.c, leafnode.8.in, leafnode.h, miscutil.c,
	nntpd.c, queues.c, rnews.c, store.c: Revive delaybody.	Add new
	configuration option
	  groupdelaybody = group.pattern.*
	which will enable delaybody for all groups matching.  The global
	option delaybody will override, if set to 1.
	store() and store_stream() take an extra argument delayflg, 1 for the
	pseudo head, 2 for the delayed article, 0 for default mode.
	Pseudo article will be killed (all links) by supersede_cancel after
	successful download of delayed article.  nntpd will store Message-IDs
	for all bodies requested in a delaybody group.  Special treatment to
	crossposts is not provided.  fetchnews will load all requested bodies,
	headers via XOVER only.
	* nntpd.c: domove: Fix NEXT and LAST, when groupinfo numbers are
	incorrect.  Current article number is set only if there is a valid
	article.
	* nntpd.c: On LISTGROUP non.existent.group, don't invalidate
	current valid group.
	* store.c: Don't add Xref: entry for bogus (i.e. rmgroup'ed) group.
	* rnews.c: Portability:  no empty switch case.
	* artutil.c, checkgroups.c, configutil.c, fetchnews.c, filterutil.c,
	leafnode.h, miscutil.c, store.c, xoverutil.c: Consistently use
	SKIP*() macros instead of while(isspace(p)) etc.  Fixes several
	potential array bounds reads in rare cases.
	* nntpd.c: Use news@fqdn as pseudo article author.  Partly done in
	last checkin already.

2002-07-04  Matthias Andree <matthias.andree@gmx.de>

	* configure.ac, Makefile.am: Drop CAT.

2002-07-03  Ralf Wildenhues <ralf.wildenhues@gmx.de>

	* applyfilter.c, getwatermarks.c, store.c, xoverutil.c: Never lower
	high water mark, not even on empty group.  It breaks clients
	detection of new articles.  Forward port from leafnode-1 bugfixes.
	* nntpd.c: Simplify list, make use of SKIPWORD in dolist.  Fix
	NEWGROUPS low/high output, remove white space from LISTGROUP
	output.  Fix output of pseudo article number.  Do not reset water
	marks on pseudo or empty group.
	* store.c: Fix some of the "trying to read across EOF" for rnews. 
	Minor optimization in header parsing.
	* rnews.c: Remove lockfile in error case.
	* fetchnews.c: Quick hack for exit status and correct display of
	fetched articles for 'fetchnews -M MID'.  Needs rewrite.

2002-07-03  Matthias Andree <matthias.andree@gmx.de>

	* configure.ac: bump version
	* TODO: update

2002-07-03  Ralf Wildenhues <ralf.wildenhues@gmx.de>

	* Makefile.am: Revive Distribution of rnews.

2002-07-03  Matthias Andree <matthias.andree@gmx.de>

	* Makefile.am: add missing version.h 
	* mastring.c, mastring.h, version.h: Synchronize leafnode-1 and
	leafnode-2 mastring.* 
	* Makefile.am, rnews.c: Bugfix and revive rnews.c 
	* fetchnews.c: Fix some excess LF in ln_log.  
	* store.c: Fix tons of bugs with maxbytes, found by implementing
	rnews. Drop getaline in maxbytes modes. Use new mastr_len rather
	than directly accessing ...->len.  
	* leafnode.h: Fix C++ clashes.  
	* rnews.8.in: update 
	* mastring.c, mastring.h: Add mastr_len(), hide structure members
	to impair direct access. It's not strict data hiding, but close
	enough.  
	* mastring.c, mastring.h: Forward port leafnode-1 mastr_size.
	Forward port leafnode-1 C++ fix. mastr_getln: use maxbytes+1 because
	_getline gets the buffer size, not the amount of characters to read;
	bump buffer to 4k; write NUL at the right position now.  
	* lsort.c: Drop debug variable. Use debugmode instead. Drop verbose
	variable, it's in the library.  
	* configutil.c: Drop debug variable. Use debugmode instead. Don't
	override debugmode (may be set by command line), but OR into it.  
	* applyfilter.c, artutil.c, checkgroups.c, dirutil.c, fetchnews.c,
	getaline.c, getfoldedline.c, leafnode.h, localutil.c, miscutil.c,
	newsq.c, nntpd.c, nntputil.c, parserange.c, strutil.c, texpire.c,
	xoverutil.c: Drop debug variable. Use debugmode instead.  
	* config.example, leafnode.h: New DEBUG_STORE 
	* mastring.c: avoid passing 0 size to _getline. Bug introduced with
	last commit.  
	* mastring.c: NUL-terminate string in mastr_getln for C string
	compatibility.  

2002-06-30  Matthias Andree <matthias.andree@gmx.de>

	* nntpd.c: Do not write 400 message down the socket when the client
	disconnects. It's not out failure either when the client kicks the
	bucket while posting, so exit(0).  

2002-06-30  Ralf Wildenhues <ralf.wildenhues@gmx.de>

	* miscutil.c: rfctime: use portable part of strftime for Date:
	header.
	* nntpd.c: dopost: On premature EOF after POST, exit with failure
	and logging for both header and body part.  Remove redundant \r\n
	stripping from input -- done in getaline.

2002-06-29  Ralf Wildenhues <ralf.wildenhues@gmx.de>

	* fetchnews.c, lockfile.c, lsort.c, xoverutil.c: Replace all strcat.

2002-06-29  Matthias Andree <matthias.andree@gmx.de>

	* nntpd.c: Let nntpprintf look at DEBUG_NNTP rather than DEBUG_IO.
	Fix formatting of command log in main_loop.
	* putaline.c: Look at debugmode, not at debug. Leafnode code that
	changes debug levels should be dropped.

2002-06-28  Ralf Wildenhues <ralf.wildenhues@gmx.de>

	* leafnode.h, nntpd.c, xoverutil.c: New function matchxoverfield
	for mapping "Header:" to enum xoverfield, which has a new error
	state.	Use mapping to clean up getxoverline and doselectedheader. 
	doarticle micro optimization.
	* Makefile.am, README.html, leafnode.spec.in, update.sh: Document
	and consistently set user and group under which leafnode runs. 
	manpages still need updating.

2002-06-26  Matthias Andree <matthias.andree@gmx.de>

	* filterutil.c: drop bogus static in findinheaders
	* .indent.pro: drop double options
	* xoverutil.c: reindent

2002-06-24  Ralf Wildenhues <ralf.wildenhues@gmx.de>

	* leafnode.h, miscutil.c: Remove old 'struct msgidtree' stuff,
	saves around 100 LoC.
	* nntpd.c: doarticle: no need for \n removal any more -- done by
	getaline.
	* fetchnews.c: Cleanup of main() -- use volatile for setjmp
	affected variables, simplify getopt processing.

2002-06-23  Matthias Andree <matthias.andree@gmx.de>

	* nntpd.c: Unbreak previous fgets->getaline migration.
	* nntpd.c: Get rid of the last fgets() caller. In doarticle, get
	rid of static buffer.
	* leafnode.h, lockfile.c: New lockfile_exists prototype,
	lockfile_exists is always blocking. New function handover_lock.
	From leafnode-1.
	* applyfilter.c, checkgroups.c, fetchnews.c, texpire.c: New
	lockfile_exists prototype, lockfile_exists is always blocking. From
	leafnode-1.
	* TODO: [no log message]
	* activutil.c: Also copy the 'count' member. Reported by Ralf
	Wildenhues.

2002-06-22  Matthias Andree <matthias.andree@gmx.de>

	* getaline.c: Fix ln_log severity.
	* getaline.c: Ignore incomplete lines (without trailing LF).
	Suggested by Mirko Liss.
	* nntpd.c: Major cleanup of dogroup(). is_pseudogroup now also
	returns true for empty groups not in interesting; since introduction
	of .last.posting in 2.0b8_ma7.4pre on 2001-10-05, this has been
	broken. As consequence, groups that expired from the spool and from
	interesting.groups could not be subscribed to with slrn. Reported by
	Ralf Wildenhues.  
	* texpire.c: new function texpire_log_unlink 
	* Makefile.am, fetchnews.c, interesting.c, leafnode.h, miscutil.c: 
	Move handling of interesting.groups into interesting.c 

2002-06-21  Matthias Andree <matthias.andree@gmx.de>

	* config.example, config.table, configutil.c, leafnode.h, nntpd.c: 
	The killbogus parameter is gone. nntpd should not clean up, but
	texpire.  

2002-06-19  Ralf Wildenhues <ralf.wildenhues@gmx.de>

	* nntpd.c: doxover: don't read uninitialized range if pseudogroup.  
	doauth_file: comment typo.  
	* getaline.c, getline.c, mergesort.c: Compatibility: We provide
	getline ourselves, so the code is not _GNU_SOURCE.  mergesort needs
	proprietary _BSD_SOURCE because of u_char.  
	* configure.ac: No need to test for search.h any more.  
	* nntpd.c: Make 'XOVER' on pseudogroup return the right article
	number.  

2002-06-19  Matthias Andree <matthias.andree@gmx.de>

	* redblack.h: drop <search.h> for dietlibc compatibility 

2002-06-19  Ralf Wildenhues <ralf.wildenhues@gmx.de>

	* nntpd.c: doselectedheader: extract Xref header from overview file
	instead of searching the article headers for XHDR and XPAT.  

2002-06-18  Ralf Wildenhues <ralf.wildenhues@gmx.de>

	* Makefile.am, TODO, configure.ac, leafnode.h, miscutil.c: 
	Configure options --with-runas-user and --with-runas-group to allow
	leafnode to run under as different user.  Default to 'news'.  
	* fetchnews.c: General clean up of processupstream.  Fix: After
	'fetchnews -N some.group' the server info file contained only
	information about this group.  Now write back old information for
	all other groups.  Use log_fclose for the newly written file, so
	write errors are logged.   Fix name checking for 'fetchnews -N'.
	* fetchnews.c: Fix not requesting server again on successful
	'fetchnews -M <MID>'.  
	* fetchnews.c: Few more string literal formatting reverted.  
	* ENVIRONMENT: Document STOP_AT_MESSAGEID.  
	* nntpd.c: Simplify doselectedheader using matchlist and cuttab.  
	Another unnecessary formatting fix reverted.  
	* leafnode.h, miscutil.c: New function matchlist matches one string
	against a stringlist of patterns.  

2002-06-16  Matthias Andree <matthias.andree@gmx.de>

	* nntpd.c: Merge missing bits before Ralf's 1.58.  

2002-06-16  Ralf Wildenhues <ralf.wildenhues@gmx.de>

	* nntpd.c: Use findxoverrange to exploit possible sparsity of
	.overview with respect to article numbers for commands XOVER, XPAT
	and XHDR within doxover and doselectedheader (even for non- overview
	headers, since the overview is read anyway).  Remove duplicate code
	block in dopost which made POST fail.  
	* leafnode.h, xoverutil.c: New function findxoverrange takes a pair
	of article numbers and finds the index interval of xoverinfo
	matching these articles.  Export xcount in leafnode.h.  
	* bsearch_range.h, Makefile.am, bsearch_range.c: New function
	bsearch_range searches a sorted array the way bsearch(3) does. 
	Receives a pair of ordered keys and returns pointers to the smallest
	and largest element within the given key range.  On error or empty
	match, one of the pointers given back will be NULL.  

2002-06-15  Ralf Wildenhues <ralf.wildenhues@gmx.de>

	* xoverutil.c: fix buggy forward port: xoverinfo is not indexed by
	artno-xfirst in leafnode-2, unlike leafnode-1.  

2002-06-14  Matthias Andree <matthias.andree@gmx.de>

	* nntpd.c: New feature: no_direct_spool, to store local posts into
	the local spool only after it has been received from the upstream.
	(1.9 behaviour).  Robustness: only schedule article for local
	posting if it has been received and validated (store into temp.files
	rather than in.coming).  
	* config.example, config.table, configutil.c, leafnode.h: New
	feature: no_direct_post, to store local posts into the local spool
	only after it has been received from the upstream. (1.9 behaviour).  
	* leafnode.h, localutil.c: Speed up is_alllocal(). Add
	is_anylocal().  
	* newsq.c: Print Date and Message-ID as well.  
	* nntpd.c: Fix off-by-one error in malloc in validate_messageid().
	Found by glibc's MALLOC_CHECK_=2.  

2002-06-03  Matthias Andree <matthias.andree@gmx.de>

	* getfoldedline.c: Never try to unfold after a . line 

2002-06-02  Matthias Andree <matthias.andree@gmx.de>

	* miscutil.c: Apply patch by Raymond Scholz, to fix broken hostname
	resolver.  

2002-05-08  Matthias Andree <matthias.andree@gmx.de>

	* getwatermarks.c: Do proper checking of strtoul results. Bug found
	and fix suggested by Ralf Wildenhues.  

2002-05-06  Matthias Andree <matthias.andree@gmx.de>

	* validatefqdn.c, validatefqdn.h: No longer shadow the global
	"fqdn" variable.

	* checkgroups.c, fetchnews.c, leafnode.h, miscutil.c, nntpd.c,
	rnews.c, texpire.c, applyfilter.c: Initvars() now takes two
	arguments, the new one determines if validatefqdn is to complain to
	stdout in NNTP-style. Parameter bug in this context reported by
	Ralf Wildenhues.

	* Makefile.am: Pull @GCC_FLAGS@ (from configure.ac) into CFLAGS.
	Suggested by Ralf Wildenhues.

	* ChangeLog: Track changes. cvs2cl is not perfect though :-/

2002-05-05  Matthias Andree <matthias.andree@gmx.de>

	=== release-2.0b8_ma10pre3.2 ===
	* TODO: stricter Message-ID checking is now in place.  Done: "add
	COPYING".
	* autobootstrap.sh: Note that this file is public domain.
	* nntpd.c: More anal Message-ID domain part checking: reject posts
	without domain part, with unqualified domain part or with domain
	part that looks local.

	* COPYING: New file, mostly extracted from README.
	* applyfilter.c, checkgroups.c, fetchnews.c, leafnode.h,
	lockfile.c, nntpd.c, rnews.c, texpire.c: Change lockfile timeout
	handling. lockfile_exists() now takes care of timing out itself, to
	fix left-behind temporary files.

	* .cvsignore: Add ChangeLog.emma.
	* applyfilter.c, checkgroups.c, fetchnews.c, nntpd.c, texpire.c:
	Move whoami() call to initvars.

	* miscutil.c: Use validatefqdn.c and validatefqdn.h from
	leafnode-1.

	* leafnode.h: Drop whoami() prototype.
	* ENVIRONMENT: Add documentation on LN_DEBUG_QUALIFICATION.
	* Makefile.am, validatefqdn.c, validatefqdn.h: Use validatefqdn.c
	and validatefqdn.h from leafnode-1.

	* artutil.c: When canceling or superseding, make ENOENT a DEBUG
	message. It may be that the original article has not been
	downloaded at all.

2002-05-03  Matthias Andree  <matthias.andree@gmx.de>

	* filterutil.c: When checking against maxcrosspost, do not free a
	variable we incremented, but store the original pointer and free
	that instead. Fixes SIGSEGV.

2002-05-01  Ralf Wildenhues <ralf.wildenhues@gmx.de>

	* filterutil.c: killfilter copes with folded Newsgroups: header. 
	* artutil.c, leafnode.h: mgetheader operates on constant strings.

	* activutil.c, artutil.c, fetchnews.c, filterutil.c, log_moveto.c,
	miscutil.c, moderated.c, newsq.c, nntpd.c, store.c, xoverutil.c:
	mastr_vcat calls now 64 bit clean.

	* nntpd.c: output of markdownload error (forward port from 1.9). 
	Free dormant groups data in main.

2002-04-28  Ralf Wildenhues <ralf.wildenhues@gmx.de>

	* fetchnews.c, leafnode.h, miscutil.c: cleanup handling of
	interesting.groups and dormant.groups (could still be improved).
	Remove critinit* functions, let the caller decide to die.

	* store.c: store_stream now copes with folded Newsgroups: header.
	Use switch to speed up header parsing.
	Note: dopost still rejects Newsgroups: header with spaces or folds
	between the first group name and the end of the last fold
	continuation line (folding before the first group is not rejected).

	* applyfilter.c, getfoldedline.c, leafnode-version.c, rnews.c: make
	const strings static, fix compiler warning.
	* activutil.c, newsq.c, nntpd.c: fix some 'char s[PATH_MAX]' bugs.
	* getline.h: unconditionally declare getline.
	* doc_german/man/man8/checkgroups.8: fix typo.

	* nntpd.c: reject POSTs with empty Newsgroups header.

2002-04-27  Ralf Wildenhues <ralf.wildenhues@gmx.de>

	* Makefile.am, fetchnews.c, leafnode.h, log_moveto.c, queues.c:
	function moveto renamed in log_moveto and placed in separate file. 
	queues.c: in case of store failure in feedincoming, log_moveto
	message to failed.postings.  Since store does not exhibit transient
	failure in general, this should be safe.

	* applyfilter.c: remove spurious sign warning.

	* configure.ac: test for strdup removed.
	* dirutil.c, lsort.c, masock_sa2addr.c, masock_sa2name.c,
	mkdir_parent.c, moderated.c: Replace all strdup with critstrdup.

	* nntpd.c: forward port error checking in markdownload.

2002-04-26  Matthias Andree  <matthias.andree@gmx.de>

	* TODO: "check for I/O errors in markdownload" is now fixed.
	* autobootstrap.sh: New quick and dirty file to regenerate
	Makefile.in and configure when the source has been checked out
	from CVS.

	* nntpd.c: Deescalate EOF-from-client syslog message from WARNING
	to DEBUG. It seems to be totally normal for NNTP clients to just
	disconnect without saying QUIT.

	* xoverutil.c: Allow STOP_AT_MESSAGEID to raise a SIGSTOP in
	store_stream.

	* store.c: Allow STOP_AT_MESSAGEID to raise a SIGSTOP in
	store_stream.

	* leafnode.h: Add debugutil.c support.
	* Makefile.am: Add debugutil.c.
	* getfoldedline.c: Bugfix: do not try to append the next line if
	the current line is empty. Impact: getfoldedline (for example, in
	getxoverline) would read past the empty line between news header
	and body if the body started with a tab or space character. Bug
	reported by Ralf Wildenhues.

	* debugutil.c: Initial checkin.
	* TODO: Add lacking markdownload error checking.
	* nntpd.c: Ralf Wildenhues: fix file descriptor leak when marking
	a body for download that had previously been marked already.
	* fetchnews.c: Revert broken timeout_active fix. Need to find
	something different.

2002-04-23  Matthias Andree  <matthias.andree@gmx.de>

	* config.table: Add timeout_client to complement Jonathan
	Larmour's timeout_client patch.

	* configutil.c: Merge the timeout_client patch by Jonathan Larmour
	<jlarmour@redhat.com>.

	* leafnode.h: Merge the timeout_client patch by Jonathan Larmour
	<jlarmour@redhat.com>.

	* timeout_getaline.c: Merge the timeout_client patch by Jonathan
	Larmour <jlarmour@redhat.com>.

	* touch.c: Rename touch() to touch_truncate().


2002-04-17  Matthias Andree  <matthias.andree@gmx.de>

	* nntpd.c: Ralf Wildenhues' fix to use size_t to check the length
	of the string. Minor modification: also check if length is >
	INT_MAX.  List PAT in HELP output.

2002-04-11  Matthias Andree  <matthias.andree@gmx.de>

	* AUTHORS: Add Volker Apelt.
	* texpire.c: Add dormant groups feature. Patch by Volker Apelt.
	* store.c: Add dormant groups feature. Patch by Volker Apelt.
	* nntpd.c: Add dormant groups feature. Patch by Volker Apelt.
	* miscutil.c: Add dormant groups feature. Patch by Volker Apelt.
	* leafnode.spec.in: Update .spec file, courtesy of Volker Apelt.
	* leafnode.h: Add dormant groups feature. Patch by Volker Apelt.
	* xoverutil.c: Forward port 1.9.x bugfix to update overview
	properly when articles are removed from between low and high water
	mark, exclusively.

	* miscutil.c: Drop HAVE_GMTOFF dependent external time zone
	declaration.

	* configure.ac: Drop HAVE_GMTOFF detection, no longer in use.
	* artutil.c: Let mgetheader commit suicide if the input is not
	LF-terminated. Document that LF termination is required.
	* Makefile.am: Package lclint_fixes.h as well.

2002-04-10  Matthias Andree  <matthias.andree@gmx.de>

	* applyfilter.c: Ralf Wildenhues: remove arbitrary limit on header
	length, fix possible SEGV, watermark calculation, always update
	active.  New option -n for dry mode (no deleting done), use with
	-v to see what would be deleted.

	* applyfilter.8.in: Ralf Wildenhues: fix documentation.  Ralf
	Wildenhues: document -n (dry-run) option.

	* artutil.c: Really fix.
	* artutil.c: Fix mgetheader infinite loop, found by Ralf
	Wildenhues.

2002-04-04  Matthias Andree  <matthias.andree@gmx.de>

	* gmtoff.c: Former gmtoff() versions forced the DST flag to 0, so
	the gmtoff() calculation as well as all generated RFC-2822 format
	dates had the wrong offset in locales that use daylight saving
	time. Reported by Ralf Wildenhues.

	* configutil.c: Ralf Wildenhues: patch to add missing free(mta) to
	freeconfig() (patch was accidentally omitted from 10pre3.1)

	* activutil.c: Ralf Wildenhues: fix file descriptor leak in
	readactive(). (patch was accidentally omitted from 10pre3.1)

	* nntpd.c: Ralf Wildenhues: implement DATE according to RFC
	2980. Freeinteresting not called.
	(patch was accidentally omitted from 10pre3.1)

	* texpire.c: Fix copyright.
	* texpire.c: Drop 'F' option handling (done in parseopt
	already). Make freexover() independent of chdirgroup(). Both
	reported by Volker Apelt.

	=== release 2.0b8_ma10pre3.1 ===
	* Makefile.am: Drop rnews.8 comment, confuses automake and emits
	bogus warning.

	* configure.ac: Update for autoconf v2.53.

2002-04-03  Matthias Andree  <matthias.andree@gmx.de>

	* config.table: Ralf Wildenhues: turn preferxhdr into usexhdr.
	* leafnode.h: Ralf Wildenhues: drop "avoidxover" variable.
	* configutil.c: Ralf Wildenhues: Make per server option usexhdr
	work, warn if used together with delaybody or filtering; fix
	possible buffer overrun (not exploitable).
	* leafnode.8.in: Ralf Wildenhues: update config docs, rename
	preferxhdr to usexhdr to match current documentation.
	* config.example: Ralf Wildenhues: update config docs, rename
	preferxhdr to usexhdr to match current documentation.
	* store.c: Ralf Wildenhues: fix typo in log message.
	* miscutil.c: Ralf Wildenhues: use switch in argument parser.
	* fetchnews.c: Ralf Wildenhues: use switch in argument parser.
	* fetchnews.8.in: Ralf Wildenhues: update man page, -N can only be
	used once.

	* config.example: Ralf Wildenhues: document pseudoarticle config
	option.

	* nntputil.c: Ralf Wildenhues: drop setjmp.h #include.
	* nntpd.c: Ralf Wildenhues: drop setjmp.h #include. Use switch in
	argument parser. dopost general cleanup.  Fix recognition of
	duplicate MIDs, fix Newsgroups: syntax check.  Do restrictive MID
	syntax check in validate_messageid.
	* checkgroups.c: Ralf Wildenhues: drop setjmp.h #include.
	* b_sortnl.c: Ralf Wildenhues: remove bogus const.
	* .indent.pro: Try to not format comments.
	* lclint_fixes.h: New file by Ralf Wildenhues.
	* xoverutil.c: Ralf Wildenhues: add SPLint annotations. Fix
	types. Plug memory leak.

	* timeout_getaline.c: Ralf Wildenhues: Fix types.
	* strutil.c: Ralf Wildenhues: add SPLint annotations. Fix
	types. Set freed pointers to NULL in free_strlist().
	* store.c: Drop excess whitespace.
	* redblack.c: Ralf Wildenhues: remove unnecessary declaration of
	cmpmods in rb_traverse.

	* queues.c: Ralf Wildenhues: fix memory leak.
	* putaline.c: Ralf Wildenhues: Add missing casts.
	* parserange.c: Ralf Wildenhues: fix possible memory leak.
	* nntputil.c: Ralf Wildenhues: add SPLint annotations. Fix types.
	* nntpd.c: print article number 0 in reply to ARTICLE <MID>
	according to NNTP draft. FIXME: what about workaround parsing
	Xref: for delaybody?  LIST EXTENSIONS now lists HDR, leafnode
	accepts HDR as well as XHDR
	(according to NNTP draft).  HELP now reports HDR as well as OVER as
	legal commands. dolist change in ma10pre3 passed bad pointer to
	free.  This bug caused leafnode to die on 'list newsgroups
	pattern*'.  add missing cast to time_t in donewnews and
	donewgroups. donewnews uses unsigned long article numbers.  in
	donewnews, freexover needs to be called instead of
	free(xoverinfo), and xovergroup set to NULL.  This bug resulted in
	memory leak on NEWNEWS and segfault on GROUP de.comp.lang.c; XOVER
	; NEWNEWS de.comp.lang.c 020202 020202 ; XOVER. return real group
	status instead of 'y' in donewgroups().  FIXME: Check if this
	breaks anything!

	* moderated.c: Ralf Wildenhues: add SPLint annotations. Add
	missing casts. Fix types.

	* miscutil.c: Ralf Wildenhues: add SPLint annotations. Type fixes.
	* mastrncpy.c: Ralf Wildenhues: 0 -> '\0'
	* mastring.h: Add license. Ralf Wildenhues: add SPLint
	annotations.

	* mastring.c: Add license. Ralf Wildenhues: add SPLint
	annotations.

	* mastrcpy.c: Ralf Wildenhues: 0 -> '\0'
	* masock_sa2name.c: Ralf Wildenhues: add SPLint annotations.
	* masock_sa2addr.c: Ralf Wildenhues: add SPLint annotations.
	* masock.h: Ralf Wildenhues: add SPLint annotations.
	* lsort.c: Ralf Wildenhues: Change exit(1) to
	exit(EXIT_FAILURE). Add some missing const keywords.
	* lockfile.c: Cast npid to pid_t.
	* localutil.c: Ralf Wildenhues: add SPLint annotations.
	* ln_log.c: Ralf Wildenhues: assign strerror return to a const
	string (was variable).

	* leafnode.h: Ralf Wildenhues: add SPLint annotations.  Add
	lclint_fixes.h

	* inet_ntop.c: Fix typo in comment.
	* h_error.h: Ralf Wildenhues: add SPLint annotations.
	* h_error.c: Ralf Wildenhues: add SPLint annotations.
	* gmtoff.c: Add license.
	* getline.h: Drop /*@out@*/ annotation.
	* getline.c: Drop /*@out@*/ annotation.
	* getfoldedline.c: Ralf Wildenhues: add SPLint annotations.  0 ->
	NULL.

	* format_ulong.c: Ralf Wildenhues: type fix (use unsigned long).
	* fopen_reg.c: Ralf Wildenhues: add SPLint annotations.  0 ->
	NULL.

	* filterutil.c: Ralf Wildenhues: add SPLint annotations.  Some
	minor fixes.

	* fetchnews.c: Tons of minor fixes by Ralf Wildenhues.
	* critmem_realloc.c: Ralf Wildenhues: Change exit(1) to
	exit(EXIT_FAILURE).

	* critmem_malloc.c: Ralf Wildenhues: Change exit(1) to
	exit(EXIT_FAILURE).  Add SPLint annotations.

	* critmem_calloc.c: Ralf Wildenhues: Change exit(1) to
	exit(EXIT_FAILURE).

	* configutil.c: Ralf Wildenhues: add SPLint annotations.  Turn
	some 0 into NULL.

	* configparam.h: Ralf Wildenhues: add SPLint annotations.
	* configparam.c: Ralf Wildenhues: add SPLint annotations.
	* checkgroups.c: Fix typo in stderr output.
	* artutil.c: Explicitly compare against NULL in assert().
	* applyfilter.c: Ralf Wildenhues: add SPLint annotations.
	* activutil.c: Ralf Wildenhues: add SPLint annotations.
	* sync_dir.c: Cast mastrcpy results to void. (Ralf Wildenhues)
	* store.c: Ralf Wildenhues: fix typo in Xref: header. Write only
	necessary ref in Xref: header when create_all_links = 0.

2002-02-28  Matthias Andree  <matthias.andree@gmx.de>

	* nntpd.c: Now really fix. Also, return article number 1 instead
	of 0 for pseudo group STAT/HEAD/BODY/ARTICLE.
	* nntpd.c: Fix STAT/HEAD/BODY/ARTICLE with pseudo article with
	implicit article number. Bug reported, found and different fix
	suggested by Ralf Wildenhues.  Drop 400 error code when
	disconnecting because the client did not send a command within the
	timeout limit, it breaks too many clients.  Rename ispseudogroup
	to is_pseudogroup to prevent clashes with C99 future extensions.

2002-02-20  Matthias Andree  <matthias.andree@gmx.de>

	* TODO: Fix umlauts to iso-8859-15. Update. Postpone virtually
	anything to 10pre5 to make 10pre4 into a worship-Ralf-Wildenhues
	release.

	* INSTALL: Add note that SGI may need GNU make.
	* leafnode.8.in: Ralf Wildenhues: Fix typo.
	* nntpd.c: Ralf Wildenhues: Read NOPOSTING environment into
	file-local variable. Fix ANSI violation in
	allowposting(). main_loop(): Fix possible cmd[] underflow. Many
	more fixes, memory leak plugs, not listed here. Optimize by using
	fputs for static strings rather than printf.

	* ln_log.c: Ralf Wildenhues: Fix comment.
	* leafnode.h: Ralf Wildenhues: more splint annotations.
	* fetchnews.c: Matthias Andree: postarticles(): drop
	haveid. Reported by Ralf Wildenhues.  Ralf Wildenhues: make
	newserver an unsigned long in do_group().  Matthias Andree: mark
	newserver as FIXME unused in processupstream. Reported by Ralf
	Wildenhues.

	* xoverutil.c (xgetxover): Drop unused variable "body". Reported
	by Ralf Wildenhues.

	* nntpd.c: Ralf Wildenhues: in dolist(): memleak (local variable
	arg not freed), variable p set but not used. in doxover():
	variable l set but not used. in markinterest(): fix memleak in
	s. in doselectedheader(): fix memleak in header.  Matthias Andree:
	Fix another memleak in header, reported by Ralf.

	* miscutil.c: rfcdate(): make local a pointer, use gmtoff, discard
	gmt. (Ralf Wildenhues reported "gmt" as unused).
	* miscutil.c: Ralf Wildenhues: in lookup(): variable q set but not
	used. in initvars(): make ui/gi depend on TESTMODE.
	* ln_log_open.c: Ralf Wildenhues: Suppress openlog in TESTMODE.
	* ln_log.c: Ralf Wildenhues: Suppress syslog in TESTMODE.
	* mastring.c: Ralf Wildenhues: Drop unused variable c in
	mastr_getln().

	* localutil.c: Ralf Wildenhues: use int instead of char to carry
	strcasecmp result, to prevent troubles on machines that have char
	== unsigned char.

2002-02-16  Matthias Andree  <matthias.andree@gmx.de>

	* mastring.c: Fix types.
	* configure.ac: Bump version to 2.0b8_ma10pre4.
	* activutil.c: Merge Jörg Dietrich's patch to propagate newsgroup
	mode changes from local groups into groupinfo.  Clean up this
	patch, just always copy the status into groupinfo.

2002-02-11  Matthias Andree  <matthias.andree@gmx.de>

	=== release 2.0b8_ma10pre3 ===
	* Makefile.am: Add touch.c to liblnutil_a_SOURCES.
	* leafnode.h: Add touch().
	* fetchnews.c: No longer call mastr_new() with 0 argument, but 256
	instead. Use the new touch() function from touch.c instead of
	doing the touch ourselves.

	* activutil.c: Kill trailing whitespace.
	* store.c: Drop touch(), now in a separate file (also needed by
	fetchnews).

	* touch.c: New file. This adds a write() to work around a Linux
	reiserfs bug which does not change the mtime when ftruncate() is
	called. A bug report has been sent to the ReiserFS mailing list,
	Message-ID: <m3vgd4bwgc.fsf@merlin.emma.line.org>

	* AUTHORS: Restore and update this file.
	* mastring.c: Replace long by size_t.
	* mastring.h: Replace long by size_t.
	* xoverutil.c: Merge Jörg Dietrich's patch to fix fetchnews -f
	water mark issues.

	* texpire.c: Merge Jörg Dietrich's patch to fix fetchnews -f water
	mark issues.

	* store.c: Merge Jörg Dietrich's patch to fix fetchnews -f water
	mark issues.

	* nntpd.c: Merge Jörg Dietrich's patch to fix fetchnews -f
	water mark issues.

	* moderated.c: Merge Jörg Dietrich's patch to fix fetchnews -f
	water mark issues.

	* localutil.c: Merge Jörg Dietrich's patch to update the local
	groups format comment.

	* leafnode.h: Merge Jörg Dietrich's patch to fix fetchnews -f
	water mark issues.

	* fetchnews.c: Merge Jörg Dietrich's patch to fix fetchnews -f
	water mark issues.

	* checkgroups.c: Merge Jörg Dietrich's patch to fix fetchnews -f
	water mark issues.

	* applyfilter.c: Merge Jörg Dietrich's patch to fix fetchnews -f
	water mark issues.

	* activutil.c: Merge Jörg Dietrich's patch to fix fetchnews -f
	water mark issues.

	* mastring.c: Add some cosmetic fluff to quiet splint.
	* activutil.c: Add some cosmetic fluff to quiet splint.
	* fetchnews.c: Add note that NNTPcache replies to NEWNEWS with 502
	AND a dot line (the latter violates the RFC).
	* configure.ac: Bump version.
	* README.html: Document that local.groups allows comments.
	* localutil.c: Allow comment lines in local.groups. Comment lines
	start with a hash mark ("#"). NOTE: blank lines are NOT
	allowed. The hash mark must be the first character and must not be
	preceded by white space. Suggested by Arne Hanssen.

2002-02-10  Matthias Andree  <matthias.andree@gmx.de>

	* configparam.c: Add copyright notice.
	* Makefile.am: Dropped copyfile.c from liblnutil_a_SOURCES, it was
	unused.

	* copyfile.c: dropped, unused.
	* README.html: Add CVS Version ID.
	* README.html: Add docs on the --with-dmalloc ./configure option.
	* configparam.c: Reorder #include directives, putting dmalloc.h
	last, to fix compile problems when configured
	--with-dmalloc. Found after dmalloc related inquiry by Jörg
	Dietrich.

2002-02-04  Matthias Andree  <matthias.andree@gmx.de>

	=== RELEASE 2.0b8_ma10pre2 ===
	* Makefile.am: Add getwatermarks.c.
	* TODO: Update.
	* leafnode.h: Add getwatermarks. Add time_t to gmtoff() prototype.
	* fetchnews.c: nntpactive(): Use getwatermarks() instead of doing
	this on our own.

	* store.c: If EEXIST happens during store into a newsgroup, obtain
	the water marks for the group and retry. This should prevent
	storing articles into the "gaps" after a crash. Fixes a
	long-standing bug.  Also prefix all log messages with "store: "
	and let the BAIL macro suppress its log if the second argument is
	an empty string.

	* gmtoff.c: Now calculate the offset for the time passed in as
	argument rather than the current time. Side effect: this function
	does not call upon gettimeofday any more.

	* nntpd.c: Clean up and unify donewgroups/donewnews, split off
	common code into separate functions to save some code. En passant,
	fix the time zone sign bug and calculate GMT offset for the time
	given rather than the current time. Negated offset reported by
	Ralf Wildenhues.

2002-02-03  Matthias Andree  <matthias.andree@gmx.de>

	* ln_log.h: Reduce general verbosity by one. Add one -v to restore
	old behaviour.

2002-01-31  Matthias Andree  <matthias.andree@gmx.de>

	* queues.c: - feedincoming: cast result of rbreadlist to char *
	  (MIPS compiler chokes without it). (Ralf Wildenhues)
	* leafnode.h: Ralf Wildenhues: - findmsgid: return unsigned long.
	* miscutil.c: Patches by Ralf Wildenhues:
	- initinteresting: do not read freed memory k!
	  Since one abort()s anyway, do not care about freeing.
	- struct msgidtree.art should be unsigned long.
	- findmsgid: should return unsigned long.

	* fetchnews.c: Apply 6 patches by Ralf Wildenhues:
	- doxover: after while loop, test l!=NULL.  Servers can die.
	- doxhdr: same problem.
	- do_group: should return long.  variable newserver should be
	  signed long, else it cannot detect error condition of getgroup().
	- do_group: splint annotation typo.
	- processupstream: variable newserver should be signed long (same
	  error condition problem).  Unchecked though.
	- processupstream: fix 2 memleaks.

	* mkstemp.c: Compile fixes.
	* configure.ac: Move mkstemp from AC_CHECK_FUNCS to
	AC_REPLACE_FUNCS. Found by Ralf Wildenhues.

2002-01-30  Matthias Andree  <matthias.andree@gmx.de>

	=== RELEASE 2.0b8_ma10pre1 ===
	* xoverutil.c: Gracefully exit from fixxover when no active file
	is read (can happen when fetchnews -f is run during network
	outage).

	* TODO: Update.
	* timeout_getaline.c: Use RETSIGTYPE for signal functions.
	* nntputil.c: Use mgetaline to read the banner (useful to abort
	when the server is connected to through tunnels) to get timeout
	handling at least here.

	* Makefile.am: Bail out if b_sortnl cannot be run (should fix the
	"does not recognize parameters in /etc/leafnode/config)
	issue. Also circumvent Solaris mv failures by using rm -f before
	mv.

	* leafnode.h: Alias fork() to -1 on systems that stub out
	fork. (AmigaOS)

	* inet_ntop.c: Drop dmalloc.h, not needed.  Use strncpy for
	portability, we do not want this function to rely on mastring.
	* fetchnews.c: Use RETSIGTYPE for signal functions.  Fix connect
	error handling.

	* configure.ac: Drop AC_FUNC_ for LSTAT, MALLOC, STAT, UTIME_NULL
	* config.example: Add note about groupexpire to archive groups.
	* nntpd.c: Use RETSIGTYPE for signal functions.

2002-01-29  Matthias Andree  <matthias.andree@gmx.de>

	* redblack.h: Manually define the "VISIT" enum type unless
	HAVE_SEARCH_H is defined.

	* Makefile.am: Use @LIBOBJS@ in LDADD and drop mergesort.c from
	liblnutil_a_SOURCES.

	* configure.ac: portability: Add search.h to AC_CHECK_HEADERS
	(MacOS X doesn't have it).  Drop getline from AC_REPLACE_FUNCS.
	For now, drop AC_FUNC_MKTIME, we don't have mktime.c replacements.

	* filterutil.c: Fix SIGSEGV when filter file cannot be opened.
	Add some comments on the readfilter() state machine.

2002-01-19  Matthias Andree  <matthias.andree@gmx.de>

        === RELEASE 2.0b8_ma9 ===

2002-01-16  Matthias Andree  <matthias.andree@gmx.de>

	* texpire.c: Log when .overview has been unlinked.

	=== RELEASE 2.0b8_ma9rc3 ===

2002-01-14  Matthias Andree  <matthias.andree@gmx.de>

	* *: keep clear of is* and str* name spaces to prevent future
	collisions.

	* mergesort.c: Fix up EVAL errno.h namespace pollution, rename to
	eval.

	* xoverutil.c: Drop arpa/inet.h (xoverutil does not need it).
	Allocate overview for current+1 instead of current, patch by Ralf
	Wildenhues.

	* nntputil.c: Exempt arpa/inet.h from splint, patch by Ralf
	Wildenhues.

	* nntpd.c: Exempt arpa/inet.h from splint, patch by Ralf
	Wildenhues.

	* miscutil.c: Ralf Wildenhues: Introduce TESTMODE to skip uid/gid
	changes.

	* masock_*.c: Exempt arpa/inet.h from splint, patch by Ralf
	Wildenhues.
	* masock.h: Exempt arpa/inet.h from splint, patch by Ralf
	Wildenhues.

	* .lclintrc: Switch to -weak for now.
	* fetchnews.c (processupstream): use closeinteresting on write
	error, patch by Ralf Wildenhues.
	* critmem.h: Include config.h, patch by Ralf Wildenhues.
	* checkgroups.c: Minor fixes by Ralf Wildenhues.
	* mergesort.c: Fix types. Code is now splint -weak clean.

2002-01-11  Matthias Andree  <matthias.andree@gmx.de>

        === RELEASE 2.0b8_ma9rc2 ===
	* nntpd.c: Fix SIGSEGV in fopenart when a non-existent article was
	requested from a non-new or local group. This does not usually
	happen with newsreaders. The bug was introduced in 2.0b8_ma9pre3.
	* configure.ac: Bump version.
	* miscutil.c: Add freeinteresting() implementation.  Change second
	argument of findinlist to const * char const.

	* leafnode.h: Add freeinteresting() prototype.  Change second
	argument of findinlist to const * char const.

	* fetchnews.c: Security bugfix (low risk): dynamically allocate
	space for group name plus space character in do_group rather than
	overflowing it's caller's dynamically-allocated string.

	This bug was observed and tracked down by Mike Castle
	<dalgoda@ix.netcom.com>.  Thanks a lot.

	As we're not overflowing an "auto" storage class variable here,
	the data will not be on the stack, so just pushing shell code into
	the variable will be rather useless, and the attack would be
	rather difficult to deploy: the server would have to toss down
	shell code without NUL and LF, could not use CR everywhere, and it
	would need to trick a client into marking this group for fetching.

	* ALL: change DEBUG_DMALLOC -> WITH_DMALLOC.
	* miscutil.c: Misc cleanups in initinteresting(), deal with
	"already present in tree" condition. Fix function name logging.
	* rnews.c: Deal with argument to -D.
	* nntpd.c: Deal with argument to -D.
	* newsq.c: Deal with argument to -D.
	* Makefile.am: Do not install rnews.8 (rnews ist not installed
	either).  Add log_chmod.c and log_fchmod.c to library sources.

	* log_fchmod.c: New.
	* log_chmod.c: New.
	* leafnode.h: Add prototypes for log_chmod and log_fchmod.
	* xoverutil.c: Use log_fchmod rather than doing our own error
	logging.

	* texpire.c: Deal with argument to -D.
	* texpire.8.in: Update documentation.
	* rnews.8.in: @LIBDIR@ -> @sysconfdir@, found by Mike Castle.
	Update -D documentation.
	* leafnode.8.in: @LIBDIR@ -> @sysconfdir@, found by Mike Castle.
	Update -D documentation.
	* fetchnews.8.in: @LIBDIR@ -> @sysconfdir@, found by Mike Castle.
	Update -D documentation.
	* checkgroups.c: Deal with argument to -D.
	* attributes.h: Change license to LGPL.
	* artutil.c (mgetheader) Deal with buf == NULL, found by Ralf
	Wildenhues.

	* applyfilter.c: Deal with argument to -D.
	* applyfilter.8.in: @LIBDIR@ -> @sysconfdir@, found by Mike
	Castle.  Update -D documentation.

	* activutil.c: Use log_fchmod rather than doing our own error
	logging.

	* fetchnews.c: Fix writing of server-specific info files.  Deal
	with argument to -D.  Fix bogus "not found in groupinfo file"
	errors.  Change child's exit() to _exit(), found by Ralf
	Wildenhues.

	* mastring.c: Add missing free() in oom handling.  Change some 0
	to NULL for readibility.

2002-01-08  Matthias Andree  <matthias.andree@gmx.de>

	=== RELEASE 2.0b8_ma9rc1 ===
	* texpire.c: Make program splint -weak clean, defining some
	variables static.

	* critmem.h: Fix the lclint comments that indent broke.
	* nntputil.c: Fix the lclint comments that indent broke.
	* artutil.c: Fix the lclint comments that indent broke.
	* xoverutil.c: API change for xover retrieval: most functions now
	take an additional parameter, require_messageidlink, to skip
	messages without a proper link in message.id (these are broken
	anyways).  Bugfix: don't abort if the new .overview is empty.

	* ugid.h: Include Ralf Wildenhues' lclint annotations.
	* ugid_ggetbyuname.c: Include Ralf Wildenhues' lclint annotations.
	* texpire.c: Track getxover API change.  Drop relink, was too
	inefficient.  Fix the spool rehashing bug that ate Mike Castle's
	news spool. Please apologize.

	* nntpd.c: Track getxover API change.
	* newsq.c: Next round of Ralf Wildenhues' correctness patches.
	* miscutil.c: Include Ralf Wildenhues' lclint annotations.  Fix
	memory leak (Ralf Wildenhues).

	* leafnode.h: Include Ralf Wildenhues' lclint annotations.  Track
	getxover/xgetxover API change: addition of require_messageidlink.
	* getline.h: Include Ralf Wildenhues' lclint annotations.
	* getline.c: Include Ralf Wildenhues' lclint annotations.
	* format_ulong.c: Include Ralf Wildenhues' lclint annotations.
	* format.h: Include Ralf Wildenhues' lclint annotations.
	* critmem.h: Include Ralf Wildenhues' lclint annotations.
	* configure.ac: Bump version to 2.0b8_ma9rc1.
	* artutil.c: Next round of Ralf Wildenhues' correctness patches.
	* applyfilter.c: Track getxover API change.

	=== RELEASE 2.0b8_ma9.4pre ===
	* Makefile.am: Move leafnode-version to bindir.
	* activutil.c: Back out lold initialization.
	* fetchnews.c: Fix bogus "not in groupinfo file" errors.

2002-01-07  Matthias Andree  <matthias.andree@gmx.de>

	=== RELEASE 2.0b8_ma9.3pre ===
	* leafnode-version.c: Preset PATH to /bin:/usr/bin and run uname
	without a path, SuSE Linux 7.3 installs it to /bin, FreeBSD to
	/usr/bin.

	* TODO: Update.
	* xoverutil.c: Rename getxover to xgetxover, add a group parameter
	which - when non-NULL - has the in-core groupinfo updated. Provide
	getxover as xgetxover(NULL) for compatibility.  Add maybegetxover
	which only operates when the group directory is more current than
	the .overview or the .overview is more current than groupinfo.
	* redblack.c: Handle OOM in rb_openlist. Found by Ralf Wildenhues.
	Bug filed on https://sourceforge.net/project/libredblack, Bug-ID
	#500600.
	* queues.c: Fix memory leak (rbdestroy) in error conditions. Found
	by Ralf Wildenhues.
	* nntputil.c: Streamline newnntpreply, fixing compiler warnings.
	* mastring.h: Add lclint annotations.
	* mastrcpy.c: Add lclint annotations.
	* lsort.c: Fixes for type bugs and memory leaks found by Ralf
	Wildenhues.

	* ln_log.c: Fix for lclint.
	* activutil.c: Declare active-/inode-times and sizes static.
	* leafnode.h: Drop activetime in favor of query_active_mtime().
	* activutil.c: Add query_active_mtime.
	* leafnode.h: Include type fixes and lclint annotations sent by
	Ralf Wildenhues.  Add xgetxover and maybegetxover.

	* dirutil.c: Include type fixes and lclint annotations sent by
	Ralf Wildenhues.

	* configure.ac: Bump version, add -lpcre to LIBS rather than
	LINKPCRELIB.

	* config.example: Document authenticate option.
	* applyfilter.c: Properly initialize min/max, found by Ralf
	Wildenhues.

	* activutil.c: Fix two subtle bugs found by Ralf Wildenhues.
	* nntpd.c: Implement fix suggested by Ralf Wildenhues: use fclose
	before freeing our setvbuf buffer.  fopenart returns failure when
	the article to be opened has 0 bytes (store.c marks write errors
	by truncating the inode). Fixes a bug that was present since the
	introduction of store.c.  When the group contents are more current
	than .overview, rebuild .overview. Fixes a long-standing bug
	reported by Stefan Wiens.

2002-01-06  Matthias Andree  <matthias.andree@gmx.de>

	=== RELEASE 2.0b8_ma9.2pre ===
	* TODO: Update.
	* configure.ac: Only default spooldir to /var/spool/news when no
	prefix is set or the prefix is /usr, default to
	$localstatedir/spool/news otherwise.  Fixes make distcheck
	breakage.

	* Makefile.am: Prevent install-data-hook abort in non-root mode.
	* fetchnews.c: Fix long-standing forceactive (-f) bug that left
	groupinfo with all watermarks zeroed out.
	* tools/make_pass.pl: Clean up a little.
	* miscutil.c: Add lclint annotations and some const attributes.
	* get.h: Add lclint annotations.
	* masock_sa2port.c: Initial checkin.
	* leafnode.h: Reorder, drop AM_NAME, add some lclint comments.
	* masock.h: Add masock_sa2port.
	* leafnode.8.in: Update, document authenticate.
	* nntpd.c: Drop AM_NAME support.  Properly implement AM_FILE
	support for authentication, clean up and enhance robustness.

	* configutil.c: Drop AM_NAME support.
	* README.html: Update, document authenticate.
	* artutil.c: Heed DEBUG_CANCEL when cancelling or superseding.
	* fetchnews.5.in: renamed to filterfile.5.in
	* configure.ac: Add getaddrinfo.
	* Makefile.am: Add masock_sa2port.c.
	* nntpd.c (log_sockaddr): Also log port numbers.
	* nntputil.c: Add commentary for Doxygen.

2002-01-05  Matthias Andree  <matthias.andree@gmx.de>

	* nntputil.c: Support IPv6 (NNTP client) if the OS provides
	getaddrinfo(3).  Add some lclint annotations. Fix some bugs, add
	some assert().

	* nntpd.c: Add SETVBUF_REVERSED support.
	* TODO: Update, drop fetchnews -N bug and automake (done).
	* .cvsignore: Add Makefile.in.
	* vcp.sh: Dropped in favor of automake.
	* makedepend.sh: Dropped in favor of automake.
	* Makefile.in: Dropped in favor of Makefile.am.
	* configure.in: Renamed to configure.ac.
	* configure.ac: Renamed from configure.in.  Added a lot of things
	that autoscan found missing.  Ran through autoreconf.

	* store.c: Include fixes and lclint annotations sent by Ralf
	Wildenhues.

	* mastrncpy.c: Include lclint annotations sent by Ralf Wildenhues.
	* mastring.c: Include fixes and lclint annotations sent by Ralf
	Wildenhues.

	* mastring.h: Include fixes and lclint annotations sent by Ralf
	Wildenhues.

	* leafnode.h: Include lclint annotations sent by Ralf Wildenhues.
	* b_sortnl.c: Include fixes and lclint annotations sent by Ralf
	Wildenhues.  Drop "y" variable and rely on compiler to optimize
	things.

2002-01-04  Matthias Andree  <matthias.andree@gmx.de>

	* Makefile.am: Switch to automake.
	* fetchnews.c: Really implement -N option to only fetch a
	particular newsgroup, reported by Jürgen Salk.
	* aclocal.m4: Update. Just part of CVS for convenience.
	* amiroot.c: Import from leafnode 1.9.19.ma*.
	* README.html: Minor updates.
	* newsq.1.in: Add set-gid note.
	* newsq.1.in: document in.coming and failed.postings.
	* fetchnews.c: Implement -N option to only fetch a particular
	newsgroup.

2002-01-03  Matthias Andree  <matthias.andree@gmx.de>

        === RELEASE 2.0b8_ma9.1pre ===
	* Makefile.in: Include README (text version) in distributions --
	note: requires lynx to build the tarball!
	* rnews.c: Apply Volker Apelt's patch to log initialization
	troubles to syslog.

	* nntpd.c: Apply Volker Apelt's patch to log initialization
	troubles to syslog.

	* fetchnews.c: Apply Volker Apelt's patch to log initialization
	troubles to syslog.

	* checkgroups.c: Apply Volker Apelt's patch to log initialization
	troubles to syslog.

	* leafnode.h: Change initvars "program" parameter prototype to
	const char * (was char *).

	* texpire.c: Apply Volker Apelt's patch to log initialization
	troubles to syslog.

	* applyfilter.c: Apply Volker Apelt's patch to log initialization
	troubles to syslog.

	* miscutil.c: Apply Volker Apelt's patch to log initialization
	troubles to syslog.

	* fetchnews.c: Accept =, x, j status characters in LIST replies.
	Move first/last initialization down a bit to fix bogus low/high
	article numbers in groupinfo that occurred after fetchnews
	-f. Long-standing bug. This should fix a couple of
	incompatibilities.

	* activutil.c: Transform status characters: x -> n, j -> y, = -> y
	* texpire.c: Fix commentary whitespace.
	* store.c: Fix double angle bracket reject filter logging.
	* leafnode.h: Change return type of writeactive to int (was void).
	* fetchnews.c: When reading newsgroups from an upstream server,
	make finding and parsing the status character more robust. Should
	fix the NUL bytes in groupinfo's status column that Tim Dodge
	reported.

	* artutil.c: When superseding or canceling an article, an ENOENT
	is only logged with NOTICE priority (the article may have been
	filtered or expired already).

	* activutil.c: Make writeactive() more robust (no crash without
	active).  If groupinfo is truncated, log problematic lines and
	skip over them.

2002-01-02  Matthias Andree  <matthias.andree@gmx.de>

	* filterutil.c: Respect DEBUG_FILTER. Found by Oliver Titz, fixed by
	Raymond Scholz.

2001-12-29  Matthias Andree  <matthias.andree@gmx.de>

	* Makefile.in: Use $(...) Makefile macros rather than
	config.status @...@ expansions for config.c for everything except
	PACKAGE_VERSION. Found by Ben Holness and Jörg Dietrich.

2001-12-29  Matthias Andree  <matthias.andree@gmx.de>

	=== RELEASE 2.0b8_ma8 ===

2001-12-27  Matthias Andree  <matthias.andree@gmx.de>

        === RELEASE 2.0b8_ma8rc8 ===
	* nntpd.c: Do not store postings without approved header. Fix by
	Jörg Dietrich.

	=== RELEASE 2.0b8_ma8rc7 ===
	* Makefile.in: Fix "groupinfo missing" reported by Arne Hanssen.
	* texpire.c: Use MKDIR_MODE for mkdir.
	* store.c: Use MKDIR_MODE for mkdir.  Fix spurious whitespace.
	* queues.c: Fix spurious whitespace.
	* newsq.c: Also display failed.postings queue.
	* miscutil.c: Use MKDIR_MODE for mkdir.
	* mkdir_parent.c: Add mode_t mode to mkdir_parent argument list.
	* ln_dir.h: Add mode_t mode to mkdir_parent argument list.
	* leafnode.h: List MKDIR_MODE, default to 0750. Used for all
	directories leafnode creates.
	* fetchnews.c: Fix "findgroup(...) called without prior
	readactive()", reported by Alexander Reinwarth and Michael Mauch.
	* configutil.c: Correctly initialize dontpost field to FALSE (by
	default, post to all servers).
	* configure.in: Bump version.

2001-12-24  Matthias Andree  <matthias.andree@gmx.de>

	=== RELEASE 2.0b8_ma8rc6_jack_frost ===
	* TODO: update.
	* README.html: Document xinetd.
	* fetchnews.c: No longer segfault when receiving EOF instead of an
	article.  Abort the fetch if ARTICLE is replied to with 5XX or
	EOF.  Add some comments.  Let getgroup detect error conditions
	returned by chdirgroup.  Let main detect error conditions returned
	by readfilter and refuse operation in that case.

	* nntputil.c: Refuse to work with servers that have NNTPcache V2.3
	in their greeting. NNTPcache v2.3.3 is still in widespread use,
	but has severe Y2k bugs. This should direct inquiries to the
	proper address.

2001-12-23  Matthias Andree  <matthias.andree@gmx.de>

	* leafnode.h: Add internalerror() macro.
	* filterutil.c: The filter parser now tracks its state. This
	should bring solid error detection and more precise error
	reporting.  This should fix all breakage reported by Leopold
	Tötsch.

2001-12-22  Matthias Andree  <matthias.andree@gmx.de>

	* configure.in: Bump version to rc6.
	* miscutil.c: Fix documentation.  Drop a spurious abort() and
	return error instead.

2001-12-20  Matthias Andree  <matthias.andree@gmx.de>

	=== RELEASE 2.0b8_ma8rc5 ===
	* UPDATING: Add note about texpire -r.
	* texpire.c: Remove group_relinked stuff, it's obsolete.  Make
	repair_spool (-r) mode reinsert message.id files into the right
	message.id/*/ subdirectory.  Skip file names beginning with a dot
	in message.id/*/

	* README.html: More updates. Report by Leopold Tötsch.
	* leafnode.8.in: Updates. Report by Leopold Tötsch.
	* fetchnews.8.in: Fix reference, it's fetchnews(5) not leafnode(5)
	that describes the filters.
	* configutil.c: Fix unclear wording as to the global vs server
	ordering. Reported by Leopold Tötsch.

	* configure.in: Bump version to ma8rc5.
	* config.example: Updates and reordering. Report by Leopold
	Tötsch.

	=== RELEASE 2.0b8_ma8rc4 ===
	* configure.in: Bump version.
	* nntpd.c: Revert the pseudoarticle artno magic, it was evil and
	broke regular HEAD/LAST/ARTICLE/BODY commands.
	* filterutil.c: Fix more memory leaks.

	=== RELEASE 2.0b8_ma8rc3 ===
	* store.c: Fix brown-paperbag-bug in store.c which ALWAYS
	segfaulted.

	=== RELEASE 2.0b8_ma8rc2 ===
	* configure.in: Add string.h and strings.h, switch echo -n to
	printf.

	* leafnode.h: Drop XOPEN stuff, include string.h and strings.h
	depending on HAVE_... macros.
	* leafnode-version.c: Drop compileinfo, add version and
	DEFAULTMTA.

	* texpire.c: Remove C++-style // comment (breaks compile on Sun
	Workshop cc).

	* store.c: Compile fixes for Sun WorkShop compiler.
	* Makefile.in: Get rid of compileinfo in config.c for now, it
	seems impossible to output this portably.  Compile fixes for
	Solaris 2.5.1 (make doesn't support $< or .o: default rules or :=
	immediate assignments).  Finally get rid of last pcre cruft.
	Disable rnews for now, doesn't compile with SUNpro Workshop CC.
	* TODO: Updates (Jörg Dietrich found some inaccuracies).
	* store.c: Fix memory leak (mastr *ln was not deleted).
	* README.html: Clarify things a little.
	* Makefile.in: Make uninstall: do not delete config, just
	config.example.

	* filterutil.c: Fix memory allocation and recovery along with
	segfaults. Reported by Raymond Scholz.
	* fetchnews.c: Fix memory leak.
	* configure.in: Fix IPv6 detection (was broken on SuSE
	6.0). Reported by Leopold Tötsch.

	* config.example: Document windowsize option.
	* nntpd.c: Correctly terminate XHDR output for pseudo-group with,
	support XHDR path on pseudo groups. (Reported by Andreas Karrer.)
	Fix HEAD without argument on pseudo groups.

2001-12-18  Matthias Andree  <matthias.andree@gmx.de>

	* activutil.c: Fix memory leak in the insertgroup/mergegroups
	protocol.

	* fetchnews.c: Fix segfault when port is given in config
	file. Patch by Raymond Scholz.

	* README.html: Recommend to run texpire after the first fetchnews
	run, to create missing message.id/000 ... message.id/999
	directories.

	* config.example: Add example and description for dontpost.
	* README.html: Futher updates.  Fix --prefix example. Found by
	Leopold Tötsch.

	* Makefile.in: Drop PCRE junk.  Add lsort, call update.sh as
	./update.sh (found by Leopold Tötsch)

	* lsort.c: Readd this file, got lost since 1.9.x. Found by Leopold
	Tötsch.

	* leafnode.h: Pull in config.h earlier.  Always include <pcre.h>
	("pcre/pcre.h" is gone).

	* fetchnews.c: explain we expect regular files in out.going/
	* ENVIRONMENT: Document NOPOSTING
	* configure.in: Bump version to 2.0b8_ma8rc2.  Include
	AC_HEADER_STAT (portability).  Override sysconfdir to
	/etc/leafnode when --prefix=/usr (formerly, it would only be
	overriden without --prefix).
	Drop local PCRE support. The user must build PCRE
	separately. Problems reported by Jörg Dietrich and Leopold Tötsch.
	Also check for sockaddr_in6 and check if it contains
	sin6_addr to enable IPv6.  Print a summary of paths at the
	end. Found by Leopold Tötsch.

	* fopen_reg.c: Moved fopen after argument checking.  Change
	ENOTSUP to EINVAL. Not exactly what we want, but there is no
	distinct condition to return "this is not a regular file". ENOTSUP
	is not wide-spread and does not warrant autoconf support
	either. Found by Leopold Tötsch.

	=== release 2.0b8_ma8rc1 ===
	* Makefile.in: Update dependencies (automatic).
	* TODO: Update.
	* store.c: Brown paper bag bug: Don't apply "missing message.id"
	fix to newsgroups, but to message.id.
	* mkdir_parent.c: Bugfix: don't try to create directory without
	name.
	* moderated.c: Initial version after split from nntpd.c.
	* TODO: UPDATE.
	* timeout_getaline.c: Change timeout from 2 to 5 minutes, Jörg
	Dietrich had suggested to increase it to 3 minutes, to correspond
	with current NNTP drafts.
	* README.html: Updates: status chars, NOPOSTING.
	* nntpd.c: Move checkstatus/getmoderator to moderator.c Remove
	gmtoff. Replace by new gmtoff.c Add allowposting() function to
	check whether posting is allowed.  Add support for NOPOSTING
	environment variable.  Reformat.  Add dummy() function to point
	SIGCHLD to, Linux collects children itself when set to SIG_IGN,
	returning ECHILD on wait, which is not what we want. Needed for
	mailto().
	* miscutil.c: Also create backup.moderated directory.
	* Makefile.in: Add gmtoff.c, moderated.c.
	* leafnode.h: Add gmtoff, checkstatus, getmoderator prototypes.
	Add dontpost to struct server.
	* gmtoff.c: New file, to carry a new calculation routine for the
	GMT offset. Relies on time.h and libc to parse the time zone
	staff. No more environment fiddling.
	* fetchnews.c: Add "dontpost" server option.  Postings to
	moderated groups are posted to just one upstream server, and
	backed up to backup.moderated below SPOOLDIR.  Do
	move-to-failed.postings/backup.moderated with a new moveto()
	function.
	* configure.in: Drop PUTENV_COPIES check.
	Bump version to 2.0b8_ma8rc1.
	* config.table, configutil.c: Add "dontpost" server option.

2001-12-18  Matthias Andree  <matthias.andree@gmx.de>

	* configure.in: Drop PUTENV_COPIES check.  Bump version to
	2.0b8_ma8rc1.

	* config.table: Add "dontpost" server option.
	* configutil.c: Add "dontpost" server option.

2001-12-14  Matthias Andree  <matthias.andree@gmx.de>

	* queues.c: Bugfix: delete articles without Newsgroup: header.
	* nntpd.c: Jörg Dietrich: add support for moderated groups.
	* Makefile.in: Add mailto.c and mailto.o, add DEFAULTMTA.
	* localutil.c: Jörg Dietrich: add status char support.
	* fetchnews.c: Clean up newsgroup handling.
	* configutil.c: Jörg Dietrich: Add mta option.
	* configure.in: Add AC_PATH_PROG for DEFAULTMTA.
	* config.table: Jörg Dietrich: add mta
	* activutil.c: Jörg Dietrich: introduce status characters, drop
	fakeactive.

	* mailto.c: New file.

2001-11-29  Matthias Andree  <matthias.andree@gmx.de>

	* ln_dir.h: new file.
	* mkdir_parent.c: new file.

	* texpire.c: Log "not a regular file" in more detail.
	* store.c: Create missing directories below message.id.
	* fetchnews.c: Cleanup server_info, cleanup server logging when
	fetching new newsgroups. Stop reading these lists only if . is the
	only character on a line, not if the line starts with .
	* Makefile.in: Add ln_dir.h and mkdir_parent.c.
	* mastring.c: mastr_resizekeep: Do not free the old pointer passed
	in to realloc().

2001-11-27  Matthias Andree  <matthias.andree@gmx.de>

	* xoverutil.c: Fix error logging.
	* store.c: Add error logging in case of trouble, it was missing in
	most cases.

	* store.c:
	When copying the body, set ignore = 0 to prevent a lockup when
	something goes wrong after reading the body completely. Reported
	by Jörg Dietrich.

2001-11-12  Matthias Andree  <matthias.andree@gmx.de>

	* xoverutil.c: Allow empty Subject: line. Reported by Sergio Polini.

	* nntputil.c, parserange.c, queues.c, redblack.c, redblack.h, rnews.c, sort.c, store.c, strutil.c, sync_dir.c, sync_link.c, t_configparam.c, t_format_ulong.c, t_mastring.c, tab2spc.c, texpire.c, timeout_getaline.c, ugid_gensure.c, ugid_gget.c, ugid_ggetbyuname.c, ugid_gset.c, ugid_uensure.c, ugid_uget.c, ugid_ugetbyuname.c, ugid_uset.c, vsnprintf.c, wildmat.c, writes.c, xoverutil.c, attributes.h, b_sortnl.c, checkgroups.c, configparam.c, configutil.c, copyfile.c, critmem.h, critmem_calloc.c, critmem_malloc.c, critmem_realloc.c, critmem_strdup.c, dirutil.c, fetchnews.c, filterutil.c, fopen_reg.c, format_ulong.c, format_ulong0.c, get_any.c, getaline.c, getfoldedline.c, getline.c, h_error.c, inet_ntop.c, leafnode.h, ln_log.c, ln_log_open.c, localutil.c, lockfile.c, log_close.c, log_fclose.c, log_fsync.c, log_rename.c, log_unlink.c, masock_sa2addr.c, masock_sa2name.c, mastrcpy.c, mastring.c, mastring.h, mastrncpy.c, mergesort.c, miscutil.c, mkstemp.c, msgid_hash.c, msgid_sanitize.c, newsq.c, nfswrite.c, nntpd.c, activutil.c, applyfilter.c, artutil.c, .indent.pro, configparam.h, getline.h, ln_log.h, strdup.c:
	fed through indent

2001-11-11  Matthias Andree  <matthias.andree@gmx.de>

	* ChangeLog, TODO: snapshot

	* makedepend.sh:
	Manually create backup with ln -f instead before replacing the file.
	mv -b is evil without GNU fileutils.

	* Makefile.in: Drop -- from makedepend.sh arguments, confuses gcc.

	* Makefile.in:
	Link rnews against PCRE to fix compilation troubles on machines that
	don't have PCRE installed. Bug found by John A. Perry.

2001-11-12  Matthias Andree  <matthias.andree@gmx.de>

	* xoverutil.c: Allow empty Subject: line. Reported by Sergio
	Polini.
	* makedepend.sh: Manually create backup with ln -f instead before
	replacing the file.  mv -b is evil without GNU fileutils.
	* Makefile.in: Drop -- from makedepend.sh arguments, confuses gcc.
	* Makefile.in: Link rnews against PCRE to fix compilation troubles
	on machines that don't have PCRE installed. Bug found by John
	A. Perry.

2001-11-11  Matthias Andree  <matthias.andree@gmx.de>

	* xoverutil.c: Make chmod an fchmod before fclose.
	* nntputil.c: Add workaround for f* up NewsCache 0.99.17 that
	always responds to STAT <Message-ID> with 223 0 <Message-ID>.
	* miscutil.c: Add some flawfinder ignore lines.  Use mastring
	where convenient.

	* mastring.h: rename data to dat to deprecate direct access
	* mastring.c: rename data to dat to deprecate direct access
	* leafnode.h: Define _XOPEN_SOURCE and __USE_XOPEN if undefined.
	Add stat_is_evil global.
	* filterutil.c: Also free newsgroup component of filterentry.
	* fetchnews.c: Add workaround for f* up NewsCache 0.99.17 that
	always responds to STAT <Message-ID> with 223 0 <Message-ID>.
	* critmem_strdup.c: Add flawfinder comment.
	* configutil.c: Clean up configfile handling.
	* b_sortnl.c: Add flawfinder ignore comment.
	* artutil.c: Use mastr_str API.
	* activutil.c: Move to mastring where convenient.

	* store.c: Use mastr_str API.
	Make line a constant.

2001-10-21  Matthias Andree  <matthias.andree@gmx.de>

	* Makefile.in: Only make dependencies of *.c files.
	* applyfilter.c: Fix memory leak.

2001-10-18  Matthias Andree  <matthias.andree@gmx.de>

	* Makefile.in: Add writes.[co].
	* leafnode.h: Add writes() prototype.
	* lockfile.c: Use writes instead of write in some places.
	* writes.c: New file - write with implicit strlen.

	* nntpd.c:
	Use new writes() function to write the !not-for-mail string. Bug found
	and different fix suggested by Raymond Scholz.

2001-10-18  Matthias Andree  <matthias.andree@gmx.de>

	=== snapshot 2.0b8_ma7.6pre ===
	* texpire.c: Fix -F option handling.
	* store.c: Change API in anticipation of an rnews implementation
	that avoids copying the article whenever possible. store_stream
	now takes a bytecount parameter (disabled if negative).
	* nntpd.c: Change Path: tail to not-for-mail.  Fix double output
	of 420 error.
	* mastring.h: Add mastr_getln and mastr_chop.  Include stdio.h.
	* mastring.c: Add mastr_getln and mastr_chop.
	* leafnode.h: Add DEBUG_CANCEL.  Include unistd.h.
	* getline.h: Remove static attribute from _getline function.
	* getline.c: Remove static attribute from _getline function.
	* fetchnews.c: Cater for changed store_stream byte limiting API.
	Bail out when no servers are in config file, to reflect recent
	changes to configutil.c.
	* copyfile.c: Rename read local to haveread to fix name clashes.
	* configutil.c: Don't give up if no servers are given, leafnode
	might be used as standalone daemon. Reported by Arne Hanssen.
	* config.example: Add hint about supersede/cancel debugging.
	* artutil.c: Bugfixes.
	* applyfilter.c: Use read instead of fread to obtain the message
	headers.
	* Makefile.in: Add getline.o to liblnutil.a
	* ENVIRONMENT: Added a short text file to describe the environment
	variables that leafnode knows about.

2001-10-14  Matthias Andree  <matthias.andree@gmx.de>

	* getline.c: Fix for Doxygen.
	* store.c: Reorder functions to fix Doxygen documentation.

	* texpire.c: Brown paperbag bug that I introduced was fixed by
	Raymond Scholz (who sent a patch). Thanks.

2001-10-10  Matthias Andree  <matthias.andree@gmx.de>

	* miscutil.c: Fix inverted ngmatch logic. Reported by Raymond
	Scholz.

2001-10-09  Matthias Andree  <matthias.andree@gmx.de>

	=== snapshot 2.0b8_ma7.5pre ===

	* configure.in: Bump revision to 2.0b8_ma7.5pre.

	* TODO: Update.

	* miscutil.c: Fix very-long-standing bug that leafnode would
	unsubscribe low-traffic groups. The timeout comparison is now
	against the date of the last arrived posting in that group rather
	than against the current time.  Log entry to checkinteresting.

	* artutil.c: Unconditionally log unlink trouble in
	supersede_cancel.

	* mastring.c: Bugfix: Properly increment m->len in mastr_vcat.  In
	leafnode, it would affect store_stream() which wrote incomplete
	XRef: headers.

	* mastring.h: Add mastr_str to access string contained.

2001-10-07  Matthias Andree  <matthias.andree@gmx.de>

	* xoverutil.c: Fix memory leaks: dirlist was not always freed.

	* store.c: Fix memory leaks: tmpfn was not always freed.

	* localutil.c: Fix memory leak: free name of local groups as well.

	* leafnode.h: Add freeallfilter.

	* filterutil.c: Add free_entry and freeallfilter.

	* fetchnews.c: Fix memory leak: use freeallfilter rather than
	freefilter.

	* configutil.c: Fix memory leaks.

	* activutil.c: Fix memory leak in changegroupdesc, changing an
	existing description would not free the old one.
	
        Reduced memory profile of readactive, now iterates over disk file
	twice (first time to count the lines, second time to actually read
	it). This should help machines which have little RAM and a big
	groupinfo.

	* miscutil.c: Drop DoMatch/wildmat cruft (have been in wildmat.c
	for some time).

	* config.example: Reorder: global options first.

	* wildmat.c: Fix long-standing bug (broken since before
	2.0b8_ma3): If DoMatch returned ABORT, wildmat would treat it as
	TRUE, now fixed to treating it as FALSE. Reported by Volker Apelt.

	* texpire.c: Volker Apelt reported some minor bugs, fixed.
	Cleanup.

2001-10-05  Matthias Andree  <matthias.andree@gmx.de>

	=== snapshot 2.0b8_ma7.4pre ===
	
        * Makefile.in: Redo dependencies after .h file changes.

	* xoverutil.c: Kill empty articles. Change "illegal" to
	"malformatted" in logs.

	* texpire.c: Declare everything static.
	
	Workaround user ignorance: If article and message.id file inodes
	do not match (cp without -d), relink from message.id. Saves disk
	space and prevents premature expiry. Reported by various people on
	the list.

	* sync_dir.c: Fix off-by-one error in sync_parent.  Open directory
	in O_RDONLY mode (Linux replies with EISDIR if you try O_RDWR).

	* store.c: Readd supersede + cancel handling.  Fix excessive
	fsync()s.  Touch .last.posting in a newsgroup directory as one
	half of the "leafnode unsubscribes low-traffic groups" fix.

	* miscutil.c: Add redblack tree for fast query and walk of the
	interesting.groups stuff. (Will not aid delaybody, though).

	* leafnode.h: Track various recent changes.

	* filterutil.c: Fix month name array separation.

	* configutil.c: Cleanup: Replace expire by default_expire.

	* configure.in: Bump version to 2.0b8_ma7.4pre.

	* artutil.c: streamline mgetheader, drop cancel, merge
	supersede_cancel.

	* fetchnews.c: Use the redblack tree from miscutil.c to walk
	across the list of interesting groups, rather than reading
	interesting.groups all over again.

	* redblack.h: Add #ifndef/#define REDBLACK_H to fix compile.
	Patch submitted to libredblack's sourceforge page:
	https://sourceforge.net/tracker/index.php?func=detail&aid=468171&group_id=5997&atid=305997

2001-10-04  Matthias Andree  <matthias.andree@gmx.de>

	* filterutil.c: Make sure mon2num is actually sorted.

	Fix "only heeds last filter per newsgroup" bug reported by Oliver Titz
	in news:<linuxpc.m0g09155n0.fsf@killfilter.de>

2001-10-01  Matthias Andree  <matthias.andree@gmx.de>

	* Makefile.in: leafnode and texpire now need to include PCRE,
	because they either use store directly or via feedincoming -- and
	store itself does filtering.
	
	pcre.h now depends on $(srcdir)/pcre/pcre.h to satisfy
	dependencies.

	* Makefile.in: distcheck: run tar and configure in a subshell for
	compatibilty with non-GNU "make" programs.

	* Makefile.in: Add CFLAGS to makedepend.sh call, to include
	options that configure.in added to CFLAGS (e. g. those from
	pcre-config). Fixes warnings on FreeBSD.

	* configure.in: bump version to 7.3pre

	* texpire.c: Add debugging output. Add dry-run mode as suggested
	by Volker Apelt.

2001-09-30  Matthias Andree  <matthias.andree@gmx.de>

	* Makefile.in: Add redblack.h and libredblack man pages to archive.

2001-09-27  Matthias Andree  <matthias.andree@gmx.de>

	* Makefile.in: Track bintrees -> libredblack changes.  Cater for
	mastring.c.
	* TODO: Snapshot 2001-09-27
	* texpire.c: Reflect changes in store API: if not running in
	repair mode, kill postings that have no files in message.id.
	* xoverutil.c: Only create overview lines for articles that still
	have their message.id files. We use ihave() to check that.
	* nntpd.c: Add some comments and #ifdef NOT_YET in anticipation of
	upcoming NNTP standards that request servers to /silently/ drop
	their connection in case of timeout.
	* mastring.h: Track addition of mastring.c.
	* mastring.c: New file.
	* filterutil.c: Add some const keywords.
	* fetchnews.c: Track new store API.
	* attributes.h: Add __inline__.
	* leafnode.h: Track new store API changes.  Add some const
	keywords.
	* queues.c: Track the bintrees -> libredblack migration.
	* artutil.c: Drop old store and storearticle mess. Drop
	lookup_xref.
	* store.c: new.
	* miscutil.c: Add ihave function to check if an article with a
	specific message ID is already there.  Add temp.files directory.
	* leafnode.h: add ihave prototype (from miscutil.c)
	
2001-09-26  Matthias Andree  <matthias.andree@gmx.de>

	* leafnode.h: Define LLS and CLS as logical and canonical line
	separators.

2001-09-17  Matthias Andree  <matthias.andree@gmx.de>

	* leafnode.h: Declare long windowsize.
	* fetchnews.c: Drop windowsize definition, now in configutil.c.
	(doxover): only call killfilter if a filter list is defined.

	* configutil.c: Die if a recognized configuration parameter is
	unhandled.  Define windowsize.  Parse windowsize.

	* genconfigparam_data.awk: Add scope for configuration options.
	* configutil.c: Check scopes: Abort if server-specific option
	listed before server, warn if unknown parameter, warn if global
	option found below server/supplement line.  Initialise
	server-specific doxhdr correctly.  Clean up a bit and reindent.
	* configparam.h: Add scope for configuration options.
	* config.table: Add scope for configuration options.
	* fetchnews.c: Do pipelining right
	* leafnode.h: declare long sendbuf
	* nntputil.c: Drop shutdown, obtain TCP send buffer size
	* filterutil.c: Use bsearch to decode month names
	* filterutil.c: Clean up age() a bit.  Allow killfilter() to log
	debug. Try with applyfilter -vvvv.
	* applyfilter.c: If no filter for the newsgroup given is found,
	print argv[optind] rather than argv[1]. Also, exit with
	EXIT_SUCCESS in this particular case.
	* leafnode.h: make limit in filterentry a long.

2001-09-16  Matthias Andree  <matthias.andree@stud.uni-dortmund.de>

	* xoverutil.c: Split off nntputil.c.
	* timeout_getaline.c: New file. Split off nntputil.c.
	* sync_link.c: Rename new to newfile to allow for compiling with
	C++ compiler.

	* strutil.c:
	Add malloc casts to make it compile with a C++ compiler.

	* nntputil.c:
	Add malloc casts to make it compile with a C++ compiler.
	Drop putaline.
	Make protocol errors -1.

	* nntpd.c:
	Add malloc casts to make it compile with a C++ compiler.
	Drop timer.
	Drop mgetaline.

	* miscutil.c:
	Add malloc casts to make it compile with a C++ compiler.

	* mergesort.c:
	Add malloc casts to make it compile with a C++ compiler.
	Reformat a bit.

	* masock_sa2name.c:
	Add comment at line #42 to say some system include files are broken.

	* lockfile.c:
	Add malloc casts to make it compile with a C++ compiler.
	Rename template to templ for the same reason.

	* localutil.c:
	Add malloc casts to make it compile with a C++ compiler.

	* leafnode.h: *** empty log message ***

	* getfoldedline.c:
	Add malloc casts to make it compile with a C++ compiler.

	* Makefile.in:
	Add putaline.c, timeout_getaline.c.

	* fetchnews.c:
	Add malloc casts to make it compile with a C++ compiler.
	Drop reauthentication on GROUP command.

	* critmem_strdup.c, copyfile.c, configutil.c, bintrees.c, activutil.c:
	Add malloc casts to make it compile with a C++ compiler.

	* b_sortnl.c:
	Move mergesort declaration into leafnode.h.

	* applyfilter.c:
	Add whoami() before lockfile_exists()

2001-09-05  Matthias Andree  <matthias.andree@stud.uni-dortmund.de>

	* artutil.c:
	Fix bogus 'is a directory' error messages

	* texpire.c:
	Fix symbol name clashes with C++.
	Call feedincoming() to flush in.coming before doing the job.

	* queues.c:
	Use correct grammar in verbose output.

	* newsq.c:
	Also show in.coming and article counts.

2001-09-05  Matthias Andree  <matthias.andree@gmx.de>

	* newsq.c (main): also print in.coming queue.

	* texpire.c (main): run feedincoming to store pending articles
	from the in.coming queue into the groups.

	* queues.c: fix found N articles to print "article" for N == 1

2001-07-21  Matthias Andree  <matthias.andree@gmx.de>

	* configure.in: Bump version to 2.0b8_ma8.

	=== RELEASE 2.0b8_ma7 ===
	
	* texpire.c: Switch to Stefan Wiens' version of texpire, which has
	much better algorithms. (Faster!) Minor tweaks to adapt to _ma
	tree.

	* leafnode.h: Add compileinfo, BZIP2, CAT.
	* dirutil.c: Fix TEST part for current argument count.
	* Makefile.in: Add leafnode-version command. Add compile
	information to config.c.

	* xoverutil.c: In getxover, call freexover first.  Drop
	commented-out sort call.  Minor tweaks, possibly speed up things.

	* texpire.c (main): import Stefan Wiens' texpire, discarding the
	old one. Adjust to ln_log.

2001-07-15  Matthias Andree  <matthias.andree@gmx.de>

	* configure.in: Bump version.  Use pcre-config if present.
	* mergesort.c: Merge cast alignment warning shut up changes from
	NetBSD.

	=== RELEASE 2.0b8_ma6 ===
	
	* NOTE: some changelog entries of 2.0b8_ma5 got lost and have been
	readded today (with a bogus date).
	
	* xoverutil.c: Adjust to new locking scheme.

	* texpire.c: Adjust to new locking scheme.

	* sort.c: Adjust to new locking scheme.

	* nntputil.c: Adjust to new locking scheme.

	* miscutil.c: Adjust to new locking scheme.

	* mergesort.c: Shamelessly stolen from FreeBSD 4.3-STABLE,
	protoized, added __P macros.

	* lockfile.c: Adjust to new locking scheme.  Only log the first
	retry to lock if lock is held by other host. Reported by Oliver
	Kauss.

	* leafnode.h: Add DEBUG_* flags.  Add sync_* stuff.

	* inet_ntop.c: Remove bogus comment.  Fix off-by-one error.

	* getaline.c: Adjust to new debug scheme.

	* filterutil.c: Adjust to new debug scheme.

	* fetchnews.c: always fork.

	* configutil.c: adjust to new debug handling

	* configure.in: bump version to 2.0b8_ma6

	* config.example: Add info about debugmode.

	* artutil.c: change link to sync_link.

	* activutil.c (insertgroup): only call findgroup if active is
	defined. Fixes abort in fetchnews -f reported by Volker Apelt.

	* Makefile.in: Add masock, sync_link/sync_dir.  Add warning if
	Makefile has changed to re-run make if things go wrong
	(for BSD make users).
	Add tags (vim) and TAGS (emacs) targets.

	* global: debug handling has changed. debug is now a bitfield with
	various bits to select which debug output is relevant. Fixes
	report by Volker Apelt.

	* nntpd.c: fix owndn/fqdn handling all over the place. Should fix
	the locking problems Oliver Kauss reported in
	de.comm.software.newsserver on 2001-07-12. Message-IDs:
	<7btji9.tu.ln@news.oliver-kauss.de>,
	<m3lmluf57m.fsf@emma1.emma.line.org>,
	<23ani9.ef7.ln@news.oliver-kauss.de>
	(dogroup): clear xovergroup after freexover. Fixes crash if the
	same group is reselected. Reported by Raymond Scholz.
	(dorange): new function (2.0b8_ma5), used as helper for
	xover/xhdr/xpat.
	(dopost): change unlink to log_unlink, change link to sync_link.
	(log_sockaddr): new function to simplify main. Uses masock.
	(main): streamline address logging.

2001-07-12  Matthias Andree  <matthias.andree@gmx.de>

	* xoverutil.c (getxover): no longer sorts directory entries, just
	sorts xoverinfo.

	* strutil.c (strnsplit): Fix to include empty string in list if
	input ends with a separator character.  Change API: if any
	characters are left in the input string, negate return value.

	* miscutil.c (chdirgroup): if group directory not found, change to
	spool directory. Fixes output XOVER responses of previous group if
	current group empty.

	* activutil.c: Change all qsort to sort.  Drop "calling qsort in
	mergegroups" debug message.  Log and abort in findgroup if active
	has not been read before.

	* nntpd.c: Fix doxover to properly return overview line of current
	(rather than first) article.  Drop %m from EOF warning in
	main_loop.
	* parserange.c: Propagate error back when get_long fails unless
	field is empty.

	* leafnode.h (RANGE_*): paste macros from parserange.c

	* parserange.c: move RANGE_* macros into leafnode.h.
	
	* parserange.c: drop fprintf leftover from debugging.

	* parserange.c: new file. new function parserange.c.
	
2001-07-11  Matthias Andree  <matthias.andree@gmx.de>

	* Makefile.in: Add sort.c/sort.o.

	* sort.c (sort): add, calls mergesort and falls back to qsort if
	that fails (low memory or small size).

	* leafnode.h: add mergesort.

	* configure.in: Add mergesort to AC_REPLACE_FUNCS.

	* mergesort.c (mergesort): steal function from FreeBSD 4.3-STABLE,
	protoize, fix type of register int i to register size_t.

	* fetchnews.c: Fix file descriptor leak in postarticles.

2001-07-08  Matthias Andree  <matthias.andree@gmx.de>

	* nntpd.c: Don't call readlocalgroups, rereadactive does that for
	us.  Fix: Only log commands if debugmode == 1, not == 0.  Move
	buffer setting behind IPV6 #ifdefs (compile fix for gcc < 3.0)

	* fetchnews.c: Don't call readlocalgroups, rereadactive does that
	for us.
	
	* activutil.c: Performance: only read local.groups file if it has
	changed. Reported by Raymond Scholz, a band-aid fix (which is not
	included) had been provided by Stefan Wiens.

	* texpire.c: Just log message.id article count if debugmode > 1.
	Just log message.id deleteions if debugmode > 0.  Both reported by
	Volker Apelt. Don't call readlocalgroups, rereadactive does that
	for us.
	
2001-07-04  Matthias Andree  <matthias.andree@gmx.de>

	* nntpd.c: Set stdout to fully-buffered mode. Speeds up commands
	which send large amounts of data such as XOVER. Maybe helps about
	John Covici's report as well.

2001-07-02  Matthias Andree  <matthias.andree@gmx.de>

	* configure.in:
	Add missing colon in Revision tag.

	* texpire.c: Fix -F option handling.

	* nntputil.c:
	Drop incopy, use memcopy. Drop spurious casts.

	* nntpd.c: Fix -F option handling, reported by John Covici.

	* miscutil.c:
	Fix parseopt to read maximum size and use strcpy rather than strdup.

	* leafnode.h:
	Add size argument to parseopt.

	* fetchnews.c: Fix -F option handling.

	* applyfilter.c: Fix -F option handling.

	* Makefile.in:
	Fix b_sortnl.c compilation again, this time on GNU make. Use
	$(srcdir)/b_sortnl.c, that's working.

2001-07-01  Matthias Andree  <matthias.andree@gmx.de>

	* Makefile.in:
	Fix rnews missing install troubles.

	* xoverutil.c:
	Rename local t to sd (to fix compiler warning).
	Drop UIO_MAXIOV.

	* configure.in, config.h.in:
	Drop regcomp support.

	* Makefile.in:
	Fix Dependencies, minor tweaks for autoconf support

	* configure.in:
	Drop VERSION variable, Makefile can use PACKAGE_VERSION instead.
	Use AC_INIT with arguments.
	Add AC_PREREQ and AC_REVISION.
	Fix including of pcre/Makefile.in into AC_OUTPUT when pcre is
	needed and leafnode is built outside of its source directory.

	* makedepend.sh:
	Fix broken sed program that stripped files from dependency lines

	* fetchnews.c: Kill delposted

	* artutil.c:
	Cast isspace argument to unsigned char.

	* critmem_calloc.c, critmem.h, critmem_malloc.c, critmem_realloc.c:
	Fix types to void *

	* TODO: TODO

	* configure.in:
	Remove configure-dummy.o, bump version to upcoming release 2.0b8_ma4

	* xoverutil.c:
	Include several minor fixes reported by Stefan Wiens.

	* makedepend.sh, Makefile.in:
	Strip paths from dependency lines, rely on VPATH instead.
	Include dependencies in Makefile.in.
	Have dependencies rebuilt on make dist.

	* dirutil.c:
	Fix directory descriptor leak in OOM condition.
	Fix deallocating old objects in realloc OOM handling.
	(Both reported by Stefan Wiens.)

	* xoverutil.c: 
	Use Stefan's suggestion for return. If this breaks, discard your
	compiler and get GCC.

	* fetchnews.c:
	Fix getfirstlast to re-read the server's reply to the GROUP command if
	it has authenticated. Reported by Stefan Wiens.

	* fetchnews.c:
	Free split XOVER memory. Reported by Stefan Wiens.

	* leafnode.h: Add free_strlist.

	* strutil.c: new function free_strlist

	* strutil.c:
	Skip only one character to support empty fields. Reported by Raymond
	Scholz, analyzed by Stefan Wiens.

2001-06-30  Matthias Andree  <matthias.andree@gmx.de>

	* xoverutil.c:
	Fix _compxover, was broken and just worked by accident. Reported by Stefan Wiens.

2001-06-28  Matthias Andree  <matthias.andree@gmx.de>

	* TODO:
	Updated. Snapshot 2001-06-28T02:10Z.

	* xoverutil.c:
	gfixxover now copies its argument.

	* texpire.c:
	Read local groups before calling feedincoming.

	* queues.c:
	Add functionality to feed in.coming into local news store.

	* nntpd.c:
	Try non-blocking lock in dopost.
	Report lock failure after post from error to notice.

	Collect hanging children in main loop rather than at exit.

	* fetchnews.c:
	Read local groups before feedincoming.

	Adjust to changed strnsplit semantics.

	* artutil.c: Document two bugs.

	* artutil.c: Also replace CR by space.

	* getaline.c:
	Add Doxygen Javadoc-style documentation.

	* leafnode.h: Change strnsep type.
	Change gfixxover to take const argument.

	* strutil.c:
	Change strnsplit to use string of separating characters rather than
	single character.
	Add some Doxygen documentation tags.

	* leafnode.h:
	Add prototypes for queues.c.

	* texpire.c: Call feedincoming.

	* nntpd.c:
	Use feedincoming. Fixes long-standing bug of lost articles in local
	newsgroups under high system load.

	* fetchnews.c:
	Remove checkforpostings, now in queues.c.
	Use feedincoming.

	* bintrees.h: Added file.

	* bintrees.h: New file.

	* bintrees.c: Added file.

	* bintrees.c: New file.

	* artutil.c:
	Enhance storearticle to fetch its Message-ID on its own.

	* activutil.c: *** empty log message ***

	* makedepend.sh:
	Enhance to support building dependencies outside $(srcdir).

	* Makefile.in:
	Add bintrees.c and bintrees.h.
	Fix dependency generation to work outside $(srcdir).
	Recalculate dependencies.

2001-06-27  Matthias Andree  <matthias.andree@gmx.de>

	* artutil.c:
	Fix fgetheader (thus, getheader) to return the first of multiple headers
	like mgetheader does. Reported by Stefan Wiens.

	* configure.in:
	Drop --with-ipv6, do autodetect (currently checks for AF_INET6).
	Gives user instructions how to override misdetected IPv6.

	* texpire.c:
	Only output rescued thread... if debugmode > 1
	Expiremsgid now has much better logging and uses dirlist for robustness.

	* queues.c: Add missing includes.

	* queues.c: New file.

	* strutil.c:
	Fix off-by-one error in strnutil, introduced a couple of hours ago.

	* artutil.c:
	Move SKIPLWS(q) into if(q). Fixes SIGSEGV.

	* dirutil.c, lockfile.c:
	Add Doxygen Javadoc-Style documentation.

	* config.example, config.table, configutil.c, leafnode.h, nntpd.c, TODO:
	add new configuration parameter killbogus, if != 0, dogroup unlinks non-article files from groups

	* miscutil.c:
	added some Doxygen Javadoc-style documentation

	* artutil.c:
	supersede_cancel now saves the working directory

	* fopen_reg.c:
	Add Doxygen Javadoc-Style documentation.

	* Doxyfile: Minor tweaks

	* artutil.c:
	Add Doxygen Javadoc-Style documentation.

	* ChangeLog:
	Add note about broken checkin logs.

	* TODO: snapshot 2001-06-27T17:00Z

	* rnews.c:
	add mode to open O_WRONLY syscalls

	* mkstemp.c:
	Security: create temporary file with mode 0600 rather than 0666.

	* fetchnews.c: doxover: more robust.

	* configure.in:
	remove -pipe and -O3 from default GCC options

	* nntpd.c:
	MAJOR Bugfix: Does not lose article from in.coming in case of trouble
	after reporting 240 accept.

	NOTE: Does not yet move remaining articles from in.coming into news
	groups.

	A lot of robustness fixes in dopost().

	* artutil.c:
	(check_supersede_cancel) call getheader with trailing :

	* nntpd.c:
	Fix XOVER 502 syntax error reply.

	* nntpd.c:
	Fix memory leak in doselected header, reported by Stefan Wiens.

	* nntpd.c:
	fix memory leak in doselected header (if (!ap) continue case)

	* nntpd.c:
	Fix doselectedheader to deal with long header lines in overview.

	* nntpd.c:
	- Fix for bogus article counts in newsgroups that have no articles, but
	  just other groups below themselves.
	- Fix 502 syntax error in XPAT, to allow for 1234- syntax.
	- Fix XPAT/XHDR returning excess ": " when header argument in command was
	  given without tailing colon (which is the proper way to do it).
	- Fix 430 no such header to 221 no such header and return an empty list.
	- Fix ngmatch segfault when header is not found in a certain article.
	- Fix XPAT/XHDR in message-ID form to return the message-ID as first
	  argument
	- Rename n to OVfield to allow for easier maintenance.

	* artutil.c:
	revert change, complain if header argument does not contain :

	* artutil.c:
	In *getheader, append : if missing.
	In fgetheader, use log_fclose rather than fclose.

	* nntpd.c:
	Remove STRIP_TRAILING_SPACE (now in leafnode.h)
	Accomodate to changed strisprefix semantics.

	* leafnode.h:
	Move STRIP_TRAILING_SPACE into leafnode.h.
	Accomodate for strnsplit changes.

	* strutil.c:
	strisprefix: invert return value to match name
	strnsplit: do not allocate array for strings, but take it from caller
	return count of elements.

	* b_sortnl.c, config.h.in, configure.in, configutil.c, fetchnews.c, filterutil.c, leafnode.h, localutil.c, mastrncpy.c, miscutil.c, nntpd.c, rnews.c, TODO, ChangeLog:
	Replace strdup by critstrdup.
	Make copy of command in main_loop to prevent trashing through use of getaline in subfunctions.
	Make dogroup ignore non-article files in groups to return proper group count.
	In dolist, make copy of argument.
	Read active after reading local groups.

	* strdup.c: Drop (no longer needed.)

	* strutil.c: Add check_allnum.
	Comment and enhance strnsplit.

	* texpire.c, checkgroups.c:
	Replace strdup by critstrdup.
	Replace readactive by rereadactive.

	* artutil.c:
	Replace strdup by critstrdup.

	* applyfilter.c:
	Change readactive to rereadactive.

	* Makefile.in: Drop strdup.

2001-06-27  Matthias Andree  <matthias.andree@gmx.de>

	* Wee. I used the wrong comment for committing (checking in)
	rnews.c, miscutil.c, mastrncpy.c, localutil.c, leafnode.h,
	filterutil.c, fetchnews.c, configutil.c, configure.in,
	config.h.in, b_sortnl.c.

2001-06-26  Matthias Andree  <matthias.andree@gmx.de>

	* nntpd.c (dogroup): ignore non-news article files.

	* activutil.c (fakeactive): fix spurious closedir which triggered
	SIGSEGV.
	(insertgroup): change strdup to critstrdup
	(rereadactive): unconditionally rereads local groups
	(readactive): Stefan Wiens' fixes to get proper article counts.

2001-06-22  Matthias Andree  <matthias.andree@gmx.de>

	* texpire.c (expiremsgid): log "expiring message.id" on function
	entry so the user knows what's up.
	(main): move expiremsgid into locked section, until research is
	done whether concurrent texpire/nntpd/fetchnews may lose articles
	(research link behaviour AND DOCUMENT)

	* leafnode.h (SKIPLWS): new macro to skip linear white space

	* artutil.c (storearticle): move create_all_links first in
	short-cut or check (Stefan Wiens)
	(store): dito
	(mgetheader): support continuation lines as per RFC-1036 (bug
	found by Stefan Wiens)

2001-06-21  Matthias Andree  <matthias.andree@gmx.de>

	* fetchnews.c (server_info): New function to get name of server
	info file (article high water marks file) into given buffer.
	(processupstream): switch to use server_info
	include mastring.h and format.h
	(delposted): for the moment, remove unlink. article will be
	unlinked when on upstream server.
	(getgroup): enhance XHDR/XOVER logging. Log if no new articles
	found (fetched from another upstream server in that case).

	* critmem.h (critstrdup): major clean up, add critstrdup and
	mycritstrdup.

	* critmem_realloc.c (mycritrealloc): clean up dmalloc #ifdefs

	* critmem_malloc.c (mycritmalloc): clean up dmalloc #ifdefs

	* critmem_calloc.c (mycritcalloc): clean up dmalloc #ifdefs

	* critmem_strdup.c (mycritstrdup): New.

	* checkgroups.c (main): Use lock file.

2001-06-05  Matthias Andree  <matthias.andree@gmx.de>

	* nntpd.c (donewgroups): fix nntpprintf formats (%d -> %lu)
	(doxover): fix nntpprintf formats (%d -> %lu)
	(domove): fix artno to *artno (went undiscovered because
	nntpprintf did not do format string checking). Thanks to Volker
	Apelt for finding this.
	(nntpprintf): add printf-format style checking to prototype.

2001-05-23  Matthias Andree  <matthias.andree@gmx.de>

	* rnews: cannot currently be built. will require rewrite from scratch

	* configure.in: adjust and update to autoconf 2.50

2001-05-09  Matthias Andree  <matthias.andree@gmx.de>

	* nntpd.c (dolistgroup): did not return the new newsgroup if one
	had been given, returning wrong newsgroups to clients using
	LISTGROUP (such as tin).

	* miscutil.c (lockfile_exists): now write own PID into temporary
	lock file before it is linked. Prevents lock files without PID,
	that aren't removed for safety reasons.

2001-05-06  Matthias Andree  <matthias.andree@gmx.de>

	* leafnode.h (SKIPWORD): new macro to skip a char pointer over the
	first word in the string. Note: evaluates parameter 6 times, so
	the parameter must not have side effects. Parameter is
	incremented.

	* fetchnews.c (nntpactive): track time when active has last been
	read on a per-server basis, using leaf.node/last:SERVER:PORT does
	not take time argument any more
	(nntpactive): drop XGTITLE support, no longer in nntpext
	draft. Only use LIST NEWSGROUPS.

	* fetchnews.c (checkactive): removed function, no longer needed
	* fetchnews.c (updateactive): removed function, no longer needed

2001-05-04  Matthias Andree  <matthias.andree@gmx.de>

	* attributes.h: removed __inline, is unused

2001-04-29  Matthias Andree  <matthias.andree@gmx.de>

	* xoverutil.c (getxover): broken logic caused persistent
	rebuilding of intact .overview files.

2001-04-27  Matthias Andree  <matthias.andree@gmx.de>

	* attributes.h (__attribute__): fixed, was named __attributes__
	before, causing FreeBSD BDECFLAGS and non-GCC to fail.

2001-04-25  Matthias Andree  <matthias.andree@gmx.de>

	* fetchnews.c (post_FILE): pass reply line back to caller, added
	parameter char **line

2001-04-24  Matthias Andree  <matthias.andree@gmx.de>

	* xoverutil.c (_compxover): add some const tags
	(getxover): fix logging when trying to kill offending articles

        * ugid: use endpwent() 
	
	* texpire.c (dogroup): fix big memory leak

	* strutil.c: new function to allocate memory and return
	concatenated string from input string array. Useful to replace
	snprintf in various places

	* rnews.c (usage): drop optind declaration
	(processbatch): make artname into array rather than pointer (fixes
	qualifier conflict)
	(makecompressedfile): likewise for c
	(main): use (mode_t)S_IWOTH instead of 2, still gives compile-time
	warnings with -Wconversion on SuSE Linux 7.0.

	* nntpd.c: make a lot of functions static
	(gmtoff): heed PUTENV_COPIES
	(parser): make cmd a local variable, track newsgroup and artno in
	parser rather than globally, rename to main_loop
	(main_loop): renamed from parser
	(markinterest): returns error condition, internal overhaul, fixes
	logging

	* ln_log.c: move extern int verbose declaration here to prevent
	duplicate declaration via ln_log.h
	(vln_log_core): add new feature: if the environment variable
	LN_LOG_ABORT_ON_ERROR is defined (regardless of its value, may
	even be empty or 0), the first LNLOG_SERR will cause the program
	to abort. May be useful in debugging to get a proper core file or
	backtrace.

	* ln_log.h: remove extern int verbose declaration

	* nntputil.c (putaline): now requires FILE * parameter just like
	getaline does.

	* miscutil.c (parseopt): program name and optarg parameter are now
	const strings
	(lockfile_exists): new semantics

	* filterutil.c (readfilter): log filter name in warning
	(readfilter): filter file name argument is now const

	* fetchnews.c: remove global artno
	make isgrouponserver static
	(getarticle): fix off-by-one allocation error 
	(getarticle): fix dot stripping to use fputs/fputc rather than
	fprintf 
	(getgroup): output "considering (count) articles (range)" in group
	verbose mode regardless of debug mode, includes article count
	now. NOTE: Inaccurate output. See TODO (5.5)
	(post_FILE): return code rather than string (fixes obscure crashes)
	(main): only update/write active if not in postonly mode.
	(main): delposted is currently deactivated. Will do no harm other
	than try to post any article twice. NOTE: will send dupes if you
	don't run fetchnews in regular intervals. NOTE: entire posting
	functionaly needs major overhaul

	* critmem.h (critrealloc): support dmalloc (tested with dmalloc
	4.8.2), to allow for tracking the actual leafnode memory leak line
	rather than just critmem's functions.
	* critmem_calloc.c: dito
	* critmem_malloc.c: dito
	* critmem_realloc.c: dito
	
	* aclocal.m4: include PETI_WITH_DMALLOC. NOTE: This m4 script is
	copyrighted under the GNU GENERAL PUBLIC LICENSE (but since it's
	not linked, it does not affect the compiled leafnode).

	* Makefile.in: generate local.groups in LIBDIR rather than SPOOLDIR
	copy config.example from srcdir (broke build outside source tree)
	
	* .cvsignore: add configure, README

	* configutil.c: initialize expire_base to 0 for consistency
	introduce new static struct serverlist that is not iterated over
	(iterating over servers caused memory leaks in previous versions)

	* configparam.c (comp): add const qualifiers
	(find_configparam): dito

	* checkgroups.c (main): drop local extern int optind

	* attributes.h (__inline): new

	* artutil.c (store): drop msgid parameter. Add some asserts. Fix
	broken logging. NOTE: see TODO for a severe bug in store, or the
	callers thereof, respectively.
	support dmalloc

	* applyfilter.c: declare optarg, optint, opterr and optopt.
	add dmalloc support
	(main): change filterfile/readfilter logic, fix bug

	* global: introduce char s[PATH_MAX] as local variable all over
	the place. Needs review for buffer overruns.
	Fix several incorrect malloc/free semantics

	* activutil.c (_compactive): add const to local declarations
	(insertgroup): change if/else to ?: operator
	(findgroup): do ng initialization in function implementation,
	variable initializers are a GCC extension
	add dmalloc support
	(freeactive): now safe with active == 0
	(readactive): registers atexit function to clear up freeactive
	(not strictly needed since memory is freed on exit anyways)
	(insertgroup): description is now const string

	* acconfig.h: add #undef PUTENV_COPIES

	* configure.in (PUTENV_COPIES): new check to see if putenv uses
	the program's string buffer for its environment or makes a copy

2001-04-13  Matthias Andree  <matthias.andree@gmx.de>

	* strutil.c: new function memstrcat

	* miscutil.c (lockfile_exists): retry lock in non-blocking mode if
	stale lock file had been removed previously

	* texpire.c (main): release lock file if no expire time set
	(xoverextract): fix memory leak (call freexover after getxover)
	(dogroup): fix memory leak (call freexover after getxover)

	* nntpd.c (main): fix wrong error description when configuration
	file unavailable.

2001-04-09  Matthias Andree  <matthias.andree@gmx.de>

	* fix tons of memory leaks

2001-04-08  Matthias Andree  <matthias.andree@gmx.de>

	* artutil.c (supersede_cancel): also remove article from out.going
	(supersede_cancel): renamed from supersede
	(fgetheader): additional parameter to suppress rewinding
	(cancel): new function
	(check_supersede_cancel): new function, checks for Supersedes: and
	Control: cancel header in a given article file and does
	appropriate action. NO VALIDATION CURRENTLY.

	* activutil.c (findgroup): uses bsearch instead of helpfindgroup now.

	* dirutil.c (DIRLIST_ALLNUM): new, to get directory list of all
	files that consist only of digits

	* nntpd.c (main): output greeting only after active has been read.

	* xoverutil.c (helpfindxover): function deleted
	(findxover): use bsearch now that helpfindxover is gone
	(getxover): set xcount properly to make leafnode robust against
	missing lines in xover file (confused bsearch before the fix)
	(getxoverline): get bytes from stat, count only body lines
	(getxoverline): use new getfoldedline function for simplicity
	(writexover): got rid of the difficult-to-use writev which doesn't
	buy us anything, use stdio buffering instead

	* getfoldedline.c (getfoldedline): new function

	* Makefile.in: create configuration directory (found by Claudia Ludwig)

2001-03-01  Matthias Andree  <matthias.andree@gmx.de>

RELEASE

xoverutil.c:
	- fix findxover for xgroup == 0 (would segfault)

2001-01-15  Matthias Andree  <matthias.andree@gmx.de>

RELEASE 2.0b8_ma2

activutil.c:
	- merge Jörg Dietrich's storearticle() patch of 2001-01-19.
	- hand merge Jörg Dietrich's fakeactive() patch of 2001-01-20.
	  (both patches adjusted to ln_log and using *q instead of
	  strlen(q))
	- fix ln_log to include context to better determine verbosity
	  (restores pristine 1.9.x/2.0b* behaviour in _ma series)
	- new function: critcalloc
	- removed texpire-jd (discontinued)
	- add test -f in config.c generation to fix bogus error (was
	  ignored by make, though)
	- remove silent flag from lockfile_exists (handled by ln_log)
	- remove excess printf close to ln_log calls
	- escalate some error messages to LNLOG_SERR
	- don't warn, but die if gmtoff cannot allocate memory
	- if server rejects XOVER, don't try again on that server
	- fetchnews.c:checkactive: report errors
	- artutil.c:store: fix bogus "..as" logging for EEXIST case.
	
2001-01-15  Matthias Andree  <matthias.andree@gmx.de>
	
RELEASE 2.0b8_ma1
	
NOTE: this changelog part covers all changes I have made to leafnode
2.0b5 through 2.0b8 (at least what is left of it).

REMOVED FILES:
	config.c 		generated file (Makefile.in)
	pcre/chartables.c 	generated file (Makefile)

REMOVED FILES FROM CVS TREE:
	README	  	generated by Makefile.in and lynx
	configure 	generated by autoconf
	makerpm.sh 	replaced by leafnode.spec.in
	critmem.c	split into its pieces

NEW FILES:
	genconfigparam_data.awk
	
CHANGES:

Makefile.in:
	- know SED, BZIP2, LINKPCRELIB, CRYPTLIB
	- heed srcdir in CFLAGS
	- LIBDIR now uses sysconfdir as per configure.in changes
  MAJOR	- reformat MANSRC, SRCFILES, MANFILES, LIBFILES, HDRFILES,
	  PROGRAMS, EXTRASRC, EXTRAGENSRC and document these
	- introduce ALLSOURCES (holds all source variables' contents)
  MAJOR	- use .c.o and .o rules (increase maintainability)
	- pass C/LD/CPPFLAGS to PCRE Makefile
	- use b_sortnl as minimalistic sort for configuration parameters
  MAJOR	- generate some sources of tables or autoconfig data: config.c 
	  (autoconf), config_defs.h, configparam_data.c (config.table)
  MAJOR	- install and dist targets are much more compact (better
	  maintainable, easier to understand)
	- dist also generates .tar.bz2 if bzip2 is found along $PATH
	- new target: distcheck (tries to build outside source and make a
	  dist)
	- remove patch target
	- add targets to automate config/autoconf/autoheader
	- build leafnode.spec from leafnode.spec.in rather than with a
	  strange shell script
	- add automatic dependencies

TODO:
        - flood it

acconfig.h:
	- introduce HAVE_GETLINE and HAVE_INET_NTOP

activutil.c:
	- use critmem and ln_log
	- fix helpfindgroup types to long

applyfilter.c:
	- use critmem and ln_log
	- remove global variable verbose

artutil.c:
	- use critmem and ln_log
	
config.h.in:
	- automatic changes by autoheader: 
          - add uid_t, gid_t, HAVE_GETLINE, HAVE_GETTEXT 
	  - remove HAVE_AP_CONFIG_H, HAVE_LIBCRYPT, HAVE_LIBPCRE

configure.in:
	- set LYNX=no if not found
	- set GZIP to false if not found
	- set BZIP2 to false if not found
	- cache GCC options after checking them individually
	- change all AC_CACHE_VAL to AC_CACHE_CHECK (makes things shorter and
	  better maintainable)
	- add AC_TYPE_UID_T
	- automatic sysconfdir override to /etc/leafnode, replaces 
	  --with-confdir
	- put crypt linkage hints into CRYPTLIB rather than LIBS (only for 
	  nntpd)
	- add pcre linkage hints to LINKPCRELIB rather than LIBS	
	- streamline PCRE feature detection
	- use AC_REPLACE_FUNCS(getline inet_ntop)

configutil.c:
  MAJOR - switch to bsearch rather than endless strcmp loops (smaller and 
	  faster)
  MAJOR - groupinfo has a new syntax (see ChangeLog.ma)
	- use critmem, ln_log
	- add avoidxover
	- replace strtol by get_long (better error checking)
	- warn when encountering unknown configuration parameter
	- drop RLIMIT_CORE fiddling, this does not belong into programs
	  and never worked for me anyways

fetchnews.c:
	- use critmem, ln_log and get
	- switch some opendir to log_open_spool_dir
	- switch sscanf ... %ld to get_long
	- resurrect STAT in ismsgidonserver (less traffic on slow links), 
	  try HEAD if STAT does not give a proper answer
	- add delposted prototype
	- switch if getarticle control into ? : operator
	- drop explicit == NULL or != NULL comparisons
	- getfirstlast: switch n to long, use get_long
	- clean up posting function
	- do not fork and detach in debugmode
	- if forking fails, fixxover runs non-detached (comes for free with 
	  preceding change)

filterutil.c:
	- use critmem, ln_log

getaline.c:
	- use ln_log

leafnode.h:
	- define BLOCKSIZE
	- drop LOG_NEWS and stuff
	- add include <dirent.h>
	- add enum xoverfields
	- add freexover
	- add GZIP
	- add avoidxover
	- define FQDN_SIZE
	- drop critmalloc/critrealloc
	- add check_allnum_minus, cuttab from strutil.c
	- add log_open_dir, log_open_spool_dir from dirutil.c
	- add inet_ntop

localutil.c:
	- use critmem, ln_log

miscutil.c:
	- use critmem, ln_log and ugid
	- drop BLOCKSIZE (-> leafnode.h)
	- put required directories into a struct
	- fix initvars to use ugid library (encapsulate OS differences)

nntpd.c:
	- use critmem, ln_log, get
	- drop sockaddr_union
	- drop printf for escaping
	- use xover data in NEWNEWS (supposed to be faster)
	- fix POST without body (leafnode now emits error even if the 
	  single-dot line comes before the blank line that separates header 
	  and body)
SECURITY- use snprintf into 800 character buffer for Message-ID generation
	  (used to be sprintf)
	- fix boolean-used variables to NOT be explicitly compared against 
	  FALSE (bad style)

vsnprintf.c:
	- fix prototype in mcatch
	- move ret = n + 1 to actual return

xoverutil.c:
	- use critmem, ln_log
	- move sys/types.h and sys/stat.h up
	- init lineend anew each time
	- cast fchmod argument to mode_t
	- implement freexover

----------------------------------------------------------------------------

History of 2.0b8 -- changes since 2.0b7:

fetchnews:
=========

080101: main(): if -P was used, fetchnews crashed when trying to
        write the active file (since it was not read anyway).

nntpd:
=====

090101: implemented authinfo support. If using passwords, authinfo
	information is expected to reside in $(LIBDIR)/users. This
	file should only be readable by the user "news". The format
	is "username crypted_password" per line. Crypted passwords
	can be generated with the new perl script "make_pass.pl"
	which is provided in the "tools/" subdirectory. "make_pass"
	expects username and uncrypted password on the command line
	and writes username and crypted password to stdout.

Miscellaneous:
=============

080101: fixed a typo in INSTALL. Discovered by Bruno Rohee
	<rohee@OpenBSD.ORG>.
080101: changed the FAQ somewhat. Suggested by Bruno Rohee
	<rohee@OpenBSD.ORG>.
080101: changed the text of leafnode.8.in somewhat to avoid confusion.
	Suggested by Dan Jacobson <jidanni@kimo.com.tw>.

----------------------------------------------------------------------------

History of 2.0b7 -- changes since 2.0b6:

fetchnews:
=========

030101: main(): variable "newsgroup" made static. Reported by Stefan
	Fleiter <stefan.fleiter@gmx.de>, patch by Matthias Andree
	<matthias.andree@web.de>.

libutil:
=======

040101: Matthias Andree <matthias.andree@web.de> put getaline.c and
	getline.c under the LGPL.
040101: getaline still sucked. After some benchmarking, it was replaced
	by the getaline() written by Matthias Andree <matthias.andree@web.de>
	which is getc()- and not fgets()-based. This version is only about
	40% as fast as the old one, but much more robust against NUL bytes
	in strings.
030101: configutil: format error in readconfig() fixed. Reported by
	Stefan Fleiter <stefan.fleiter@gmx.de>.
030101: activutil: helpfindgroup() dumped core on several architectures (with
	(int)high = -1 and low = 0). Bug report and patch by Gunnar Ritter 
	<g-r@bigfoot.de>.

Miscellaneous:
=============

040101: updated CREDITS
030101: Makefile.in: if fetchnews had not been run at least once, "make
	uninstall" barfed. Reported by Martin Kissel <martinkissel@sharing.de>.
030101: Makefile.in: if no /etc/leafnode/config was already installed,
	"make install" barfed. Reported by Martin Kissel
	<martinkissel@sharing.de>.
030101: configure.in: socklen_t test failed on OpenBSD because <sys/types.h>
	was not included before <sys/socket.h>. Patch by Bruno Rohee
	<rohee@OpenBSD.ORG>.

----------------------------------------------------------------------------

History of 2.0b6 -- changes since 2.0b5:

General comments:
================

221200: everything except Makefile.in and the various templates for
	manpages is now functionally identical to leafnode-2.0b5_ma6.
221200: replaced all TODOs with FIXMEs.
221200: miscutil.c, nntpd.c, nntputil.c, rnews.c, texpire.c and xoverutil.c
	are now functionally identical to leafnode-2.0b5_ma6.
151200: filterutil.c and localutil.c are now functionally identical to
	leafnode-2.0b5_ma6.
271100: checkgroups.c, config.c, configutil.c and fetchnews.c are now
	functionally identical to leafnode-2.0b5_ma6.
241100: activutil.c, applyfilter.c and artutil.c are now functionally
	identical to leafnode-2.0b5_ma6.
241100: syslog( ..., "%m" ) is proper logging according to "Advanced
	Programming in the UNIX environment", p.422:
	  The format argument, and any remaining arguments, are passed to
	  the vsprintf function for formatting. Any occurrence of the two
	  characters %m in the format are first replaced with the error
	  message string (strerror) corresponding to the value of errno.

applyfilter:
===========

221200: main(): the reply of readconfig() is now stored in i instead of
	n because it is signed.
241100: main(): if called with options, program would terminate with
	usage message. Patch by Matthias Andree
	<matthias.andree@web.de>.

fetchnews:
=========

221200: testheaderbody(): argument is now int instead of char.
211200: main(): if timeout_active is expired, the active file is not
	read any more. Only this leads to the removal of deleted
	groups. Problem described by Ulf Herbers <ulf@herbers-schramm.de>.
191200: do_server() now has an additional parameter "newsgroup" which
	should it make possible in the future to evaluate the -N option
	(which doesn't work yet).
291100: postarticles(): an open article file was not closed under
	certain circumnstances. Bug found by Carl D. Craven
	<raven@phoenyx.net>.
271100: checkactive(): casted time_t differences to long before syslog()ging
	them. Patch by Matthias Andree <matthias.andree@web.de>.
271100: getgroup() has to consider the new return values for doxhdr() or
	doxover(). At the moment, no special action is implemented if
	-2 is returned instead of -1.
271100: doxhdr() now also returns -1 for error, -2 if XHDR was rejected.
271100: doxover() now returns -1 for error, -2 if XOVER was rejected.
	Suggested by Matthias Andree <matthias.andree@web.de>.
271100: "throttling" is used as a parameter for sleep() which prefers
	unsigned int. Fixed by Matthias Andree
	<matthias.andree@web.de>.
271100: getarticles(): Variables sent, recd, window have also to be signed.
	Fixed by Matthias Andree <matthias.andree@web.de>.
271100: Since "n" in getarticles() is signed, the values it is compared
	with should be also signed. Therefore, "windowsize" is now signed
	as well. Fixed by Matthias Andree <matthias.andree@web.de>.
271100: getarticles(): since "outstanding" is not unsigned, the parameter
	"n" should not be unsigned either. Fixed by Matthias Andree
	<matthias.andree@web.de>.
271100: getgroup(): since "outstanding" can assume -1, it should not be
	unsigned. Fixed by Matthias Andree <matthias.andree@web.de>.
271100: getmarked(): second parameter of truncate() now casted to off_t.
	Patch by Matthias Andree <matthias.andree@web.de>.
271100: getmarked(): improved error logging if file in "interesting.groups"
	could not be read or written. Suggested by Matthias Andree
	<matthias.andree@web.de>.
271100: delposted(): now deleting posted articles using full pathnames.
	Suggested by Matthias Andree <matthias.andree@web.de>.
271100: getgroup(): implemented "usexhdr" after a suggestion by Matthias
	Andree <matthias.andree@web.de>.
261100: getfirstlast(): if using "fetchnews -x" and the number being
	higher than the high water mark on the upstream server, integer
	underflows could happen. Bugs fixed by Stefan Wiens <s.wi@gmx.net>.
241100: getgroup(): if outstanding() returns 0, the last article will
	be considered again in the next fetchnews run. Bug fixed by
	Stefan Wiens <s.wi@gmx.net>.
241100: main(): since locking is done based on fcntl() (and the
	lockfile left open during the process), the lockfile
	should not be unlinked. Just closing it will release the lock.
241100: main(): moved writeactive() into the main process. This
	simplifies the locking scheme considerably.
141100: doxover() crashed if XOVER lines were truncated, e.g. on
        "... de." because strchr(p,':') returned a NULL pointer
	which then was attempted to modify. Fixed.

libutil:
=======

221200: nntputil: nntpconnect(): various changes by Matthias Andree
	<matthias.andree@web.de> to provide more instructive
	error messages.
221200: nntputil: nntpconnect(): shutdown nntpin as well as nntpout.
	Patch by Matthias Andree <matthias.andree@web.de>.
221200: nntputil: nntpconnect(): patch by Matthias Andree
	<matthias.andree@web.de> to provide for proper handling
	of failed dup().
221200: miscutil: getaline(), critmalloc() and critrealloc() moved into
	separate files which makes it easier to test them. Done first
	by Matthias Andree <matthias.andree@web.de>.
221200: miscutil: copyfile(): "toread" and "read" declared as "size_t"
	instead of "long". Done first by Matthias Andree
	<matthias.andree@web.de>.
221200: miscutil: fqdn string size now defined via #define as FQDN_SIZE.
	Done first by Matthias Andree <matthias.andree@web.de>.
221200: miscutil: removed "#define LM_SIZE" because the defined constant
	was not used anyway. Done first by Matthias Andree
	<matthias.andree@web.de>.
221200: miscutil: GNU getline() not used anymore since it chokes on
	"strings" not ending with either NUL, CR or LF. Verified with
	Matthias Andree's <matthias.andree@web.de> getaline
	test suite from leafnode-1.9.17ma3.
221200: miscutil: getaline() reverted to the 1.9.16 version which chops
	off things after a NUL byte. This version ignores single NUL
	bytes to be read, but this is irrelevant for reading NNTP
	traffic or textfiles.
221200: activutil: writeactive(): count now size_t instead of int.
221200: activutil: helpfindgroup() now uses size_t instead of long for
	low, high and mid.
221200: miscutil: parseopt()s second argument is now int instead of char.
	Triggered by playing around with the -Wconversion flag of gcc.
211200: added a mkstemp.c file written by myself. This replaces the
	insecure call to mktemp() in xoverutil.c which would occur if
	./configure could not find mkstemp(). The new mkstemp() is
	reasonably secure but not bullet-proof (it will not retry to
	open a file under a different name which is stoopid).
151200: localutil: moved "local.groups" file from /var/spool/news/leaf.node
	(i.e. a subdirectory of SPOOLDIR) to /etc/leafnode (i.e.  LIBDIR)
	because it is a configuration file that has to be edited from
	hand, not something written by leafnode.
151200: filterutil: cast the result of strlen() in the pcre_exec() call
	to int. Suggested by Matthias Andree <matthias.andree@web.de>.
271100: localutil: empty lines would lead to strange things when doing
	LIST. Fixed. Reported by Joerg Dietrich <joerg@dietrich.net>.
271100: configutil: readconfig(): implemented "usexhdr" after a suggestion
	by Matthias Andree <matthias.andree@web.de>.
271100: miscutil: initvars() now unconditionally loses its privileges.
	Correct output in case of errors is directed by isatty().
	Suggested by Stefan Wiens <s.wi@gmx.net>.
261100: miscutil: if a program that is installed suid root (e.g. fetchnews,
	texpire) shall reliably drop its privileges, the parameter given
	to initvars() cannot be argv[0] because this could possibly be
	overwritten by a malicious user. Therefore we use string constants
	now. Problem reported by Stefan Wiens <s.wi@gmx.net>.
241100: artutil: fgetheader(): "hlen" now defined as size_t instead of
	long. Suggested by Matthias Andree <matthias.andree@web.de>.
241100: artutil: mgetheader(): some casting from "long" to "size_t".
	Suggested by Matthias Andree <matthias.andree@web.de>.
241100: activutil: fakeactive(): switched format string to "long unsigned"
	in debuglog. Patch by Matthias Andree
	<matthias.andree@web.de>.
241100: activutil: readactive(): "bufsize" now defined as size_t instead
	of long. This results in a lot of casting. Suggested by Matthias
	Andree <matthias.andree@web.de>. IMO all these various
	prototypes (size_t, off_t, ...) for "long" really suck. 
241100: activutil: helpwriteactive(): switched "mid" back to "long"
	instead of "unsigned long". Suggested by Matthias Andree
	<matthias.andree@web.de>.
241100: activutil: writeactive(): "c" now statically allocated. Suggested
	by Matthias Andree <matthias.andree@web.de>.
241100: activutil: mergegroups(): "count" now defined as size_t instead
	of int.
241100: activutil: "activesize" now defined as size_t instead of int.
	Patch by Matthias Andree <matthias.andree@web.de>.
241100: miscutil: removed double inclusion of fcntl.h
201100: localutil: islocal() would sometimes free a pointer which was
	not allocated. Fixed.

nntpd:
=====

020101: dogroup(): inserted omitted closedir().
020101: dogroup(): when counting the contents of a directory, the .overview
	file was always counted as well
020101: dogroup(): if a group is empty, return "211 0 0 0" instead of
	"211 0 number number".
020101: dolistgroup(): if a group has already been marked as "interesting"
	but is empty, dolistgroup() does not return article numbers.
020101: switched of debug logging in fprintpseudobody()
221200: replaced the whole untested IPV6 code in main() with a patch by
	Matthias Andree <matthias.andree@web.de>.
221200: fopenart(): somebody had requested to have a pseudoarticle in
	local groups as well. It turns out that this is quite inconvenient,
	therefore this has been removed again (can't see when it was
	introduced).
221200: fopenpseudoart(): for some reason the article number was
	"unsigned long long" instead of "unsigned long". Fixed by
	Matthias Andree <matthias.andree@web.de>.
241100: replaced all occurrences of "syslog(..., "%s", strerror(errno))"
	with "syslog(..., "%m")".
241100: when posting, the child process now closes stdin, stdout and
	stderr. This lets inetd close the connection if the parent
	process dies. Patch by Stefan Wiens <s.wi@gmx.net>.
201100: new function ismoderated() returns first moderated newsgroup
	name in a Newsgroups: line. Modelled after islocal().
161100: parser(): timeout was quit with 421 which slrn did not like.
	No leafnode closes the connection with 400. Bug reported by
	Karsten Petersen <karsten.petersen@informatik.tu-chemnitz.de>.
311000: dopost(): now recommends a Message-ID.
311000: dopost(): checks for duplicates. Suggested by Stefan Wiens
	<s.wi@gmx.net>. Became necessary because the new nntpd stores
	postings locally.
301000: gmtoff() returned wrong values. Bug discovered and fixed by
	Stefan Wiens <s.wi@gmx.net>.

texpire:
=======

221200: dogroup(): various castings introduced with a patch by Matthias
	Andree <matthias.andree@web.de>.
271100: dogroup(): inserted a bug on 241100: an unsigned int cannot
	become < 0; therefore it makes no sense to write
	unsigned int a;
	for ( a=some_value; a >= 0; a--) { ... }
	Pointed out by Joerg Dietrich <joerg@dietrich.net>.
241100: savethread() rewritten by Stefan Wiens <s.wi@gmx.net> because
	it did not check the last References: entry.
241100: if an .overview file contained more entries than files are
	present in the corresponding directory (i.e. current became
	> acount), interesting things could happen. It is not clear
	from looking at the code whether this could occur. Fixed by
	Stefan Wiens <s.wi@gmx.net>.
221100: repaired threading (hopefully) by marking all articles as
	killed before the actual cycling for rescue starts. The bug
	was introduced into 2.0a15 on 210800. Noted by Joerg Dietrich
	<joerg@dietrich.net>.

Miscellaneous:
=============

020101: repaired formatting of the man pages.
020101: made man pages subject to formatting by configure, as exemplified
	by Matthias Andree <matthias.andree@web.de> in
	leafnode-2.0b5_ma7.
020101: fiddled around with Makefile.in to make it functionally identical
	with leafnode-2.0b5_ma7.
171200: configure.in: socklen_t may not be defined in
	/usr/include/sys/socket.h ; therefore included a typedef
	statement in leafnode.h dependent on a new test in configure.in.
	Problem reported by Kaspar Klingholz <kp@balu.klingholz.de>.
111200: configure.in: removed wildcard rule for *.c -> *.o conversion
	implemented on 291100 because it works only with GNU make.
081200: configure.in/Makefile.in: gzip replaced with a search for
	gzip; suggested by Bruno Rohee <rohee@OpenBSD.ORG>. It's yet
	unclear what we do if we can't find it :-)
011200: Makefile.in: when uninstalling, testing for $PCRELIB did not
	work if a dynamically linked pcrelib existed. Now pcre.7 is
	unconditionally removed. Bug reported by Stephane Boffin
	<sboffin@nertec.com>.
011200: Makefile.in: when uninstalling, the variable $INSTALLROOT was
	incorrectly declared. Bug reported by Stephane Boffin
	<sboffin@nertec.com>.
291100: Makefile.in: replaced the various rules for *.o files with a
	single one. However, it is not clear whether this single rule
	will work with non-GNU make.
291100: added additional "-W" flag for compilation in configure.in
271100: added Theo de Raadt's copyright to the README.
271100: added Rich Salz's copyright to the README.
271100: fixed leafnode.8 to include new "usexhdr" variable.
241100: fiddled with configure.in following ideas by Matthias Andree
	<matthias.andree@web.de>.
241100: version is now defined in configure.in so that the Makefile.in
	doesn't have to be touched (ideally).
241100: Makefile.in: changed the VPATH declaration to include the
	current directory. (I have actually no idea why one would need
	this variable :-)
161100: Makefile.in: "install:" rule now also depends on a compiled rnews
301000: Makefile.in: changed the "dist:" rule to make use of the new
	stuff described in the next paragraph.
301000: Makefile.in: added some stuff from the autoconf documentation
	which will cause automagic autoheader/autoconf if one of the
	relevant files is changed. Patch by Matthias Andree
	<matthias.andree@web.de>.

----------------------------------------------------------------------------

History of 2.0b5 -- changes since 2.0b4:

fetchnews:
=========

301000: doxover(): when returned XOVER lines were truncated because of
	very long References: section, a segfault was the result. Now
	doxover() generates a truncated pseudo-header without any
	Lines: and Bytes: entries.
301000: doxover(): now killfilter() is applied before stat()ing the
	message id. This should speed up the program.
301000: newsgroups are only written into /var/spool/news/leaf.node/ser.ver.name
	if indeed present on that server.

libutil:
=======

301000: configutil: "filtermode" was set to FM_HEAD & FM_XOVER which was
	0. Set to FM_HEAD | FM_XOVER which equals FM_BOTH.

Miscellaneous:
=============

291000: configure.in looks for lynx to generate README
291000: "make dist" automatically generates a new README from README.html
	if lynx is found
291000: removed obsolete German and Catalan documentation.

----------------------------------------------------------------------------

History of 2.0b4 -- changes since 2.0b3:

applyfilter:
===========

291000: the char constant -\|/ is now declared "const". Patch by
	Matthias Andree <matthias.andree@web.de>.
291000: made "n" unsigned long. Suggested by Matthias Andree
	<matthias.andree@web.de>.

fetchnews:
=========

291000: main(): msgid declared as "static" which removes the obnoxious
	warning about it being affected by longjmp().
291000: doxover() and doxhdr(): converted a few "unsigned char *" into
	"char *". Suggested by Matthias Andree
	<matthias.andree@web.de>.
291000: made global variable "windowsize" unsigned long. Suggested by
	Matthias Andree <matthias.andree@web.de>.
291000: doxhdr: removed unnecessary parameter "groupname" from declaration.
	Suggested by Matthias Andree <matthias.andree@web.de>.

libutil:
=======

291000: xoverutil: writexover(): new variable lineend to bring constant
	"\n" into header. Suggested by Matthias Andree
	<matthias.andree@web.de>.
291000: miscutil: error logging in critmalloc()/critrealloc() is now
	done with long instead of int. Patch by Matthias Andree
	<matthias.andree@web.de>.
291000: miscutil: did casting of malloc()/realloc() return values in
	critmalloc()/critrealloc(), respectively. Patch by Matthias
	Andree <matthias.andree@web.de>.
291000: activutil: readactive(): return value of memchr() is now casted.
	Patch by Matthias Andree <matthias.andree@web.de>.
291000: activutil: helpfindgroup() could return -1 and therefore should
	not be declared "unsigned". Patch by Matthias Andree
	<matthias.andree@web.de>.
291000: xoverutil: return value of findxover() now long int instead of int.
	Suggested by Joerg Dietrich <joerg@dietrich.net>.
291000: xoverutil: parameter to findxover() now declared as unsigned long
	instead of int.
291000: filterutil: killfilter(): removed unnecessary parameter "artno".
	Suggested by Matthias Andree <matthias.andree@web.de>.
291000: artutil: modified call of store() by removing all unnecessary
	parameters. Suggested by Matthias Andree
	<matthias.andree@web.de>.
271000: xoverutil: helpfindxover() would segfault under certain
	circumstances if the calculation of "new" yielded 0. Bug
	fixed by Joerg Dietrich <joerg@dietrich.net>.

nntpd:
=====

291000: global variable "cmd" declared "static". Suggested by Matthias
	Andree <matthias.andree@web.de>.
291000: dolistgroup(): declared art as unsigned long instead of int.
	Suggested by Matthias Andree <matthias.andree@web.de>.
291000: doxover(): declared art, a, b as unsigned long instead of int.
	Suggested by Matthias Andree <matthias.andree@web.de>.
291000: doselectedheader(): declared a, b and c as unsigned long instead
	of int. Suggested by Matthias Andree
	<matthias.andree@web.de>.

General:
=======

291000: renamed all variables called "new" to something else. This makes
	it possible to compile leafnode with g++ which does much stricter
	type-checking than gcc. Suggested by Matthias Andree
	<matthias.andree@web.de>.

----------------------------------------------------------------------------

History of 2.0b3 -- changes since 2.0b2:

fetchnews:
=========

271000: yesterday we did a number of "if ( port == 119)" constructs.
	Only today we realized that, if the default port is used,
	"port" is set to zero. Made the proper changes.
261000: made several changes to accommodate retrieving news from the
	same server on different ports. Unfortunately I have no idea
	any more who sent me the patch.
261000: nntpactive(): To avoid a compiler warning, we let strftime()
	produce a four-digit year; in the next line, we skip the
	first two digits, though. Code written by Matthias Andree
	<matthias.andree@web.de>.
261000: doxover(): the generated pseudoheader now also contains a
	Bytes: header. Patch by Joerg Dietrich <joerg@dietrich.net>.
261000: getarticle(): killfilter() was employed regardless of the
	filtermode. Bug spotted by Joerg Dietrich <joerg@dietrich.net>.

libutil:
=======

271000: artutil.c: store() didn't initialize the static variable cg
	which might have resulted in a core dump. Fixed. Problem
	reported by Stefan Fleiter <stefan.fleiter@gmx.de>.
271000: made strdup.c a separate file. Unfortunately it doesn't compile
	at all, and I don't know why.
271000: added a vsnprintf() by Theo de Raadt with BSD license that
	also contains snprintf(). Therefore I removed both the
	snprintf() and vsnprintf() from miscutil.c. This fixes the
	problem outlined below.
261000: artutil: storearticle() did not honour "create_all_links". Patch
	by Joerg Dietrich <joerg@dietrich.net>.
261000: configutil: filtermode now set by default to (FM_XOVER & FM_HEAD) .
251000: miscutil: inserted a very crude replacement for vsnprintf()
	using vsprintf() to make Leafnode compile on OSF1. It is clear
	that vsprintf() is prone to buffer overflow attacks.

nntpd:
=====

261000: fopenart(): if a local group is visited, no pseudoarticle is
	present. Suggested by Joerg Dietrich <joerg@dietrich.net>.
251000: did not compile with IPV6 because the logging of connections
	always assumed IPV4 addresses. Error reported by Mark Brown
	<broonie@sirena.org.uk>. Very crude fix by omitting any
	reporting if compiled with IPV6.

rnews:
=====

221200: processfile(): Matthias Andree <matthias.andree@web.de>
	fixed format string of first fprintf() statement.
221200: makecompressedfile() now uses mkstemp() instead of tmpnam().
	Patch by Matthias Andree <matthias.andree@web.de>.
221200: processbatch() now uses mkstemp() instead of tmpnam(). Patch by
	Matthias Andree <matthias.andree@web.de>.
221200: rnews now learns the location of "gzip" from the Makefile.
261000: rnews didn't know local groups. Patch by Joerg Dietrich
	<joerg@dietrich.net>.

Miscellaneous:
=============

261000: leafnode.h: included <sys/types.h> to account for "size_t".
	Suggested by Matthias Andree <matthias.andree@web.de>.
261000: removed miscellaneous references to COPYING. Noted first by
	Phil Hunt <philh@comuno.freeserve.co.uk>.
251000: leafnode.h: added vsnprintf() prototype
251000: leafnode.h: size_t may only occur in a file after stdio.h has
	been included, otherwise gcc on OSF1 will barf. Error reported
	by Joerg Dietrich <joerg@dietrich.net>.

----------------------------------------------------------------------------

History of 2.0b2 -- changes since 2.0b1:

libutil:
=======

251000: xoverutil: gfixxover(): argument of isspace() was not casted
	to unsigned char. Reported by Joerg Dietrich <joerg@dietrich.net>.
251000: miscutil: snprintf(): unused variable rval was present.
	Reported by Joerg Dietrich <joerg@dietrich.net>.
251000: artutil: mgetheader(): argument of isspace() was not casted to
	unsigned char; instead the result of isspace() was casted. Bug
	reported by Joerg Dietrich <joerg@dietrich.net>.

nntpd:
=====
251000: list(): argument of tolower() was not casted to unsigned char.
	Reported by Joerg Dietrich <joerg@dietrich.net>.

Miscellaneous:
=============

251000: leafnode.h: added a declaration of snprintf() for systems
	which don't provide is (snprintf() is defined in miscutil.c).
	Bug reported by Joerg Dietrich <joerg@dietrich.net>.
251000: README: added a section on deinstallation. Suggested by
	Juergen Salk <juergen.salk@gmx.de>.
251000: Makefile.in: if no pcrelib is installed, "make uninstall" or
	"make uninstall-bins" will now remove pcre.7 as well. Patch
	provided by Juergen Salk <juergen.salk@gmx.de>.
251000: Makefile.in: "make install" now also creates
	/var/spool/news/local.groups . Suggested by Stefan Fleiter
	<stefan.fleiter@gmx.de>.

----------------------------------------------------------------------------

History of 2.0b1 -- changes since 1.9.4:

applyfilter:
===========

181000: for some reason, applyfilter doesn't work.
181000: applyfilter was always called with argv[1]. Now it is called
	with argv[optind] which ensures that the newsgroup is correct.
080900: adjusted main() to new format of parseopt().
080900: adjusted main() to new format of readconfig().
120300: fixed call of lockfile_exists() to accommodate new format. Patch
	by Joerg Dietrich <joerg@dietrich.net>.
010899: terminate if filterfile is not present. Bug reported by
	Marcus Szumigala <MSzumigala@gmx.net>.
210799: fix .overview file after killing articles

fetchnews:
=========

181000: doxover(): articles were actually not marked for download even
	if filtering was successful
181000: doxover(): an essential piece of code was missing to assemble an
	article header from the xover line. Fixed.
171000: doxhdr(): the message ids are now not logged anymore
131000: doxover(): output of XOVER not logged any more
121000: two new global variables, groupfetched and groupkilled, to count
	fetched and killed articles per group.
121000: doxover() loses one parameter which wasn't used anyway.
280900: -F works again through new function getconffile().
270900: switched back to reading config file *before* evaluating options.
	However, this breaks -F.
270900: managed to change the behavior of -S so that usernames and
	passwords in the config file are used but servers *only* in
	the config file are not.
270900: new function do_server() which incorporates some functionality
	of the former main().
140900: moved supersede() into artutil.c. Patch by Joerg Dietrich
	<joerg@dietrich.net>.
140900: checkinteresting() should only be called if fetchnews is
	invoked without -n. Fixed by Joerg Dietrich <joerg@dietrich.net>.
140900: F: was missing in the getopt() call. Reported by Joerg
	Dietrich <joerg@dietrich.net>.
080900: added option "-M message-id" to retrieve only a single message-id
080900: added option "-F configfile" to read from a different configuration
	file
080900: adjusted main() to new format of parseopt().
080900: adjusted main() to new format of readconfig()
060900: if "LIST NEWSGROUPS news.group.name" does not work for the first
	new group, no second attempt to get a groupname is made. Suggested
	by Carlos Robinson <cerobinson@teleline.es>.
060900: some minor changes in main() and getfirstlast() (mostly removal
	of debugging messages).
040800: implemented catching of SIGUSR1 and SIGUSR2 to increase or
	decrease verbosity on the fly. Patch by Colin Brough
	<Colin.Brough@btinternet.com>.
040800: implemented the new locking mechanism for fetchnews, to avoid
	getting into troubles with the nntpd. Written by Joerg
	Dietrich <joerg@dietrich.net>.
040800: new function checkforpostings(). This avoids connecting with any
	upstream server if there is nothing to post and fetchnews is
	invoked with -P.
280700: new function freeserverlist(), needed by main().
280700: main(): regrouped some invokements.
280700: main(): removed unused variable "usesupplement".
280700: main(): implemented -S option, after a patch by Joerg Dietrich
	<joerg@dietrich.net>.
280700: main(): the configuration must be read before parsing the options.
	Patch by Joerg Dietrich <joerg@dietrich.net>.
280700: getgroup(): since the return value of getfirstlast() can be
	negative, the variable x containing it cannot be unsigned. Bug
	fixed by Joerg Dietrich <joerg@dietrich.net>.
280700: getarticle(): free used memory. Patch by Joerg Dietrich
	<joerg@dietrich.net>.
280700: getarticle(): Joerg Dietrich <joerg@dietrich.net> added support for
	Supersedes. TODO: this should only be conditionally switched on.
280700: getfirstlast(): if the server does have an empty group, return
	FALSE. Patch by Joerg Dietrich <joerg@dietrich.net>.
280700: getfirstlast(): if more "extraarticles" are requested than there
	are articles on the server, the function became confused (because
	negative numbers were generated). Fixed by Joerg Dietrich
	<joerg@dietrich.net>.
280700: sigcatch() also catches SIGALRM now. Patch by Joerg Dietrich
	<joerg@dietrich.net>.
140700: moved age() to filterutil.c
140700: doxover(): moved killing of maxage, maxlines, minlines, maxbytes
	and maxcrosspost into filterutil.c. This has the advantage that
	it is possible to apply these criteria in a newsgroup-specific
	fashion.
140700: getgroup(): removed the check to interesting.groups. Instead,
	we check all groups once at the startup of fetchnews (and
	texpire).
120700: new function doxhdr() which is called if there are no filter
	settings for a newsgroup. This should improve the speed because
	in that case only Message-IDs and not complete headers have to
	be transferred. Based on a posting to de.comm.software.newsserver
	by Juergen Strohmayer <usenet@bigfoot.de>.
010700: nntpactive(): since some wierd news servers have not implemented
	LIST ACTIVE, use LIST instead
120300: doxover(): removed strtok() code from 180100 because it didn't
	work at all. Replaced it with the original code of 170100 and
	re-inserted the bugfix from 230200. This code may still not be
	fully correct.
120300: fixed calls of lockfile_exists() to accommodate new format.
	Patch by Joerg Dietrich <joerg@dietrich.net>.
040300: insertgroup(): if fetchnews -f was called, creation time was
	not set to 0. Bug discovered and fixed by Joerg Dietrich
	<joerg@dietrich.net>.
230200: doxover(): when maxage was set to 0, all articles were killed.
	Bug reported by Johannes Stezenbach.
130200: nntpactive(): new groups reported by NEWGROUPS were not inserted
	in the groupinfo file (and would have been inserted with a wrong
	date). Bug found and fixed by Joerg Dietrich <joerg@dietrich.net>.
180100: rewrote doxover() based on code by Vladimir Dozen
	<dozen@do-labs.spb.ru>.
130199: if "LIST NEWSGROUPS" returned just "215" without any text, fetchnews
	became confused. Reported by Pasqualino Casciano
	<pasqualino.casciano@stud.lrz-muenchen.de>.
130100: ismsgidonserver(): waited for more lines after a 430 error message.
	Bug discovered and fixed by Joerg Dietrich <joerg@dietrich.net>.
080100: doxover(): more informative error message if XOVER fails
080100: doxover() returns now the correct values if all articles are
	already downloaded.
010100: ismsgidonserver() now uses HEAD instead of STAT since STAT
	implementation is buggy with some nntp servers (problem
	reported by Qing Liu <liu@math.u-bordeaux.fr>).
211299: automatic unsubscription of groups got lost in the rewriting
	process. Fixed (I used the leafnode-1.9.8 variant).
291199: ismsgidonserver() re-written to care for buggy nntpcache (at least
	some versions of nntpcache reply to STAT <msgid> with "223", even
	if there is no article <msgid>).
251199: lockfile is unlocked after writing active file since we don't
	need to lock for writing overview files (at least I have not
	encountered any locking problems with overview files so far,
	and the nntpd doesn't lock either).
181199: removed all the old code since the new one was working quite
	satisfactorily as of 151199.
181199: case of newsgroups is not changed anymore.
151199: mgetheader(): various additions of globalfetched and globalkilled
	made by Joerg Dietrich <joerg@dietrich.net>.
151199: mgetheader(): space allocated for pseudo headers was not initialized
	properly. Bug found and patched by Joerg Dietrich
	<joerg@dietrich.net>.
091199: getarticle(): before writing Xref: headers, an empty line was
	inserted. Bug found and patched by Joerg Dietrich
	<joerg@dietrich.net>.
091199: getarticle(): fopenmsgid() was called with the message id, not
	the pathname. Bug found and patched by Joerg Dietrich 
	<joerg@dietrich.net>.
091199: getarticle(): Xref: from upstream header should not be saved.
	Bug found and patched by Joerg Dietrich <joerg@dietrich.net>.
061199: filtering on maxlines and minlines did not always work. Bug found
	and patched by Joerg Dietrich <joerg@dietrich.net>.
041199: (old) getgroup(): if a header was not found, fetchnews would segfault.
	Bug found and fixed by Arkadiusz Mi¶kiewicz <misiek@misiek.eu.org>.
	(I thought I had fixed this already. Apparently not.)
011199: mgetheader() did look for headers at the end of the line instead of
	the beginning. Fixed.
011199: age() now checks whether it gets a full "Date:" header or only the
	date without the header.
011199: doxover() debugged with ddd uncovered several small errors which
	prevented the new getgroup() from running properly.
271099: made a few changes to updateactive(): when atime of active.read was
	newer than current date, it was not changed. Now, fetchnews also
	produces a warning if this happens.
251099: made a few changes to (old)getgroup()
161099: Joerg Dietrich <joerg@dietrich.net> fixed a bug in doxover() which
	prevented xoverlines from being parsed correctly.
081099: getbody() deleted.
081099: rewrote getmarked() because it was seriously f...ed up. It now
	uses the new function getarticle() instead of getbody().
061099: introduced new #define OLDVERSION which is set for the old version
	and should be unset when trying to compile (and test) the new version
	which still contains a gazillion of bugs.
061099: delposted(): now we delete everything that was created in out.going
	before fetchnews started instead of making lists. Saves memory and
	is conceptually simpler (except if somebody has changed the clock
	between the actual posting event and the call of fetchnews).
031099: postarticles(): added a missing fclose() and a missing closedir()
	when a timeout occurred during posting. Bug reported by Brian
	Ewins <brian.ewins@bt.com>.
220999: nntpactive(): if upstream server understands XGTITLE, new groups
	and their descriptions were not entered in active file. Fixed
	(hopefully). Bug discovered by Carsten Bobek <c.bobek@gmx.de>.
140999: fixed a bug in getparam(): numerical parameters were not evaluated
	correctly
120999: getfirstlast(): now properly yields parameters
230899: continued the "big rewrite". New functions are:
	- getarticles(): get all articles in a newsgroup using overlapping
	  NNTP commands.
	- getarticle(): getting the single article. This function is not
	  written yet.
	- legalheaders(): check if a message has all legal headers present
	- getmsgid(): extract message-id from headers in memory
180899: usage(): program was still called "fetch". Reported by Christian
	Fertig <fertig@informatik.uni-frankfurt.de>.
180899: oldgetgroup(): if there were more than one blank between header
	and header contents, the contents were mangled (not properly
	truncated, that is). Bug reported by Gerd R. Greye
	<gerd.greye@pironet.netsurf.de>.
050899: removed all calls of tgetaline() since it did not work as
	intended.
270799: getgroup(): xover header are now filtered.
260799: added check for message ids in getgroup().
260799: messed around with processupstream() which didn't read its written
	data properly
250799: started the big rewrite of getgroup() (old getgroup() is called
	oldgetgroup() in the meanwhile). New functions are:
	- getfirstlast()
	  find out which are the first and last articles to get
	- doxover()
	  get headers with XOVER, filter for various things and store them
	  if delaybody is used
	- fopenmsgid()
	  store an article under /var/spool/news/message.id/ and create
	  subdirectories if needed
	- getarticle()
	  get the article. Not written yet. May be split into gethead()
	  and getbody() (not sure yet).
240799: handling of long ints was still incorrect in getgroup(). Fixed.
230799: fetchnews now also catches SIGTERM.
210799: getgroup() returns now unsigned long instead of int
210799: processupstream(): declared newserver as "unsigned long" to improve
	compatibility
210799: activated -H and -B switches (most of the code was already present
	in 1.9.4)

libutil:
=======

231000: filterutil: messed around with killfilter() a bit more. Now it
	seems to work.
231000: filterutil: readfilter(): pcre_compile() was called with wrong
	variable "l" instead of "value". Fixed by Joerg Dietrich
	<joerg@dietrich.net>.
231000: filterutil: killfilter(): parameters for call of findinheaders()
	were switched.  Switched back by Joerg Dietrich <joerg@dietrich.net>.
231000: filterutil: killfilter(): no check whether findinheaders() found
	something before calling strtol(). This could lead to crashes.
	Fixed by Joerg Dietrich <joerg@dietrich.net>.
231000: filterutil: findinheaders() should not match on the whole line
	but only on the length of "needle". Fixed by Joerg Dietrich
	<joerg@dietrich.net>.
181000: configutil: removed obsolete filter variables
181000: miscutil: parseopt() does not log options any more
181000: xoverutil: getxoverline() inserted tabs into the xoverline if
	they were present in multiline headers. This confused texpire.
171000: activutil: if insertgroup was called with a description of NULL,
	it would crash because strdup(NULL) was called. Now "desc" is
	checked beforehand.
131000: miscutil: getoptarg() now uses findopt().
131000: miscutil: new function findopt() which determines whether an
	option is present on the command line without using getopt().
131000: miscutil: renamed getconffile() to getoptarg() and allowed the
	specification of the option. This makes the function more
	universal.
280900: miscutil: new function getconffile() allows parsing of command
	line for a config file without using getopt(). Therefore, we
	can still use getopt() after reading the config file, thus making
	it possible to override settings in the config file.
280900: miscutil: getaline() now uses GNU getline() if present. First
	suggested by Matthias Andree <matthias.andree@web.de>.
270900: configutil: readconfig(): added "debugmode" option again because
	I frequently forgot to type -D at the command line.
270900: configutil: readconfig(): made servers again a global variable.
	I am surprised that the original code had apparently worked
	occasionally.
190900: artutil: insertgroup() sets count for each group to 0.
190900: artutil: readactive() sets count for each group to 0.
140900: xoverutil: getxoverline() now preserves atime and utime of a file.
	Patch by Joerg Dietrich <joerg@dietrich.net>. I am not sure
	whether this is really needed because getxoverline() should
	ideally be only called once - but it makes things more robust.
140900: artutil: storearticle() now can and will supersede articles.
	Patch by Joerg Dietrich <joerg@dietrich.net>. I am not sure
	whether this is desirable; at least one should be able to
	configure it.
140900: artutil: added supersede() from fetchnews. Patch by Joerg
	Dietrich <joerg@dietrich.net>.
080900: miscutil: parseopt() modified to adjust new option -F.
080900: configutil: readconfig() now takes two parameters to make it
	possible to read different config files
040900: miscutil: getaline() modified according to Matthias Andree
	<matthias.andree@web.de>.
300800: activutil: found the newly introduced bug in readactive(). We
	accidentally replaced also the last NUL byte with a space which
	was stupid (and it was pure luck that it did not cause segfaults
	so far).
290800: activutil: readactive() threw around with complaints about
	truncated groupinfo files. Fixed a first bug which might cause
	crashes because we wrote into unallocated memory. This does
	not fix the complaints, however.
240800: miscutil: getaline() still had problems with NUL bytes. Now these
	are replaced with spaces.
040800: xoverutil: getxover() could not handle negative return values from
	findxover which resulted in coredumps (the variable was declared as
	"unsigned"). Fixed.
040800: miscutil: findinlist(): if "needle" is a NULL pointer, return
	NULL.
030800: xoverutil: findxover() now returns (again?) -1 on error. (Since
	an array can have an object indexed with 0, this object would
	have never returned.)
030800: activutil: fixed a bug in insertgroup(): the description was not
	strdup()ed, leading to possible memory overwrites by other things.
	This was only discovered when implementing local groups.
280700: configutil: readconfig() now returns 0 in case of success and a
	positive error number in case of failure which then can be
	translated by the calling program (with strerror()). This should
	reduce the number of inquiries concerning unreadable config files
	somewhat.
280700: configutil: readconfig() now returns servers as parameter, if
	possible. Advantage: one global variable less.
240700: miscutil: getaline(): doubling bytes again in an exponential
	fashion; in addition patch for NUL bytes, provided by Matthias
	Andree <matthias.andree@gmx.de>.
170700: miscutil: initvars(): messed around with setuid() and getuid().
	It should now again be possible to install fetchnews setuid news.
	This ability was lost in the transition from 1.9.7 to 1.9.8.
170700: miscutil: getaline() would double the line length when reading
	incomplete lines. Now it allocates bytes in a linear fashion.
140700: filterutil: new functions findinheader() and age() (the latter
	comes virtually unchanged from fetchnews.c)
140700: filterutil: changes in newfilter(), readfilter() and most
	massively in killfilter() to accommodate group-wise "maxage",
	"maxlines", "minlines", "maxbytes" and "maxcrosspost".
140700: localutil: islocalgroup() declaration changed to remove a warning
140700: miscutil: new function checkinteresting() goes through the
	interesting.groups directory and deletes everything that is
	not interesting.
120700: nntputil: AUTHINFO USER and AUTHINFO PASS are now logged on
	the debug facility. Username and password are, of course, not
	logged.
050700: miscutil: nntp traffic is only logged if programs are invoked
	with at least two -D.
050700: miscutil: islocal() replaced with islocalgroup() in localutil
050700: new file localutil.c
010700: xoverutil: removed stripspace() completely from the code that
	creates the overview lines. This means that leading and trailing
	blanks are not removed any more in any header line, nor are
	consecutive blanks compressed. Suggested by Thomas Zajic
	<zlatko@gmx.at>.
010700: miscutil: added snprintf() from leafnode-1.9.14.
010700: activutil: insertgroup() gets an additional parameter containing
	the group description. We need this for local groups.
010700: activutil: removed a superfluous "#include <string.h>"
190300: activutil: mergeactive() now sets the "name" of the first
	unused slot to NULL. Suggested by Claude Michel <cpjm@free.fr>.
	(This may or may not cause a small memory leak.)
120300: configutil: included some strategically placed "debug = 0" and
	"debug = debugmode" lines in readconfig() to avoid logging the
	whole file every time.
120300: xoverutil: new function gfixxover() fixes overview lines for
	each group in a comma-delimited string. Written by Joerg
	Dietrich <joerg@dietrich.net>.
120300: miscutil: new function islocal() checking whether a group is
	local. Written by Joerg Dietrich <joerg@dietrich.net>.
120300: miscutil: isinteresting() rewritten for local groups by
	Joerg Dietrich <joerg@dietrich.net>.
120300: miscutil: lockfile_exists now uses fcntl() to check for
	already running instances of fetchnews (or other programs in
	the leafnode suite). Rewritten by Joerg Dietrich
	<joerg@dietrich.net>.
120300: artutil: now function lookup_xref(). This function looks up a
	group in an xref line and returns the article number if the
	group is present, otherwise NULL. Written by Joerg Dietrich
	<joerg@dietrich.net>.
120300: activutil: fakeactive() now also checks local groups. Patch by
	Joerg Dietrich <joerg@dietrich.net>.
100300: artutil: storearticle() was still broken. Massive patch by Joerg
	Dietrich <joerg@dietrich.net>. (Joerg had submitted a similar
	patch before but I apparently misplaced it.)
040300: artutil: fgetheader() will now remove the : by itself even
	if not given in the "header" parameter.
040300: activutil: insertgroup() changed creation times of already
	existing groups, causing them to be displayed as new. Bug
	independently fixed by Johannes Stezenbach and Joerg Dietrich
	<joerg@dietrich.net>.
040300: activutil: helpfindgroup() modified which speeds up the time to find
	a group. Prompted by benchmarking the code to some code written by
	Tony de Haan <tony@iae.nl>.
040300: miscutil: new functions stringlistlen() and cmdlinetolist(),
	written by Andreas Ferber <aferber@techfak.uni-bielefeld.de>.
230200: xoverutil: getxoverline() now ignores Lines: headers and computes
	the correct number by itself. Suggested by Johannes Stezenbach.
220200: miscutil: replaced the fnmatch() code in ngmatch() with Rich
	Salz's original wildmat().
130200: activutil: fixed small bug introduced yesterday
120200: activutil: Lloyd Zusman <ljz@asfast.com> discovered and plugged
	a memory hole in readactive(): new function freeactive().
290100: activutil: changegroupdesc() crashed when receiving NULL pointers.
	Bug fixed by Joerg Dietrich <joerg@dietrich.net>.
290100: miscutil: ngmatch(): case-insensitive regexp now indeed terminates
	with '\0'. Bug fixed by Joerg Dietrich <joerg@dietrich.net>.
180100: activutil: writeactive() does not write empty records any more.
	Code taken from 1.9.10b2.
180100: readactive: first and last article set to 1 if they are 0.
180100: xoverutil: improved code for deletion of illegal articles after
	bug reports by Andy Piper <squiggle@ukgateway.net>.
080100: xoverutil: return value of mkstemp() was tested in the wrong way.
	Fixed.
080100: activutil: fakeactive() successfully debugged. This means that all
	functions in activutil.c have been successfully tested.
080100: activutil: helpfindgroup() now uses signed longs instead of
	unsigned ones. This solves a lot of problems.
080100: activutil: insertgroup() could not deal with already existing
	groups. Fixed.
080100: activutil: readactive() missed a free( buf ). Fixed.
070100: activutil: fakeactive() now disregards subgroups starting with
	digits (this still doesn't help against group names which consist
	entirely of digits, such as alt.2600)
070100: activutil_new moved to activutil
070100: moved isinteresting() from activutil to miscutil.
070100: miscutil: removed "active = NULL" from initvars().
060100: activutil: completely rewritten to use arrays instead of trees,
	unfinished version stored in activutil_new.c. readactive()
	and writeactive() have already been tested successfully.
060100: configutil: no more "debugmode" parameter. Use -D instead.
060100: miscutil: ngmatch() converts a pattern that does not contain
	ranges into a case-insensitive pattern before using fnmatch()
	on it.
060100: filterutil: implemented more intricate filtering rules. This
	involved a major rewrite of readfilter() and dofilter() (now
	called killfilter()) and the new functions newfilter(),
	selectfilter() and freefilter().
040100: miscutil: replaced ngmatch() with the version from leafnode-1.9.7.
	This makes string comparison sometimes case-insensitive and fixes
	a bug reported by Daniel Barron <daniel@jadeb.com>: in config.h.in,
	HAVE_FNMATCH is defined; but in miscutil.c, HAVE_FNMATCH_H was used.
030100: miscutil: initvars(): setreuid() and setregid() are replaced
	by setuid() and setgid() if possible. Patch by Bruno Rohee
	<rohee@OpenBSD.ORG>.
030100: xoverutil: getxover(): open(mktemp()) replaced with mkstemp()
	if possible. Patch by Bruno Rohee <rohee@OpenBSD.ORG>.
011299: configutil: readconfig(): parameter was missing if an username
	was found in a file without a server. Reported by Bruno Rohee
	<rohee@OpenBSD.ORG>.
251199: xoverutil: getxoverline() now also allows tabs behind the colon
	in headers. Problem reported by Radoslaw Gancaraz <r_g@priv2.onet.pl>.
221199: miscutil: chdirgroup(): tolower() now casts its argument like
	isspace() etc.
221199: miscutil: lockfile_exists(): getpid() now casted to int.
191199: activutil: readactive(): if reading is truncated, st.st_size is now
	cast to int. Submitted by Bruno Rohee <rohee@OpenBSD.ORG>.
191199: activutil: helpwriteactive(): g->age casted to unsigned long.
	Submitted by Bruno Rohee <rohee@OpenBSD.ORG>.
191199: activutil: readactive(): when groupinfo was not a regular file,
	leafnode would crash. Bug discovered and fixed by Bruno Rohee
	<rohee@OpenBSD.ORG>.
181199: activutil: writeactive() does not change case of newsgroups anymore.
181199: miscutil: removed lowercase() (not necessary anymore).
181199: miscutil: made the replacement code for fnmatch() case-insensitive.
091199: filterutil: dofilter() returned a hit when no filter file was
	present. Bug found and fixed by Joerg Dietrich <joerg@dietrich.net>.
091199: xoverutil: hopefully the last patch (this time to findxover() which
	would be unable to find certain articles and segfault with others).
	Bug found by Joerg Dietrich <joerg@dietrich.net>.
081199: xoverutil: some more patching in getxover() to get everything right.
071199: xoverutil: spent about four hours hunting a bug which lead to a
	segfault (xcount was set 1 too high in getxover() which resulted
	in the crash of writexover()). I have no idea when this problem
	was introduced as I had not encountered any problems with crashes
	since 011199.
031199: miscutil: daylight savings time was not correctly honoured in
	rfctime(). Bug reported by Diedrich Ehlerding
	<diedrich.ehlerding@t-online.de>.
011199: xoverutil: writexover() would always forget to write the overview
	record for the latest article.
011199: configutil: when setting the core limit, the struct is now first
	initialized by calling getrlimit().
011199: miscutil: initvars() now always sets the access rights for
	/var/spool/news/out.going to rwsr-xr-x.
281099: miscutil: patched rfctime() to remove unnecessary variables (leftovers
	from leafnode-1.4) and to accommodate new member of struct tm, based
	on a patch by Michael Mauch <michael.mauch@gmx.de>
231099: configutil: removed "newsrc" option
231099: configutil: new option "pseudoarticle" to use an arbitrary
	pseudoarticle
091099: miscutil: new version appendtolist() adds a new entry to a
	stringlist. Replaces lots of code at different places in
	fetchnews.c.
220999: activutil: a closedir() was missing in fakeactive(). Bug discovered
	and fixed by Brian Ewins <Brian.Ewins@gssec.bt.co.uk>.
200999: xoverutil: fixed a bug in getxover() which was introduced on
	290899 and caused fetch to crash (a pointer was freed twice).
300899: artutil: applied a patch from Greg Weeks <greg@durendal.tzo.com>
	to storearticle() which makes rnews work properly in pipes.
290899: xoverutil: rewrote getxover() completely. The .overview file
	is now also written if files are deleted. Furthermore, there
	should be no more memory shortage if there are articles with
	very different numbers in a newsgroup. (This bug was first
	reported by Giulio <giuliox@tin.it>.)
	New functions:
	- findxover() and helpfindxover(): find the index entry for an
	  article number. findxover() is also called by nntpd.
	- _compxover(): sorts the .overview file with qsort(3).
280899: xoverutil: removed some error messages from getxover() which
	were mostly bogus (because you got them if a newsgroup started
	with a digit).
280899: nntputil is included into libutil.a again
240899: nntputil is not included into libutil.a anymore
240899: nntputil: rewrote putaline() (needs no global lineout anymore)
230899: filterutil: dofilter() gets article number as additional parameter
190899: xoverutil: getxover(): would try to get xover information from
	directories starting with digits. Bug reported by a number of
	people, among them Jeff Grossman <jeff@stikman.com>.
190899: xoverutil: getxover(): the .overview file could be left open if
	some other condition than its opening failed. Fixed.
090899: activutil: isinteresting() missed a few closedir() calls
050899: nntputil: tgetaline() removed
050899: configutil: new global variable "filtermode" which cannot yet
	be set. Will allow choosing between filtering xover headers or
	real article headers.
050899: configutil: servers now logged to LOG_DEBUG, not LOG_INFO
010899: filterutil: filterlist is initially NULL
010899: filterutil: readfilter() now returns FALSE if filterfile could not
	be read.
250799: filterutil: compiling filter verbose message switched off again
240799: activutil: isinteresting() now uses readdir() instead of stat
	(i.e. it will not access the inode any more); the parameter
	is now declared "const".
220799: xoverutil: getxover() checked wrong condition if a file was
	"illegal". Bug discovered and fixed by Matthias Andree
	<matthias.andree@web.de>.
210799: xoverutil: new function writexover().
210799: changed type of xfirst/xlast to unsigned long.
210799: moved initialization of xfirst/xlast/xover structure from miscutil.c
	to xoverutil.c (declaration).
210799: artutil: switched various format strings from int to unsigned long
210799: activutil: switched format in helpwriteactive() to unsigned long
210799: configutil: switched artlimit and initiallimit from int to unsigned
	long.
210799: activutil: readactive(): initialized desc to NULL. Patch by
	Matthias Andree <matthias.andree@web.de>.
210799: configutil: readconfig(): initialized p and q to NULL. Patch by
	Matthias Andree <matthias.andree@web.de>.
210799: miscutil: declared namelen as unsigned int instead of int. Patch
	by Matthias Andree <matthias.andree@web.de>.
210799: nntputil: removed a register declaration from nntpconnect() and
	made two variables static (removes pgcc warnings and solves some
	ominous problems). Patch by Matthias Andree
	<matthias.andree@web.de>.
210799: xoverutil: do not expire files starting with '.'. Based on a
	patch by Matthias Andree <matthias.andree@web.de>.
210799: configutil: new parameter "newsrc" (not used yet)
210799: filterutil: compiling filters is shown when being verbose

newsq:
=====

080900: adjusted main() to new format of parseopt().
291199: should now also print correctly if sizeof(off_t) == 8
221199: #include <sys/types.h> (required by HP/UX and possibly others)

nntpd:
=====

190900: dogroup() now indeed returns the approximate number of articles
	in the group, not just (g->last - g->first) .
180900: changed doselectedheader() to return 420 if no article is in the
	specified range.
170900: Joerg Dietrich <joerg@dietrich.net> fixed broken doselectedheader().
170900: Joerg Dietrich <joerg@dietrich.net> changed all calls of
		ngmatch( l->string, pattern )
	to
		ngmatch( (const char*)&(l->string), pattern ).
	This is necessary because a stringlist entry l is not a struct of
	two pointers (one to the next entry, the other to the string) but
	contains the actual string.
140900: removed some more superfluous \r\n in various nntpprintf() calls
	(patch by Joerg Dietrich <joerg@dietrich.net>).
130900: doxover(): XOVER for an empty range returned 224, not 420.
	Fixed.
130900: doxover(): XOVER returned all articles, not only the current one.
	Fixed.
080900: new option -F to read from different config file.
080900: adjusted main() to new format of parseopt().
080900: adjusted main() to new format of readconfig().
040900: doselectedheader(): "XHDR [header] <message-id>" always returned
	the first header of strlen(header) in the file, without checking
	for identity. Bug reported by Andrzej Radecki <radecki@wpk.p.lodz.pl>.
080800: doselectedheader(): now also can return a Newsgroups: header for
	pseudoarticles if "XHDR Newsgroups" is requested. Suggested by
	Karen Nakamura <mail@gpsy.com> because MT Newswatcher needs it.
040800: new function gmtoff(), written by Joerg Dietrich <joerg@dietrich.net>,
	calculates a reliable difference between localtime and GMT. Some
	help from Oisin Curtin <ocurtin@usa.net> and Radoslaw Gancarz
	<r_g@priv2.onet.pl>.
030800: dohelp(): added "list overview.fmt"
030800: dolist(): removed a few superfluous \r\n
030800: main(): added invocation of readlocalgroups(). This makes local
	groups work with the nntpd.
030800: nntpprintf(): now fflush() stdout after printing. This seems to
	fix a problem of incomplete threading in tin.
050700: removed the "justaftergroup" mechanism. Instead, groups are now
	marked if one of the following NNTP commands is encountered:
	- GROUP if the group was already interesting
	- LISTGROUP
	- XHDR
	- XPAT
	- XOVER
	- ARTICLE
050700: dogroup() now marks a group as interesting if it was already in
	the list of interesting groups, but not otherwise. This solves
	some problems with Knode. Suggested by Christian Gebauer
	<gebauer@bigfoot.com>.
050700: calls to islocal() replaced with calls to islocalgroup().
010700: dopost(): if owndn is set, it is now also included in the Path:
	(not only used for the message ID). Suggested by Mark Brown
	<broonie@tardis.ed.ac.uk>.
310300: donewnews() and donewgroups(): external variable timezone does
	not exist on BSD. Replaced with tm_gmtoff.
120300: dopost(): articles are now immediately sorted into the spool.
	This is achieved by fork()ing. nntpd ignores SIGCHLD therefore
	(in main()).
	One problem is that now fetchnews and the nntpd cannot be
	run at the same time (?).
120300: dogroup() now always calls rereadactive() before looking for the
	groupname. Patch by Joerg Dietrich <joerg@dietrich.net>.
120300: markinterest() returns immediately (and does not touch files in
	$SPOOLDIR/interesting.groups) if a group is local.
100300: NEWGROUPS and NEWNEWS now only care for timezone if the client does
	not explicitely request "GMT". Patch by Joerg Dietrich
	<joerg@dietrich.net>.
040300: parser() now also understands PAT in addition to XPAT.
040300: dohelp() adjusted for NEWNEWS capabilities.
040300: new function donewnews() to support NEWNEWS. This function is
	still somewhat crude in that it does not care for timezones.
040300: NEWGROUPS now also cares for timezone. Patch by Johannes
	Stezenbach.
040300: Andreas Ferber <aferber@techfak.uni-bielefeld.de> merged
	doxpat() and doxhdr() into new function doselectedheader().
	doxpat() and doxhdr() remain as small wrappers.
270200: fprintpseudobody(): now contains new URL for leafnode. Reported
	by Thomas Bader <thomasb@trash.net>.
230200: dohelp() and dolist() adjusted for new XPAT capabilities.
230200: new function doxpat(), written by Andreas Ferber
	<aferber@techfak.uni-bielefeld.de>. This enables the nntpd
	to understand the XPAT command.
130200: removed shadow code from doauthinfo() (does not work because
	nntpd never runs as root).
160100: doxhdr() now returns (none) if asked for XHDR REFERENCES of an
	article. Suggested by Ted Marston <ted@nowtsfree.freeserve.co.uk>;
	increases compatibility with xrn.
080100: donewgroups() and list() do not traverse trees any more but just
	zoom through the whole array of "active". This avoids a lot of
	recursive invoking of functions and therefore may be faster.
030100: donewgroups(): some buggy newsreaders send date in the form YYYMMDD.
	We now parse these dates successfully. Bug first reported by
	Nick Drage <nick-drage@gmx.ch>.
211299: markinterest() changed both mtime and atime if file was already
	present. Fixed. (A problem with the expiry mechanism had been
	reported by several people but it was quite difficult to track it
	down.)
101299: if the domainname is set in the config file, it is now also used
	in the Path:. Suggested by Klaus Berger <klausmartin.berger@gmx.net>.
011299: dopost(): if spoolfile could not be opened, argument was missing
	in syslog() call. Reported by Bruno Rohee <rohee@OpenBSD.ORG>.
251199: dopost() now also allows tabs behind the colon of headers.
181199: case of newsgroups is not changed anymore.
041199: parser() now also skips leading spaces.
011199: removed rereadactive() calls from parser() and put them into
	dolist() and dogroup(). This should save a little time.
231099: new function fprintpseudobody(): print body of an arbitrary
	pseudoarticle and do certain replacements
171099: donewgroups(): fixed a bug with the year 2000 (centuries were not
	handled properly). Reported by Michael Schuetz
	<michael.schuetz@tu-clausthal.de>.
171099: main(): nntpd did not complain if it could not read configuration
	file. Bug reported by Alexander Rudyk <alexrudyk@arnet.de>.
081099: dopost(): leafnode now doesn't accept postings if headers are
	longer than 1000 chars. It is not very strict, e.g. it doesn't
	check for multiline headers. (IMO, it shouldn't care at all
	and in fact is capable of transferring headers of arbitrary
	length, but several users requested this "feature".) Requested by,
	among others, Diedrich Ehlerding <Diedrich.Ehlerding@t-online.de>.
081099: fixed a bug in markdownload(). For some reason, local article
	numbers were logged, not message-ids. I have no idea when this
	bug crept in, but it explains the long number of complaints about
	the delaybody function not working properly.
031099: fixed a typo in the pseudoarticle (found by Jeffrey Goldberg,
	<J.Goldberg@cranfield.ac.uk>)
240999: added syslog connection logging (patch by Brent J. Nordquist,
	<brent-nordquist@bethel.edu>)
220999: parser(): if an unknown command was received, the nntpd sent an
	empty line in addition to the "500" reply (probably introduced
	on 260799). Fixed.
260799: parser(): if command line length == 0, now continue silently (works
	better with Netscape?). Possible problem reported by Manfred
	Haertel <Manfred.Haertel@rz-online.de>.
260799: some small changes by Matthias Andree <matthias.andree@web.de>.
260799: new function nntpprintf(), written by Matthias Andree
	<matthias.andree@web.de>.
210799: implemented AUTHINFO USER and AUTHINFO PASS, based on /etc/passwd
	or /etc/shadow. With some help from a patch for PAM by Mark Brown
	<broonie@tardis.ed.ac.uk>.
	Problem: if one uses /etc/shadow, authentification will fail because
	nntpd is running as uid news and therefore cannot access the
	shadowed password file.
210799: declared artno as unsigned long (not long). Patch by Matthias
	Andree <matthias.andree@web.de>.
210799: fopenpseudoart: article number now unsigned long. Patch by
	Matthias Andree <matthias.andree@web.de>.

rnews:
=====

(rnews was originally written for a planned 1.10 version and has on
 210799 become part of 2.0.)

080900: adjusted main() to new format of parseopt().
120300: fixed call of lockfile_exists() to accommodate new format. Patch
	by Joerg Dietrich <joerg@dietrich.net>.
100300: some patches to avoid full logging of articles in rnews (by
	Joerg Dietrich <joerg@dietrich.net>). According to him, rnews
	does not work in pipes yet.
171299: uncompressfile(): replaced exit() with _exit().
210799: rnews included into version 2.0 (does not compile successfully yet,
	because decompression and xoverfile fixing don't work yet)
270699: copyfile() moved to miscutil.c (patch by Joerg Dietrich
	<joerg@dietrich.net>)
100699: rnews did not work properly with directories. The reasons were
        twofold: first, rnews refused to work with relative directories;
	second, rnews didn't account for chdir()s used when storing the
	article (with storearticle()). Bugs described and fixed by Joerg
	Dietrich <joerg@dietrich.net>.
030699: copyfile() would try to read after the end of news batches. Bug
	detected and fixed by Joerg Dietrich <joerg@dietrich.net>.
030699: copyfile(): renamed variable "total" to "copied" to clarify its
	use.
120499: rnews always wanted to read something from stdin. Fixed.
120499: rnews now properly recognizes when decompression failed and removes
	temp files
110499: rnews can now also read stuff from stdin
020499: first working version of rnews

texpire:
=======

231000: save_thread(): Joerg Dietrich <joerg@dietrich.net> removed a bug
	introduced by me probably on 180800.
190900: dogroup() failed if there was (for whatever reason) no .overview
	file. Now, if no .overview file can be found, getxover() is
	invoked.
140900: getxover() is invoked at the end of a run.
140900: threading now is only ensured down to a certain depth defined by
	THREADSAFETY. Patch by Joerg Dietrich <joerg@dietrich.net>.
080900: new option -F to read from different config file
080900: adjusted main() to new format of parseopt().
080900: adjusted main() to new format of readconfig().
210800: modified dogroup() - hopefully now every single article is by
	default tagged for deletion and will only be rescued if certain
	conditions are fulfilled.
210800: texpire crashed with a segmentation fault if no active file could
	be read. Bug described by Shaul Karl <shaulk@israsrv.net.il>; patch
	by Mark Brown <broonie@tardis.ed.ac.uk>.
180800: texpire contains some bug when allocating the overview info. This
	is very obvious if you swap the pointer to overview to the end of
	the exp{ } struct - texpire will then collapse with a segfault. I
	have not located the problem yet, however.
180800: added some comments when trying to understand the new threading
	code by Joerg Dietrich.
140700: included call to checkinteresting().
010700: expiregroup(): checks now also if the pointer g exists. Bug reported
	by Peter Katzmann <peter.katzmann@knuut.de>.
120300: replaced some strange succession of rewinddir() ... closedir() with
	a closedir() call. Based on a suggestion of Stephen Marley
	<stephen@home.uklinux.net> for leafnode-1.9.x.
120300: fixed call of lockfile_exists() to accommodate new format. Patch
        by Joerg Dietrich <joerg@dietrich.net>.
290100: speedup patch by Joerg Dietrich <joerg@dietrich.net>
090100: code cleanup in savethread() by Joerg Dietrich <joerg@dietrich.net>
090100: fix expiregroup(), by Joerg Dietrich <joerg@dietrich.net>
090100: Joerg Dietrich <joerg@dietrich.net> added option -D.
080100: expiregroup(): rewritten for use of arrays instead of trees.
211299: dogroup(): article numbers are not reset when a group is empty
	because this results in new articles not being displayed in
	low-traffic groups.
011299: dogroup(): converted some %d to %lu when printing "artno". Reported
	by Bruno Rohee <rohee@OpenBSD.ORG>.
011299: lookup_expire() now defined as "static time_t".
251199: texpire now indeed expires articles by thread. Patch by Joerg
	Dietrich <joerg@dietrich.net> which introduces two new functions,
	xoverextract() and savethread(), and patches dogroup(). This
	patch is supposed to also fix the memory allocation problem when
	article numbers are *very* different.
280899: dogroup(): when determining the first and last articles in the
	group, we now stat() every article and check whether it is a
	regular file. This saves troubles with groups like alt.2600
	where a directory alt/2600 exists and the 2600 was mistaken as
	an article number. Bug first reported by Holger Repp
	<retaliator@sbsd.de> and explained by Jeff Grossman
	<jeff@stikman.com>.

Miscellaneous:
=============

181000: removed COPYING (license is now in README)
181000: partially updated README (from a new README.html)
181000: updated the leafnode.8 manpage
181000: leafnode.h: removed obsolete external variables
181000: updated the fetchnews.5 manpage
171000: adjusted README
121000: replaced all (hopefully) occurrences of the old leafnode URL with
	http://www.leafnode.org/.
270900: leafnode.h: struct serverlist has new flag "active" which is
	set to TRUE for servers that should be indeed queried. This
	allows specification of several servers with "fetchnews -S".
190900: leafnode.h: removed "int alive" from struct newsgroup and
	inserted "unsigned long count" instead.
060900: makerpm.sh: patch by Karsten Merker <merker@linuxtag.org> to
	accommodate new names of tarballs created on 090800.
090800: Makefile.in: "make dist" now generates two tarballs, one with and
	one without PCRE code. Based on a suggestion of Matthias Andree
	<matthias.andree@web.de>.
180700: replaced all occurrences of exit(1) with exit(EXIT_FAILURE).
170700: Makefile.in: fetchnews is now installed mode 6755. Together with
	the changes in initvar() this should solve the FAQ of "how can I run
	fetchnews as user?". Suggested by Gunnar Ritter <g-r@bigfoot.de>.
170700: adjusted configure.in
050700: FAQ: added an explanation how to use sudo, originally written
	by Gerhard Schromm <Gerhard.Schromm@student.uni-ulm.de>.
050700: leafnode.h: added extensions of localutil.c
050700: Makefile.in: added localutil.c
010700: makerpm.sh: now also works with SuSE. Patch by Juergen Salk
	<juergen.salk@gmx.net>.
310300: configure.in: now also test for snprintf() and vsnprintf(). So far
	this has no consequences - we don't yet have a replacement which
	is licensed under a free non-GPL license.
190300: Makefile.in: man pages now installed with "install" instead of "cp".
	Suggested by Mike Castle <dalgoda@ix.netcom.com>.
120300: leafnode.h: additional functions added by Joerg Dietrich
	<joerg@dietrich.net>.
120300: Makefile.in: "make install" now creates additional directory
	$SPOOLDIR/local.groups . Patch by Joerg Dietrich <joerg@dietrich.net>.
100300: Makefile.in: "make dist" now includes the FAQ in the .tar.gz file.
	Noted by Joerg Dietrich <joerg@dietrich.net>.
100300: Makefile.in: "make clean" now also removes rnews. Patch by Joerg
	Dietrich <joerg@dietrich.net>.
240200: FAQ now contains a paragraph why Leafnode is not licensed under
	the GPL.
130200: fixed small bug in configure.in which was introduced yesterday
130200: merged configure.in with the 1.9.11 version
120200: configure.in now checks for system includes. Suggested by Matthias
	Andree <mandree@dosis.uni-dortmund.de>
120200: FAQ added from 1.9.10
310100: added "char status" to newsgroups definition in leafnode.h
310100: "supplement" removed from documentation.
180100: ./configure now also checks for strtok().
160100: changes in config.example and leafnode.8 suggested by Mark Brown
	<broonie@tardis.ed.ac.uk>.
130100: some changes in Makefile.in suggested by Matthias Andree
	<matthias.andree@web.de>.
080100: leafnode.h: removed unnecessary elements "left" and "right" from
	struct newsgroup.
070100: Makefile.in: "make install" now sets /etc/leafnode/config* to mode
	600 and user:group "news".
060100: fetchnews.8: rewritten to make room for new options (some of which
	are currently still unimplemented)
060100: Makefile.in: re-added -lpcre to the rule for making applyfilter
030100: Makefile.in: /var/spool/news/failed.postings was not installed
	during "make install"
030100: added checks for setuid(), setgid() and mkstemp() to configure.in.
	Patch by Bruno Rohee <rohee@OpenBSD.ORG>.
211299: added "fetchnews -n" to the troubleshooting section of the README.
151299: corrected a small bug in makerpm.sh (version was hard-coded). Problem
	reported by Riccardo Tromba <inafir@tin.it>.
131299: Karsten Merker <merker@guug.de> reanimated makerpm.sh of 1.9.6 and
	added some changes to Makefile.in. I have tried to transplant these
	changes to the 2.0 version as well.
011299: removed lookup_expire() from leafnode.h
301199: configure.in: removed size determination of off_t entirely.
301199: configure.in: discovered a bug in autoconf-2.13 which prevents
	correct determination of sizeof(off_t). Akim Demaille <akim@epita.fr>
	showed me a way how to circumvent it.
291199: configure.in: check sizeof(off_t)
251199: configure.in: now detect BSD4.2-style syslog. Appropriate changes
	have been included in the various C files (involving the openlog()
	call).
211199: config.example: added "hostname" parameter.
211199: updated INSTALL file.
211199: lsort now properly closes its input file. Fix by Joerg Dietrich
	<joerg@dietrich.net>.
211199: minor fix in lsort to accommodate really long groupinfo files
	(i is now unsigned long instead of int), written by Joerg
	Dietrich <joerg@dietrich.net>.
181199: lsort now properly sorts the stuff (sorted only small files
	previously). Problem was that qsort uses pointers to the
	array members instead of the members itself.
171199: new program lsort, written by Joerg Dietrich <joerg@dietrich.net>
	to circumvent problems with buggy sort versions from old GNU
	textutils (1.11).
171199: Makefile.in: directories not built anymore when installing (this
	is done on demand instead).
091199: "filterfile" parameter was not mentioned in config.example.
	Reported by Malte Gell <malte.gell@gmx.net>.
051199: fixed a bug in configure.in which prevented proper detection of
	tm_gmtoff. Problem reported by Ron Rosson <insane@oneinsane.net>.
281099: changed configure.in to accommodate new members of struct tm in
	miscutil.c
181099: removed "#include <sys/types.h>" and "#include <regex.h>" from
	leafnode.h (not needed since we use PCRE)
091099: some miscellaneous patches by Joerg Dietrich <joerg@dietrich.net>
	to make leafnode glibc2-compatible.
081099: leafnode.h: BODY_DOWNLOAD_LIMIT deleted (not needed anymore)
240999: update.sh: some constructs replaced with more portable one. Patch
	by Brent J. Nordquist <brent-nordquist@bethel.edu>.
090899: update.sh now uses /bin/sh instead of /bin/bash. Suggested by
	Richard van Denzel <richardd@interaccess.nl>.
260799: added catalan mini-HOWTO by Carles Sadurní Anguita
	<sadurni@benidorm.net>.
260799: fiddled with autoconf (updated configure)
220799: configure.in: --without-ipv6 would not work as an option. Bug
	reported by Roman Hodek <Roman.Hodek@informatik.uni-erlangen.de>,
	patch by Mark Brown <broonie@tardis.ed.ac.uk>.
210799: leafnode.h: switched "first" and "last" in newsgroup declaration
	from int to unsigned long.
210799: INSTALL: explanation how to upgrade an installed SuSE RPM with newer
	leafnode sources provided by Matthias Andree
	<matthias.andree@web.de>.
210799: Makefile: new "make uninstall-bins" removes only executables and
	manpages. Patch by Matthias Andree <matthias.andree@web.de>.
210799: Makefile: "make clean" removes now emacs-style backup files as well.
	Patch by Matthias Andree <matthias.andree@web.de>.
210799: Makefile: $MAKEFLAGS now declared as -$(MAKEFLAGS). This solves
	the problem that leafnode does not compile under HP/UX and allows
	"make -k". Patch by Matthias Andree <matthias.andree@web.de>.
210799: integrated rnews from 1.10b2 into leafnode package

=============================================================================

The changelog of versions before 2.0 can be found at
	http://wpxx02.toxi.uni-wuerzburg.de/~krasel/ln.changes.html

